"use strict";(self.webpackChunk_react_stockcharts3_stories=self.webpackChunk_react_stockcharts3_stories||[]).push([[6914],{"./src/series/kagi/index.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{__namedExportsOrder:()=>__namedExportsOrder,daily:()=>daily,default:()=>index_stories,intraday:()=>intraday});var jsx_runtime=__webpack_require__("../../node_modules/react/jsx-runtime.js"),react=__webpack_require__("../../node_modules/react/index.js"),utils=__webpack_require__("../core/lib/utils/index.js"),GenericChartComponent=__webpack_require__("../core/lib/GenericChartComponent.js"),GenericComponent=__webpack_require__("../core/lib/GenericComponent.js");class KagiSeries extends react.Component{constructor(){super(...arguments),this.drawOnCanvas=(ctx,moreProps)=>{const{stroke,strokeWidth,currentValueStroke}=this.props,{xAccessor,xScale,chartConfig:{yScale},plotData}=moreProps,paths=this.helper(plotData,xAccessor);let begin=!0;paths.forEach(each=>{let prevX;ctx.strokeStyle=stroke[each.type],void 0!==strokeWidth&&(ctx.lineWidth=strokeWidth),ctx.beginPath(),each.plot.forEach(d=>{const[x1,y]=[xScale(d[0]),yScale(d[1])];begin?(ctx.moveTo(x1,y),begin=!1):((0,utils.O9)(prevX)&&ctx.lineTo(prevX,y),ctx.lineTo(x1,y)),prevX=x1}),ctx.stroke()});const lastPlot=paths[paths.length-1].plot,last=lastPlot[lastPlot.length-1];ctx.beginPath(),ctx.lineWidth=1;const[x,y1,y2]=[xScale(last[0]),yScale(last[2]),yScale(last[3])];ctx.moveTo(x,y1),ctx.lineTo(x+10,y1),ctx.stroke(),ctx.beginPath(),void 0!==currentValueStroke&&(ctx.strokeStyle=currentValueStroke),ctx.moveTo(x-10,y2),ctx.lineTo(x,y2),ctx.stroke()},this.helper=(plotData,xAccessor)=>{const kagiLine=[];let kagi={},d=plotData[0],idx=xAccessor(d);for(let i=0;i<plotData.length;i++)d=plotData[i],(0,utils.pN)(d.close)||((0,utils.pN)(kagi.type)&&(kagi.type=d.startAs),(0,utils.pN)(kagi.plot)&&(kagi.plot=[]),idx=xAccessor(d),kagi.plot.push([idx,d.open]),(0,utils.O9)(d.changeTo)&&(kagi.plot.push([idx,d.changePoint]),kagi.added=!0,kagiLine.push(kagi),kagi={type:d.changeTo,plot:[],added:!1},kagi.plot.push([idx,d.changePoint])));return kagi.added||(kagi.plot.push([idx,d.close,d.current,d.reverseAt]),kagiLine.push(kagi)),kagiLine}}render(){return(0,jsx_runtime.jsx)(GenericChartComponent.P,{canvasToDraw:GenericComponent.WJ,canvasDraw:this.drawOnCanvas,drawOn:["pan"]})}}KagiSeries.defaultProps={currentValueStroke:"#000000",fill:{yang:"none",yin:"none"},stroke:{yang:"#26a69a",yin:"#ef5350"},strokeWidth:2};var ChartCanvas=__webpack_require__("../core/lib/ChartCanvas.js"),Chart=__webpack_require__("../core/lib/Chart.js"),XAxis=__webpack_require__("../axes/lib/XAxis.js"),YAxis=__webpack_require__("../axes/lib/YAxis.js"),rebind=__webpack_require__("../indicators/lib/utils/rebind.js"),path=__webpack_require__("../indicators/lib/utils/path.js"),merge=__webpack_require__("../indicators/lib/utils/merge.js"),functor=__webpack_require__("../indicators/lib/utils/functor.js"),atr=__webpack_require__("../indicators/lib/calculator/atr.js"),defaultOptionsForComputation=__webpack_require__("../indicators/lib/calculator/defaultOptionsForComputation.js");var baseIndicator=__webpack_require__("../indicators/lib/indicator/baseIndicator.js");function indicator_kagi(){const base=(0,baseIndicator.A)().type("Kagi"),underlyingAlgorithm=function kagi(){let options=defaultOptionsForComputation.Be,dateAccessor=d=>d.date,dateMutator=(d,date)=>{d.date=date};const calculator=data=>{const{reversalType,windowSize,reversal,sourcePath}=options,source=(0,path.A)(sourcePath);let reversalThreshold;if("ATR"===reversalType){const atrAlgorithm=(0,atr.A)().options({windowSize});(0,merge.A)().algorithm(atrAlgorithm).merge((d,c)=>{d["atr"+windowSize]=c})(data),reversalThreshold=d=>d["atr"+windowSize]}else reversalThreshold=(0,functor.E)(reversal);const kagiData=[];let prevPeak,prevTrough,direction,line={};return data.forEach(function(d){void 0===line.from&&(dateMutator(line,dateAccessor(d)),line.from=dateAccessor(d),line.open||(line.open=d.open),line.high=d.high,line.low=d.low,line.close||(line.close=source(d)),line.startOfYear=d.startOfYear,line.startOfQuarter=d.startOfQuarter,line.startOfMonth=d.startOfMonth,line.startOfWeek=d.startOfWeek),line.startOfYear||(line.startOfYear=d.startOfYear,line.startOfYear&&(line.date=d.date)),line.startOfQuarter||(line.startOfQuarter=d.startOfQuarter,line.startOfQuarter&&!line.startOfYear&&(line.date=d.date)),line.startOfMonth||(line.startOfMonth=d.startOfMonth,line.startOfMonth&&!line.startOfQuarter&&(line.date=d.date)),line.startOfWeek||(line.startOfWeek=d.startOfWeek,line.startOfWeek&&!line.startOfMonth&&(line.date=d.date)),line.volume=(line.volume||0)+d.volume,line.high=Math.max(line.high,d.high),line.low=Math.min(line.low,d.low),line.to=dateAccessor(d);const priceMovement=source(d)-line.close;if(line.close>=line.open&&priceMovement>0||line.close<line.open&&priceMovement<0)line.close=source(d),prevTrough&&line.close<prevTrough&&(line.changePoint=prevTrough,"yin"!==line.startAs&&(line.changeTo="yin")),prevPeak&&line.close>prevPeak&&(line.changePoint=prevPeak,"yang"!==line.startAs&&(line.changeTo="yang"));else if(line.close>=line.open&&priceMovement<0&&Math.abs(priceMovement)>reversalThreshold(d)||line.close<line.open&&priceMovement>0&&Math.abs(priceMovement)>reversalThreshold(d)){const nextLineOpen=line.close;let nextChangePoint,nextChangeTo;direction=(line.close-line.open)/Math.abs(line.close-line.open),direction<0?(void 0===prevPeak&&(prevPeak=line.open),prevTrough=line.close,source(d)>prevPeak&&(nextChangePoint=prevPeak,nextChangeTo="yang")):(void 0===prevTrough&&(prevTrough=line.open),prevPeak=line.close,source(d)<prevTrough&&(nextChangePoint=prevTrough,nextChangeTo="yin")),void 0===line.startAs&&(line.startAs=direction>0?"yang":"yin");const startAs=line.changeTo||line.startAs;line.added=!0,kagiData.push(line),direction*=-1,line={...line},line.open=nextLineOpen,line.close=source(d),line.startAs=startAs,line.changePoint=nextChangePoint,line.changeTo=nextChangeTo,line.added=!1,line.from=void 0,line.volume=0}line.current=source(d);let dir=line.close-line.open;dir=0===dir?1:dir/Math.abs(dir),line.reverseAt=dir>0?line.close-reversalThreshold(d):line.open-reversalThreshold(d)}),line.added||kagiData.push(line),kagiData};return calculator.options=newOptions=>void 0===newOptions?options:(options={...defaultOptionsForComputation.Be,...newOptions},calculator),calculator.dateMutator=newDateMutator=>void 0===newDateMutator?dateMutator:(dateMutator=newDateMutator,calculator),calculator.dateAccessor=newDateAccessor=>void 0===newDateAccessor?dateAccessor:(dateAccessor=newDateAccessor,calculator),calculator}(),indicator=underlyingAlgorithm;return(0,rebind.A)(indicator,base,"id","stroke","fill","echo","type"),(0,rebind.A)(indicator,underlyingAlgorithm,"dateAccessor","dateMutator","options"),indicator}var discontinuousTimeScaleProvider=__webpack_require__("../scales/lib/discontinuousTimeScaleProvider.js");class KagiSeries_KagiSeries extends react.Component{constructor(){super(...arguments),this.drawOnCanvas=(ctx,moreProps)=>{const{stroke,strokeWidth,currentValueStroke}=this.props,{xAccessor,xScale,chartConfig:{yScale},plotData}=moreProps,paths=this.helper(plotData,xAccessor);let begin=!0;paths.forEach(each=>{let prevX;ctx.strokeStyle=stroke[each.type],void 0!==strokeWidth&&(ctx.lineWidth=strokeWidth),ctx.beginPath(),each.plot.forEach(d=>{const[x1,y]=[xScale(d[0]),yScale(d[1])];begin?(ctx.moveTo(x1,y),begin=!1):((0,utils.O9)(prevX)&&ctx.lineTo(prevX,y),ctx.lineTo(x1,y)),prevX=x1}),ctx.stroke()});const lastPlot=paths[paths.length-1].plot,last=lastPlot[lastPlot.length-1];ctx.beginPath(),ctx.lineWidth=1;const[x,y1,y2]=[xScale(last[0]),yScale(last[2]),yScale(last[3])];ctx.moveTo(x,y1),ctx.lineTo(x+10,y1),ctx.stroke(),ctx.beginPath(),void 0!==currentValueStroke&&(ctx.strokeStyle=currentValueStroke),ctx.moveTo(x-10,y2),ctx.lineTo(x,y2),ctx.stroke()},this.helper=(plotData,xAccessor)=>{const kagiLine=[];let kagi={},d=plotData[0],idx=xAccessor(d);for(let i=0;i<plotData.length;i++)d=plotData[i],(0,utils.pN)(d.close)||((0,utils.pN)(kagi.type)&&(kagi.type=d.startAs),(0,utils.pN)(kagi.plot)&&(kagi.plot=[]),idx=xAccessor(d),kagi.plot.push([idx,d.open]),(0,utils.O9)(d.changeTo)&&(kagi.plot.push([idx,d.changePoint]),kagi.added=!0,kagiLine.push(kagi),kagi={type:d.changeTo,plot:[],added:!1},kagi.plot.push([idx,d.changePoint])));return kagi.added||(kagi.plot.push([idx,d.close,d.current,d.reverseAt]),kagiLine.push(kagi)),kagiLine}}render(){return(0,jsx_runtime.jsx)(GenericChartComponent.P,{canvasToDraw:GenericComponent.WJ,canvasDraw:this.drawOnCanvas,drawOn:["pan"]})}}KagiSeries_KagiSeries.defaultProps={currentValueStroke:"#000000",fill:{yang:"none",yin:"none"},stroke:{yang:"#26a69a",yin:"#ef5350"},strokeWidth:2};var data=__webpack_require__("./src/data/index.ts"),withSize=__webpack_require__("../utils/lib/withSize.js"),withDeviceRatio=__webpack_require__("../utils/lib/withDeviceRatio.js");class BasicKagiSeries extends react.Component{constructor(){super(...arguments),this.margin={left:0,right:40,top:0,bottom:24},this.xScaleProvider=(0,discontinuousTimeScaleProvider.L)().inputDateAccessor(d=>d.date),this.yExtents=data=>[data.high,data.low]}render(){const{data:initialData,height,ratio,width}=this.props,calculatedData=indicator_kagi()(initialData),{data,xScale,xAccessor,displayXAccessor}=this.xScaleProvider(calculatedData),max=xAccessor(data[data.length-1]),xExtents=[xAccessor(data[Math.max(0,data.length-100)]),max];return(0,jsx_runtime.jsx)(ChartCanvas.v,{height,ratio,width,margin:this.margin,data,displayXAccessor,seriesName:"Data",xScale,xAccessor,xExtents,children:(0,jsx_runtime.jsxs)(Chart.t,{id:1,yExtents:this.yExtents,children:[(0,jsx_runtime.jsx)(KagiSeries_KagiSeries,{}),(0,jsx_runtime.jsx)(XAxis.W,{}),(0,jsx_runtime.jsx)(YAxis.h,{})]})})}}const Daily=(0,data.p)()((0,withSize.U)({style:{minHeight:600}})((0,withDeviceRatio.O)()(BasicKagiSeries))),Intraday=(0,data.p)("MINUTES")((0,withSize.U)({style:{minHeight:600}})((0,withDeviceRatio.O)()(BasicKagiSeries))),index_stories={component:KagiSeries,title:"Visualization/Series/Kagi"},daily={render:()=>(0,jsx_runtime.jsx)(Daily,{})},intraday={render:()=>(0,jsx_runtime.jsx)(Intraday,{})},__namedExportsOrder=["daily","intraday"];daily.parameters={...daily.parameters,docs:{...daily.parameters?.docs,source:{originalSource:"{\n  render: () => <Daily />\n}",...daily.parameters?.docs?.source}}},intraday.parameters={...intraday.parameters,docs:{...intraday.parameters?.docs,source:{originalSource:"{\n  render: () => <Intraday />\n}",...intraday.parameters?.docs?.source}}}}}]);