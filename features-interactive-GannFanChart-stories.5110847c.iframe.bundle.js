"use strict";(self.webpackChunk_react_stockcharts3_stories=self.webpackChunk_react_stockcharts3_stories||[]).push([[7159],{"../interactive/lib/components/ClickableCircle.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{t:()=>ClickableCircle});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/react/jsx-runtime.js"),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/react/index.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../core/lib/GenericChartComponent.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../core/lib/GenericComponent.js");class ClickableCircle extends react__WEBPACK_IMPORTED_MODULE_1__.Component{constructor(){super(...arguments),this.drawOnCanvas=(ctx,moreProps)=>{const{strokeStyle,strokeWidth,fillStyle,r}=this.props;ctx.lineWidth=strokeWidth,ctx.fillStyle=fillStyle,ctx.strokeStyle=strokeStyle;const[x,y]=this.helper(moreProps);ctx.beginPath(),ctx.arc(x,y,r,0,2*Math.PI,!1),ctx.fill(),ctx.stroke()},this.isHover=moreProps=>{const{mouseXY}=moreProps,r=this.props.r+7,[x,y]=this.helper(moreProps),[mx,my]=mouseXY;return x-r<mx&&mx<x+r&&y-r<my&&my<y+r},this.helper=moreProps=>{const{xyProvider,cx,cy}=this.props;if(void 0!==xyProvider)return xyProvider(moreProps);const{xScale,chartConfig:{yScale}}=moreProps;return[xScale(cx),yScale(cy)]}}render(){const{interactiveCursorClass,onDragStart,onDrag,onDragComplete,show}=this.props;return show?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_2__.P,{interactiveCursorClass,selected:!0,isHover:this.isHover,onDragStart,onDrag,onDragComplete,canvasDraw:this.drawOnCanvas,canvasToDraw:_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__.wk,drawOn:["pan","mousemove","drag"]}):null}}ClickableCircle.defaultProps={className:"react-financial-charts-interactive-line-edge",show:!1}},"../interactive/lib/components/InteractiveStraightLine.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{AK:()=>getSlope,F$:()=>InteractiveStraightLine,KU:()=>getYIntercept,Lg:()=>isHovering,ph:()=>isHovering2,sD:()=>generateLine});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/react/jsx-runtime.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../core/lib/GenericChartComponent.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../core/lib/GenericComponent.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../core/lib/utils/noop.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../core/lib/utils/strokeDasharray.js"),react__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../node_modules/react/index.js");class InteractiveStraightLine extends react__WEBPACK_IMPORTED_MODULE_5__.Component{constructor(){super(...arguments),this.isHover=moreProps=>{const{tolerance,onHover}=this.props;if(void 0!==onHover){const{x1Value,x2Value,y1Value,y2Value,type}=this.props,{mouseXY,xScale}=moreProps,{chartConfig:{yScale}}=moreProps;return isHovering({x1Value,y1Value,x2Value,y2Value,mouseXY,type,tolerance,xScale,yScale})}return!1},this.drawOnCanvas=(ctx,moreProps)=>{const{strokeWidth=InteractiveStraightLine.defaultProps.strokeWidth,strokeDasharray,strokeStyle}=this.props,{x1,y1,x2,y2}=function helper(props,moreProps){const{x1Value,x2Value,y1Value,y2Value,type}=props,{xScale,chartConfig:{yScale}}=moreProps,modLine=generateLine({type,start:[x1Value,y1Value],end:[x2Value,y2Value],xScale,yScale}),x1=xScale(modLine.x1),y1=yScale(modLine.y1),x2=xScale(modLine.x2),y2=yScale(modLine.y2);return{x1,y1,x2,y2}}(this.props,moreProps);ctx.lineWidth=strokeWidth,ctx.strokeStyle=strokeStyle;const lineDash=(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_4__.y)(strokeDasharray);ctx.setLineDash(lineDash),ctx.beginPath(),ctx.moveTo(x1,y1),ctx.lineTo(x2,y2),ctx.stroke()}}render(){const{selected,interactiveCursorClass}=this.props,{onDragStart,onDrag,onDragComplete,onHover,onUnHover}=this.props;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_1__.P,{isHover:this.isHover,canvasToDraw:_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_2__.wk,canvasDraw:this.drawOnCanvas,interactiveCursorClass,selected,onDragStart,onDrag,onDragComplete,onHover,onUnHover,drawOn:["mousemove","pan","drag"]})}}function isHovering2(start,end,[mouseX,mouseY],tolerance){const m=getSlope(start,end);if(void 0!==m){const y=m*mouseX+getYIntercept(m,end);return mouseY<y+tolerance&&mouseY>y-tolerance&&mouseX>Math.min(start[0],end[0])-tolerance&&mouseX<Math.max(start[0],end[0])+tolerance}return mouseY>=Math.min(start[1],end[1])&&mouseY<=Math.max(start[1],end[1])&&mouseX<start[0]+tolerance&&mouseX>start[0]-tolerance}function isHovering({x1Value,y1Value,x2Value,y2Value,mouseXY,type,tolerance,xScale,yScale}){const line=generateLine({type,start:[x1Value,y1Value],end:[x2Value,y2Value],xScale,yScale}),start=[xScale(line.x1),yScale(line.y1)],end=[xScale(line.x2),yScale(line.y2)],m=getSlope(start,end),[mouseX,mouseY]=mouseXY;if(void 0!==m){const y=m*mouseX+getYIntercept(m,end);return mouseY<y+tolerance&&mouseY>y-tolerance&&mouseX>Math.min(start[0],end[0])-tolerance&&mouseX<Math.max(start[0],end[0])+tolerance}return mouseY>=Math.min(start[1],end[1])&&mouseY<=Math.max(start[1],end[1])&&mouseX<start[0]+tolerance&&mouseX>start[0]-tolerance}function getSlope(start,end){return end[0]===start[0]?void 0:(end[1]-start[1])/(end[0]-start[0])}function getYIntercept(m,end){return-1*m*end[0]+end[1]}function generateLine({type,start,end,xScale,yScale}){const m=getSlope(start,end),b=getYIntercept(m,start);switch(type){case"XLINE":return function getXLineCoordinates({start,end,xScale,yScale,m,b}){const[xBegin,xFinish]=xScale.domain(),[yBegin,yFinish]=yScale.domain();if(end[0]===start[0])return{x1:end[0],y1:yBegin,x2:end[0],y2:yFinish};const[x1,x2]=end[0]>start[0]?[xBegin,xFinish]:[xFinish,xBegin];return{x1,y1:m*x1+b,x2,y2:m*x2+b}}({start,end,xScale,yScale,m,b});case"RAY":return function getRayCoordinates({start,end,xScale,yScale,m,b}){const[xBegin,xFinish]=xScale.domain(),[yBegin,yFinish]=yScale.domain(),x1=start[0];if(end[0]===start[0])return{x1,y1:start[1],x2:x1,y2:end[1]>start[1]?yFinish:yBegin};const x2=end[0]>start[0]?xFinish:xBegin;return{x1,y1:m*x1+b,x2,y2:m*x2+b}}({start,end,xScale,yScale,m,b});default:return function getLineCoordinates({start,end}){const[x1,y1]=start,[x2,y2]=end;if(end[0]===start[0])return{x1,y1:start[1],x2:x1,y2:end[1]};return{x1,y1,x2,y2}}({start,end})}}InteractiveStraightLine.defaultProps={onEdge1Drag:_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__.l,onEdge2Drag:_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__.l,edgeStrokeWidth:3,edgeStroke:"#000000",edgeFill:"#FFFFFF",r:10,withEdge:!1,strokeWidth:1,strokeDasharray:"Solid",children:_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__.l,tolerance:7,selected:!1}},"../interactive/lib/components/MouseLocationIndicator.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{O:()=>MouseLocationIndicator});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/react/jsx-runtime.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../core/lib/GenericChartComponent.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../core/lib/GenericComponent.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../core/lib/utils/noop.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../core/lib/utils/index.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../core/lib/utils/shallowEqual.js"),react__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../node_modules/react/index.js"),_react_stockcharts3_core_lib_utils_ChartDataUtil__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../core/lib/utils/ChartDataUtil.js");class MouseLocationIndicator extends react__WEBPACK_IMPORTED_MODULE_6__.Component{constructor(){super(...arguments),this.mutableState={},this.xy=(e,moreProps)=>{const{xAccessor,plotData}=moreProps,{mouseXY,currentItem,xScale,chartConfig:{yScale}}=moreProps,{enabled,snap,shouldDisableSnap,snapTo}=this.props;if(enabled&&(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_4__.O9)(currentItem)&&(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_4__.O9)(e)){const xValue=snap&&!shouldDisableSnap(e)?xAccessor(currentItem):(0,_react_stockcharts3_core_lib_utils_ChartDataUtil__WEBPACK_IMPORTED_MODULE_7__.M4)(xScale,xAccessor,mouseXY,plotData),yValue=snap&&void 0!==snapTo&&!shouldDisableSnap(e)?(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_4__.xZ)(snapTo(currentItem),yScale.invert(mouseXY[1])):yScale.invert(mouseXY[1]);return{xValue,yValue,x:xScale(xValue),y:yScale(yValue)}}},this.handleClick=(e,moreProps)=>{const pos=this.xy(e,moreProps);if(void 0!==pos&&(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_4__.O9)(pos)){const{xValue,yValue,x,y}=pos;this.mutableState={x,y},this.props.onClick(e,[xValue,yValue],moreProps)}},this.handleMouseDown=(e,moreProps)=>{const pos=this.xy(e,moreProps);if(void 0!==pos&&(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_4__.O9)(pos)){const{xValue,yValue,x,y}=pos;this.mutableState={x,y},this.props.onMouseDown(e,[xValue,yValue],moreProps)}},this.handleMousePosChange=(e,moreProps)=>{if(!(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_5__.b)(moreProps.mousXY,moreProps.prevMouseXY)){const pos=this.xy(e,moreProps);if(void 0!==pos&&(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_4__.O9)(pos)){const{xValue,yValue,x,y}=pos;this.mutableState={x,y},this.props.onMouseMove(e,[xValue,yValue],moreProps)}}},this.drawOnCanvas=(ctx,moreProps)=>{const{enabled,r,stroke,strokeWidth}=this.props,{x,y}=this.mutableState,{show}=moreProps;enabled&&show&&(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_4__.O9)(x)&&(ctx.lineWidth=strokeWidth,ctx.strokeStyle=stroke,ctx.moveTo(x,y),ctx.beginPath(),ctx.arc(x,y,r,0,2*Math.PI,!1),ctx.stroke())}}render(){const{enabled,disablePan}=this.props;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_1__.P,{onMouseDown:this.handleMouseDown,onClick:this.handleClick,onMouseMove:this.handleMousePosChange,onPan:this.handleMousePosChange,disablePan:enabled&&disablePan,canvasDraw:this.drawOnCanvas,canvasToDraw:_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_2__.wk,drawOn:["mousemove","pan"]})}}MouseLocationIndicator.defaultProps={onMouseMove:_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__.l,onMouseDown:_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__.l,onClick:_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__.l,shouldDisableSnap:(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_4__.ER)(!1),stroke:"#000000",strokeWidth:1,opacity:1,disablePan:!0}},"./src/features/interactive/GannFanChart.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,__namedExportsOrder:()=>__namedExportsOrder,default:()=>GannFanChart_stories});var jsx_runtime=__webpack_require__("../../node_modules/react/jsx-runtime.js"),react=__webpack_require__("../../node_modules/react/index.js"),defaultLocale=__webpack_require__("../../node_modules/d3-format/src/defaultLocale.js"),src_defaultLocale=__webpack_require__("../../node_modules/d3-time-format/src/defaultLocale.js"),ChartCanvas=__webpack_require__("../core/lib/ChartCanvas.js"),Chart=__webpack_require__("../core/lib/Chart.js"),XAxis=__webpack_require__("../axes/lib/XAxis.js"),YAxis=__webpack_require__("../axes/lib/YAxis.js"),CandlestickSeries=__webpack_require__("../series/lib/CandlestickSeries.js"),MouseCoordinateY=__webpack_require__("../coordinates/lib/MouseCoordinateY.js"),MouseCoordinateX=__webpack_require__("../coordinates/lib/MouseCoordinateX.js"),CrossHairCursor=__webpack_require__("../coordinates/lib/CrossHairCursor.js"),discontinuousTimeScaleProvider=__webpack_require__("../scales/lib/discontinuousTimeScaleProvider.js"),utils=__webpack_require__("../core/lib/utils/index.js"),noop=__webpack_require__("../core/lib/utils/noop.js"),MouseLocationIndicator=__webpack_require__("../interactive/lib/components/MouseLocationIndicator.js"),HoverTextNearMouse=__webpack_require__("../interactive/lib/components/HoverTextNearMouse.js"),lib_utils=__webpack_require__("../interactive/lib/utils.js"),ChartDataUtil=__webpack_require__("../core/lib/utils/ChartDataUtil.js"),ClickableCircle=__webpack_require__("../interactive/lib/components/ClickableCircle.js");function pair(a,b){return[a,b]}var InteractiveStraightLine=__webpack_require__("../interactive/lib/components/InteractiveStraightLine.js"),GenericChartComponent=__webpack_require__("../core/lib/GenericChartComponent.js"),GenericComponent=__webpack_require__("../core/lib/GenericComponent.js");class GannFan extends react.Component{constructor(){super(...arguments),this.drawOnCanvas=(ctx,moreProps)=>{const{strokeStyle,strokeWidth,fillStyle,fontFamily,fontSize,fontFill}=this.props,lines=this.helper(this.props,moreProps);ctx.lineWidth=strokeWidth,ctx.strokeStyle=strokeStyle,ctx.font=`${fontSize}px ${fontFamily}`,ctx.fillStyle=fontFill,lines.forEach(line=>{const{x1,y1,x2,y2,label}=line;ctx.beginPath(),ctx.moveTo(x1,y1),ctx.lineTo(x2,y2),ctx.stroke(),ctx.beginPath(),ctx.fillText(label.text,label.x,label.y)});const pairsOfLines=function pairs(values,pairof=pair){const pairs=[];let previous,first=!1;for(const value of values)first&&pairs.push(pairof(previous,value)),previous=value,first=!0;return pairs}(lines);pairsOfLines.forEach(([line1,line2],idx)=>{ctx.fillStyle=fillStyle[idx],ctx.beginPath(),ctx.moveTo(line1.x1,line1.y1),ctx.lineTo(line1.x2,line1.y2),ctx.lineTo(line2.x2,line2.y2),ctx.closePath(),ctx.fill()})},this.isHover=moreProps=>{const{tolerance,onHover}=this.props,{mouseXY}=moreProps;if(!(0,utils.O9)(onHover))return!1;const lines=this.helper(this.props,moreProps);for(let i=0;i<lines.length;i++){const line1=lines[i];if((0,InteractiveStraightLine.ph)([line1.x1,line1.y1],[line1.x2,line1.y2],mouseXY,tolerance))return!0}return!1},this.getLineCoordinates=(start,endX,endY,text)=>({start,end:[endX,endY],text}),this.helper=(props,moreProps)=>{const{startXY,endXY}=props,{xScale,chartConfig:{yScale}}=moreProps;if((0,utils.pN)(startXY)||(0,utils.pN)(endXY))return[];const[x1,y1]=startXY,[x2,y2]=endXY,dx=x2-x1,dy=y2-y1;if(0!==dx&&0!==dy){const halfY=this.getLineCoordinates(startXY,x2,y1+dy/2,"2/1"),oneThirdY=this.getLineCoordinates(startXY,x2,y1+dy/3,"3/1"),oneFourthY=this.getLineCoordinates(startXY,x2,y1+dy/4,"4/1"),oneEighthY=this.getLineCoordinates(startXY,x2,y1+dy/8,"8/1"),halfX=this.getLineCoordinates(startXY,x1+dx/2,y2,"1/2"),oneThirdX=this.getLineCoordinates(startXY,x1+dx/3,y2,"1/3"),oneFourthX=this.getLineCoordinates(startXY,x1+dx/4,y2,"1/4"),lineCoods=[this.getLineCoordinates(startXY,x1+dx/8,y2,"1/8"),oneFourthX,oneThirdX,halfX,{start:startXY,end:endXY,text:"1/1"},halfY,oneThirdY,oneFourthY,oneEighthY].map(line=>{const{x1,y1,x2,y2}=(0,InteractiveStraightLine.sD)({type:"RAY",start:line.start,end:line.end,xScale,yScale});return{x1:xScale(x1),y1:yScale(y1),x2:xScale(x2),y2:yScale(y2),label:{x:xScale(line.end[0]),y:yScale(line.end[1]),text:line.text}}});return lineCoods}return[]}}render(){const{selected,interactiveCursorClass}=this.props,{onDragStart,onDrag,onDragComplete,onHover,onUnHover}=this.props;return(0,jsx_runtime.jsx)(GenericChartComponent.P,{isHover:this.isHover,canvasToDraw:GenericComponent.wk,canvasDraw:this.drawOnCanvas,interactiveCursorClass,selected,onDragStart,onDrag,onDragComplete,onHover,onUnHover,drawOn:["mousemove","pan","drag"]})}}GannFan.defaultProps={strokeWidth:1,tolerance:4,selected:!1};class EachGannFan extends react.Component{constructor(props){super(props),this.getEdgeCircle=({xy,dragHandler,cursor,fill,edge})=>{const{hover}=this.state,{selected,appearance}=this.props,{edgeStroke,edgeStrokeWidth,r}=appearance,{onDragComplete}=this.props;return(0,jsx_runtime.jsx)(ClickableCircle.t,{ref:this.saveNodeType(edge),show:selected||hover,cx:xy[0],cy:xy[1],r,fillStyle:fill,strokeStyle:edgeStroke,strokeWidth:edgeStrokeWidth,interactiveCursorClass:cursor,onDragStart:this.handleDragStart,onDrag:dragHandler,onDragComplete})},this.handleLine1Edge2Drag=(e,moreProps)=>{const{index,onDrag}=this.props,{endXY}=this.dragStart,{startPos,mouseXY,xAccessor,xScale,fullData,chartConfig:{yScale}}=moreProps,dx=startPos[0]-mouseXY[0],dy=startPos[1]-mouseXY[1],x1=xScale(endXY[0]),y1=yScale(endXY[1]),newX1Value=(0,ChartDataUtil.M4)(xScale,xAccessor,[x1-dx,y1-dy],fullData),newY1Value=yScale.invert(y1-dy);onDrag(e,index,{startXY:this.dragStart.startXY,endXY:[newX1Value,newY1Value],dy:this.dragStart.dy})},this.handleLine1Edge1Drag=(e,moreProps)=>{const{index,onDrag}=this.props,{startXY}=this.dragStart,{startPos,mouseXY,xAccessor,xScale,fullData,chartConfig:{yScale}}=moreProps,dx=startPos[0]-mouseXY[0],dy=startPos[1]-mouseXY[1],x1=xScale(startXY[0]),y1=yScale(startXY[1]);onDrag(e,index,{startXY:[(0,ChartDataUtil.M4)(xScale,xAccessor,[x1-dx,y1-dy],fullData),yScale.invert(y1-dy)],endXY:this.dragStart.endXY,dy:this.dragStart.dy})},this.handleFanDrag=(e,moreProps)=>{const{index,onDrag}=this.props,{startXY,endXY}=this.dragStart,{xScale,chartConfig:{yScale},xAccessor,fullData}=moreProps,{startPos,mouseXY}=moreProps,x1=xScale(startXY[0]),y1=yScale(startXY[1]),x2=xScale(endXY[0]),y2=yScale(endXY[1]),dx=startPos[0]-mouseXY[0],dy=startPos[1]-mouseXY[1];onDrag(e,index,{startXY:[(0,ChartDataUtil.M4)(xScale,xAccessor,[x1-dx,y1-dy],fullData),yScale.invert(y1-dy)],endXY:[(0,ChartDataUtil.M4)(xScale,xAccessor,[x2-dx,y2-dy],fullData),yScale.invert(y2-dy)],dy:this.dragStart.dy})},this.handleDragStart=()=>{const{startXY,endXY,dy}=this.props;this.dragStart={startXY,endXY,dy}},this.handleHover=(e,moreProps)=>{this.state.hover!==moreProps.hovering&&this.setState({hover:moreProps.hovering})},this.isHover=lib_utils.FK.bind(this),this.saveNodeType=lib_utils.Ap.bind(this),this.state={hover:!1}}render(){const{startXY,endXY}=this.props,{interactive,appearance}=this.props,{edgeFill,stroke,strokeWidth,fill}=appearance,{fontFamily,fontSize,fontFill}=appearance,{hoverText,selected}=this.props,{onDragComplete}=this.props,{hover}=this.state,{enable:hoverTextEnabled,...restHoverTextProps}=hoverText,shouldShowTooltip=hoverTextEnabled&&hover&&!selected,hoverHandler=interactive?{onHover:this.handleHover,onUnHover:this.handleHover}:{},line1Edge=(0,utils.O9)(startXY)&&(0,utils.O9)(endXY)?(0,jsx_runtime.jsxs)("g",{children:[this.getEdgeCircle({xy:startXY,dragHandler:this.handleLine1Edge1Drag,cursor:"react-financial-charts-move-cursor",fill:edgeFill,edge:"edge1"}),this.getEdgeCircle({xy:endXY,dragHandler:this.handleLine1Edge2Drag,cursor:"react-financial-charts-move-cursor",fill:edgeFill,edge:"edge2"})]}):null;return(0,jsx_runtime.jsxs)("g",{children:[(0,jsx_runtime.jsx)(GannFan,{ref:this.saveNodeType("fan"),selected:hover||selected,...hoverHandler,startXY,endXY,strokeStyle:stroke,strokeWidth:hover||selected?strokeWidth+1:strokeWidth,fillStyle:fill,fontFamily,fontSize,fontFill,interactiveCursorClass:"react-financial-charts-move-cursor",onDragStart:this.handleDragStart,onDrag:this.handleFanDrag,onDragComplete}),line1Edge,(0,jsx_runtime.jsx)(HoverTextNearMouse.r,{show:shouldShowTooltip,...restHoverTextProps})]})}}EachGannFan.defaultProps={yDisplayFormat:d=>d.toFixed(2),interactive:!0,selected:!1,appearance:{stroke:"#2ca02c",strokeWidth:1,edgeStroke:"#2ca02c",edgeFill:"#FFFFFF",edgeStrokeWidth:1,r:5,fill:["rgba(31, 119, 180, 0.1)","rgba(255, 126, 14, 0.1)","rgba(44, 160, 44, 0.1)","rgba(214, 39, 39, 0.1)","rgba(148, 103, 189, 0.1)","rgba(140, 86, 75, 0.1)","rgba(227, 119, 194, 0.1)","rgba(127, 127, 127, 0.1)"],fontFamily:"-apple-system, system-ui, Roboto, 'Helvetica Neue', Ubuntu, sans-serif",fontSize:10,fontFill:"#000000"},onDrag:noop.l,hoverText:{...HoverTextNearMouse.r.defaultProps,enable:!0,bgHeight:18,bgWidth:120,text:"Click to select object",selectedText:"Click to select object"}};class GannFan_GannFan extends react.Component{constructor(props){super(props),this.handleEnd=(e,_,moreProps)=>{const{current}=this.state,{fans,appearance}=this.props;if(this.mouseMoved&&(0,utils.O9)(current)&&(0,utils.O9)(current.startXY)){const newfans=[...fans.map(d=>({...d,selected:!1})),{...current,selected:!0,appearance}];this.setState({current:null},()=>{const{onComplete}=this.props;void 0!==onComplete&&onComplete(e,newfans,moreProps)})}},this.handleStart=(_,xyValue)=>{const{current}=this.state,{drawingMode=GannFan_GannFan.defaultProps.drawingMode}=this.props;drawingMode&&((0,utils.pN)(current)||(0,utils.pN)(current.startXY))&&(this.mouseMoved=!1,this.setState({current:{startXY:xyValue,endXY:null}},()=>{const{onStart}=this.props;void 0!==onStart&&onStart()}))},this.handleDrawFan=(_,xyValue)=>{const{current}=this.state;(0,utils.O9)(current)&&(0,utils.O9)(current.startXY)&&(this.mouseMoved=!0,this.setState({current:{startXY:current.startXY,endXY:xyValue}}))},this.handleDragFanComplete=(e,moreProps)=>{const{override}=this.state,{fans}=this.props;if((0,utils.O9)(override)){const{index,...rest}=override,newfans=fans.map((each,idx)=>idx===index?{...each,...rest,selected:!0}:each);this.setState({override:null},()=>{this.props.onComplete(e,newfans,moreProps)})}},this.handleDragFan=(_,index,newXYValue)=>{this.setState({override:{index,...newXYValue}})},this.terminate=lib_utils.MH.bind(this),this.saveNodeType=lib_utils.Ap.bind(this),this.getSelectionState=(0,lib_utils._W)("fans").bind(this),this.state={}}render(){const{appearance,currentPositionOpacity,currentPositionRadius=GannFan_GannFan.defaultProps.currentPositionRadius,currentPositionStroke,currentPositionStrokeWidth,enabled,fans,hoverText}=this.props,{current,override}=this.state,overrideIndex=(0,utils.O9)(override)?override.index:null,tempChannel=(0,utils.O9)(current)&&(0,utils.O9)(current.endXY)?(0,jsx_runtime.jsx)(EachGannFan,{interactive:!1,...current,appearance,hoverText}):null;return(0,jsx_runtime.jsxs)("g",{children:[fans.map((each,idx)=>{const eachAppearance=(0,utils.O9)(each.appearance)?{...appearance,...each.appearance}:appearance;return(0,jsx_runtime.jsx)(EachGannFan,{ref:this.saveNodeType(idx),index:idx,selected:each.selected,interactive:!0,...idx===overrideIndex?override:each,appearance:eachAppearance,hoverText,onDrag:this.handleDragFan,onDragComplete:this.handleDragFanComplete},idx)}),tempChannel,(0,jsx_runtime.jsx)(MouseLocationIndicator.O,{enabled,snap:!1,r:currentPositionRadius,stroke:currentPositionStroke,opacity:currentPositionOpacity,strokeWidth:currentPositionStrokeWidth,onMouseDown:this.handleStart,onClick:this.handleEnd,onMouseMove:this.handleDrawFan})]})}}GannFan_GannFan.defaultProps={drawingMode:!0,appearance:{stroke:"#2ca02c",fillOpacity:.2,strokeOpacity:1,strokeWidth:1,edgeStroke:"#2ca02c",edgeFill:"#FFFFFF",edgeStrokeWidth:1,r:5,fill:["rgba(228, 26, 28, 0.1)","rgba(55, 126, 184, 0.1)","rgba(77, 175, 74, 0.1)","rgba(152, 78, 163, 0.1)","rgba(255, 127, 0, 0.1)","rgba(255, 255, 51, 0.1)","rgba(166, 86, 40, 0.1)","rgba(247, 129, 191, 0.1)"],fontFamily:"-apple-system, system-ui, Roboto, 'Helvetica Neue', Ubuntu, sans-serif",fontSize:12,fontFill:"#000000"},onSelect:noop.l,currentPositionStroke:"#000000",currentPositionOpacity:1,currentPositionStrokeWidth:3,currentPositionRadius:4,hoverText:{...HoverTextNearMouse.r.defaultProps,enable:!0,bgHeight:18,bgWidth:120,text:"Click to select object"},fans:[]};var DrawingObjectSelector=__webpack_require__("../interactive/lib/DrawingObjectSelector.js"),withSize=__webpack_require__("../utils/lib/withSize.js"),withDeviceRatio=__webpack_require__("../utils/lib/withDeviceRatio.js"),data=__webpack_require__("./src/data/index.ts");class GannFanChart extends react.Component{constructor(props){super(props),this.interactiveNodes={},this.onKeyPress=e=>{switch(e.key.toLowerCase()){case"escape":this.setState({enableGannFan:!1});break;case"delete":case"backspace":this.setState(prevState=>({fans:Array.isArray(prevState.fans)?prevState.fans.filter(fan=>!fan.selected):[]}));break;case"g":this.setState({enableGannFan:!0})}},this.onDrawComplete=(e,newFans,_moreProps)=>{this.setState({enableGannFan:!1,fans:newFans})},this.handleSelection=(e,interactives,_moreProps)=>{const newState=this.toObject(interactives,each=>[1===each.chartId?"fans":`${each.type.toLowerCase()}_${each.chartId}`,each.objects||[]]);this.setState(newState)},this.state={enableGannFan:!1,fans:[]},this.saveInteractiveNodes=this.saveInteractiveNodes.bind(this),this.getInteractiveNodes=this.getInteractiveNodes.bind(this)}saveInteractiveNodes(type,chartId){return node=>{this.interactiveNodes||(this.interactiveNodes={});const key=`${type}_${chartId}`;(node||this.interactiveNodes[key])&&(this.interactiveNodes={...this.interactiveNodes,[key]:{type,chartId,node}})}}getInteractiveNodes(){return this.interactiveNodes}componentDidMount(){document.addEventListener("keydown",this.onKeyPress)}componentWillUnmount(){document.removeEventListener("keydown",this.onKeyPress)}toObject(interactives,keyMapper){const obj={};return interactives.forEach(each=>{const[key,value]=keyMapper(each);obj[key]=value}),obj}render(){const{data,height,width,ratio}=this.props,{enableGannFan,fans}=this.state,safeFans=Array.isArray(fans)?fans:[],xScaleProvider=discontinuousTimeScaleProvider.A.inputDateAccessor(d=>d.date),{data:chartData,xScale,xAccessor,displayXAccessor}=xScaleProvider(data),xExtents=[xAccessor(chartData[chartData.length-200]),xAccessor(chartData[chartData.length-1])];return(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("div",{style:{padding:"10px",borderBottom:"1px solid #ccc",backgroundColor:"#f5f5f5",display:"flex",gap:"10px",alignItems:"center"},children:[(0,jsx_runtime.jsx)("button",{onClick:()=>this.setState({enableGannFan:!0}),style:{backgroundColor:enableGannFan?"#007bff":"#fff",color:enableGannFan?"#fff":"#000",border:"1px solid #ccc",padding:"8px 12px",cursor:"pointer"},children:"Draw Gann Fan (G)"}),(0,jsx_runtime.jsx)("button",{onClick:()=>this.setState({enableGannFan:!1}),style:{backgroundColor:enableGannFan?"#fff":"#007bff",color:enableGannFan?"#000":"#fff",border:"1px solid #ccc",padding:"8px 12px",cursor:"pointer"},children:"Select Mode"}),(0,jsx_runtime.jsxs)("div",{style:{marginLeft:"20px",color:"#666"},children:["Mode: ",enableGannFan?"Drawing":"Select"," | Gann Fans: ",safeFans.length," | ESC: Cancel | DEL: Delete Selected | Selector: ",enableGannFan?"DISABLED":"ENABLED"]})]}),(0,jsx_runtime.jsxs)(ChartCanvas.v,{height,width,ratio,margin:{left:70,right:70,top:20,bottom:30},data:chartData,displayXAccessor,seriesName:"Data",xScale,xAccessor,xExtents,children:[(0,jsx_runtime.jsxs)(Chart.t,{id:1,yExtents:d=>[d.high,d.low],children:[(0,jsx_runtime.jsx)(XAxis.W,{}),(0,jsx_runtime.jsx)(YAxis.h,{}),(0,jsx_runtime.jsx)(CandlestickSeries.H,{}),(0,jsx_runtime.jsx)(GannFan_GannFan,{ref:this.saveInteractiveNodes("GannFan",1),enabled:enableGannFan,snap:!1,onStart:()=>{},onComplete:this.onDrawComplete,fans:safeFans}),(0,jsx_runtime.jsx)(MouseCoordinateY.R,{displayFormat:(0,defaultLocale.GP)(".2f")}),(0,jsx_runtime.jsx)(MouseCoordinateX.Y,{displayFormat:(0,src_defaultLocale.DC)("%Y-%m-%d")}),(0,jsx_runtime.jsx)(DrawingObjectSelector.D,{enabled:!enableGannFan,getInteractiveNodes:this.getInteractiveNodes,drawingObjectMap:{GannFan:"fans"},onSelect:this.handleSelection})]}),(0,jsx_runtime.jsx)(CrossHairCursor.H,{})]})]})}}const interactive_GannFanChart=(0,data.p)()((0,withSize.U)({style:{minHeight:600}})((0,withDeviceRatio.O)()(GannFanChart))),GannFanChart_stories={title:"Interactive/Gann Fan",component:interactive_GannFanChart,parameters:{layout:"fullscreen"}},Default={render:()=>(0,jsx_runtime.jsx)(interactive_GannFanChart,{})},__namedExportsOrder=["Default"];Default.parameters={...Default.parameters,docs:{...Default.parameters?.docs,source:{originalSource:"{\n  render: () => <GannFanChart />\n}",...Default.parameters?.docs?.source}}}}}]);