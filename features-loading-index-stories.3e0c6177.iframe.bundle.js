"use strict";(self.webpackChunk_react_stockcharts3_stories=self.webpackChunk_react_stockcharts3_stories||[]).push([[7502],{"../coordinates/lib/CrossHairCursor.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{H:()=>CrossHairCursor});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/react/jsx-runtime.js"),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/react/index.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../core/lib/ChartCanvas.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../core/lib/GenericComponent.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../core/lib/utils/strokeDasharray.js");class CrossHairCursor extends react__WEBPACK_IMPORTED_MODULE_1__.Component{constructor(){super(...arguments),this.drawOnCanvas=(ctx,moreProps)=>{const lines=this.getLines(this.props,moreProps);if(void 0===lines)return;const{margin,ratio}=this.context,originX=.5*ratio+margin.left,originY=.5*ratio+margin.top;ctx.save(),ctx.setTransform(1,0,0,1,0,0),ctx.scale(ratio,ratio),ctx.translate(originX,originY),lines.forEach(line=>{const dashArray=(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_4__.y)(line.strokeDasharray);ctx.strokeStyle=line.strokeStyle,ctx.lineWidth=line.strokeWidth,ctx.setLineDash(dashArray),ctx.beginPath(),ctx.moveTo(line.x1,line.y1),ctx.lineTo(line.x2,line.y2),ctx.stroke()}),ctx.restore()},this.getLines=(props,moreProps)=>{const{mouseXY,currentItem,show,height,width}=moreProps,{customX=CrossHairCursor.defaultProps.customX,strokeStyle=CrossHairCursor.defaultProps.strokeStyle,strokeDasharray,strokeWidth=CrossHairCursor.defaultProps.strokeWidth}=props;if(!show||void 0===currentItem)return;const line1={x1:0,x2:width,y1:mouseXY[1]+.5,y2:mouseXY[1]+.5,strokeStyle,strokeDasharray,strokeWidth},x=customX(props,moreProps);return[line1,{x1:x,x2:x,y1:0,y2:height,strokeStyle,strokeDasharray,strokeWidth}]}}render(){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__.By,{clip:!1,canvasDraw:this.drawOnCanvas,canvasToDraw:_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__.wk,drawOn:["mousemove","pan","drag"]})}}CrossHairCursor.defaultProps={customX:(props,moreProps)=>{const{xScale,xAccessor,currentItem,mouseXY}=moreProps,{snapX}=props;return snapX?Math.round(xScale(xAccessor(currentItem))):mouseXY[0]+.5},snapX:!0,strokeStyle:"rgba(55, 71, 79, 0.8)",strokeDasharray:"Dash",strokeWidth:1},CrossHairCursor.contextType=_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_2__.c0},"../core/lib/utils/barWidth.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{h:()=>plotDataLengthBarWidth});var ___WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../core/lib/utils/index.js");const plotDataLengthBarWidth=(props,moreProps)=>{const{widthRatio}=props,{xAccessor,xScale,plotData}=moreProps,[l,r]=xScale.range();if(null!=xScale.invert){const[dl,dr]=xScale.domain();if("number"==typeof dl&&"number"==typeof dr){return Math.abs(r-l)/Math.abs(dl-dr)*widthRatio}return(xScale(xAccessor((0,___WEBPACK_IMPORTED_MODULE_0__.HV)(plotData)))-xScale(xAccessor((0,___WEBPACK_IMPORTED_MODULE_0__.$1)(plotData))))/plotData.length*widthRatio*.7}return Math.abs(r-l)/xScale.domain().length*widthRatio}},"../core/lib/utils/noop.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{l:()=>noop});const noop=()=>{}},"../scales/lib/discontinuousTimeScaleProvider.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>discontinuousTimeScaleProvider,L:()=>discontinuousTimeScaleProviderBuilder});var utils=__webpack_require__("../core/lib/utils/index.js"),noop=__webpack_require__("../core/lib/utils/noop.js");var zipper=__webpack_require__("../core/lib/utils/zipper.js"),defaultLocale=__webpack_require__("../../node_modules/d3-time-format/src/defaultLocale.js"),ascending=__webpack_require__("../../node_modules/d3-array/src/ascending.js"),linear=__webpack_require__("../../node_modules/d3-scale/src/linear.js");const defaultFormatters={yearFormat:"%Y",quarterFormat:"%b",monthFormat:"%b",weekFormat:"%e",dayFormat:"%e",hourFormat:"%H:%M",minuteFormat:"%H:%M",secondFormat:"%H:%M:%S",milliSecondFormat:".%L"},levelDefinition=[(d,date,i)=>d.startOfYear&&date.getFullYear()%12==0&&"yearFormat",(d,date,i)=>d.startOfYear&&date.getFullYear()%4==0&&"yearFormat",(d,date,i)=>d.startOfYear&&date.getFullYear()%2==0&&"yearFormat",(d,date,i)=>d.startOfYear&&"yearFormat",(d,date,i)=>d.startOfQuarter&&"quarterFormat",(d,date,i)=>d.startOfMonth&&"monthFormat",(d,date,i)=>d.startOfWeek&&"weekFormat",(d,date,i)=>d.startOfDay&&i%2==0&&"dayFormat",(d,date,i)=>d.startOfDay&&"dayFormat",(d,date,i)=>d.startOfHalfDay&&"hourFormat",(d,date,i)=>d.startOfQuarterDay&&"hourFormat",(d,date,i)=>d.startOfEighthOfADay&&"hourFormat",(d,date,i)=>d.startOfHour&&date.getHours()%2==0&&"hourFormat",(d,date,i)=>d.startOfHour&&"hourFormat",(d,date,i)=>d.startOf30Minutes&&"minuteFormat",(d,date,i)=>d.startOf15Minutes&&"minuteFormat",(d,date,i)=>d.startOf5Minutes&&"minuteFormat",(d,date,i)=>d.startOfMinute&&"minuteFormat",(d,date,i)=>d.startOf30Seconds&&"secondFormat",(d,date,i)=>d.startOf15Seconds&&"secondFormat",(d,date,i)=>d.startOf5Seconds&&"secondFormat",(d,date,i)=>d.startOfSecond&&"secondFormat",(d,date,i)=>"milliSecondFormat"],MAX_LEVEL=levelDefinition.length-1;function financeDiscontinuousScale(index,backingLinearScale=(0,linear.A)()){if(void 0===index)throw new Error("Use the discontinuousTimeScaleProvider to create financeDiscontinuousScale");function scale(newScale){return backingLinearScale(newScale)}return scale.invert=value=>{const inverted=backingLinearScale.invert(value);return Math.round(1e4*inverted)/1e4},scale.domain=newDomain=>void 0===newDomain?backingLinearScale.domain():(backingLinearScale.domain(newDomain),scale),scale.range=range=>void 0===range?backingLinearScale.range():(backingLinearScale.range(range),scale),scale.rangeRound=range=>backingLinearScale.rangeRound(range),scale.clamp=clamp=>void 0===clamp?backingLinearScale.clamp():(backingLinearScale.clamp(clamp),scale),scale.interpolate=interpolate=>void 0===interpolate?backingLinearScale.interpolate():(backingLinearScale.interpolate(interpolate),scale),scale.ticks=m=>{const backingTicks=backingLinearScale.ticks(m),ticksMap=new Map,[domainStart,domainEnd]=backingLinearScale.domain(),dStart=Math.ceil(domainStart),dHead=index[0]?.index,start=Math.max(dStart,dHead)+Math.abs(dHead),end=Math.min(Math.floor(domainEnd),index[index.length-1]?.index)+Math.abs(dHead),desiredTickCount=Math.ceil((end-start)/(domainEnd-domainStart)*backingTicks.length);for(let i=MAX_LEVEL;i>=0;i--){const ticksAtLevel=ticksMap.get(i),temp=void 0===ticksAtLevel?[]:ticksAtLevel.slice();for(let j=start;j<=end;j++)index[j].level===i&&temp.push(index[j]);ticksMap.set(i,temp)}let unsortedTicks=[];for(let k=MAX_LEVEL;k>=0;k--){const selectedTicks=ticksMap.get(k)??[];if(selectedTicks.length+unsortedTicks.length>1.5*desiredTickCount)break;unsortedTicks=unsortedTicks.concat(selectedTicks.map(d=>d.index))}const ticks=unsortedTicks.sort(ascending.A);if(end-start>ticks.length){const ticksSet=new Set(ticks),d=Math.abs(index[0].index),distance=Math.ceil(1.5*(backingTicks.length>0?(backingTicks[backingTicks.length-1]-backingTicks[0])/backingTicks.length/4:1));for(let i=0;i<ticks.length-1;i++)for(let j=i+1;j<ticks.length;j++)ticks[j]-ticks[i]<=distance&&ticksSet.delete(index[ticks[i]+d].level>=index[ticks[j]+d].level?ticks[j]:ticks[i]);return[...ticksSet.values()].map(i=>parseInt(i,10))}return ticks},scale.tickFormat=()=>function(x){const d=Math.abs(index[0].index),{format,date}=index[Math.floor(x+d)];return format(date)},scale.value=x=>{const d=Math.abs(index[0].index),row=index[Math.floor(x+d)];if(void 0!==row){const{date}=row;return date}},scale.nice=count=>(backingLinearScale.nice(count),scale),scale.index=x=>void 0===x?index:(index=x,scale),scale.copy=()=>financeDiscontinuousScale(index,backingLinearScale.copy()),scale}const evaluateLevel=(row,date,i,formatters)=>levelDefinition.map((eachLevel,idx)=>({level:levelDefinition.length-idx-1,format:formatters[eachLevel(row,date,i)]})).find(level=>!!level.format),discontinuousIndexCalculator=function slidingWindow(){let undefinedValue,sourcePath,source,misc,windowSize=10,accumulator=noop.l,skipInitial=0;const slidingWindow=data=>{const sourceFunction=source||(0,utils.Ae)(sourcePath),size=(0,utils.ER)(windowSize).apply(this,arguments),windowData=data.slice(skipInitial,size+skipInitial).map(sourceFunction);let accumulatorIdx=0;const undef=(0,utils.ER)(undefinedValue);return data.map((d,i)=>i<skipInitial+size-1?undef(sourceFunction(d),i,misc):(i>=skipInitial+size&&(windowData.shift(),windowData.push(sourceFunction(d,i))),accumulator(windowData,i,accumulatorIdx++,misc)))};return slidingWindow.undefinedValue=function(x){return arguments.length?(undefinedValue=x,slidingWindow):undefinedValue},slidingWindow.windowSize=function(x){return arguments.length?(windowSize=x,slidingWindow):windowSize},slidingWindow.misc=function(x){return arguments.length?(misc=x,slidingWindow):misc},slidingWindow.accumulator=function(x){return arguments.length?(accumulator=x,slidingWindow):accumulator},slidingWindow.skipInitial=function(x){return arguments.length?(skipInitial=x,slidingWindow):skipInitial},slidingWindow.sourcePath=function(x){return arguments.length?(sourcePath=x,slidingWindow):sourcePath},slidingWindow.source=function(x){return arguments.length?(source=x,slidingWindow):source},slidingWindow}().windowSize(2).undefinedValue((d,idx,{initialIndex,formatters})=>{const i=initialIndex,row={date:d.getTime(),startOfSecond:!1,startOf5Seconds:!1,startOf15Seconds:!1,startOf30Seconds:!1,startOfMinute:!1,startOf5Minutes:!1,startOf15Minutes:!1,startOf30Minutes:!1,startOfHour:!1,startOfEighthOfADay:!1,startOfQuarterDay:!1,startOfHalfDay:!1,startOfDay:!0,startOfWeek:!1,startOfMonth:!1,startOfQuarter:!1,startOfYear:!1},level=evaluateLevel(row,d,i,formatters);return{...row,index:i,...level}}),discontinuousIndexCalculatorLocalTime=discontinuousIndexCalculator.accumulator(([prevDate,nowDate],i,idx,{initialIndex,formatters})=>{const nowSeconds=nowDate.getSeconds(),nowMinutes=nowDate.getMinutes(),nowHours=nowDate.getHours(),nowDay=nowDate.getDay(),nowMonth=nowDate.getMonth(),startOfSecond=nowSeconds!==prevDate.getSeconds(),startOf5Seconds=startOfSecond&&nowSeconds%5==0,startOf15Seconds=startOfSecond&&nowSeconds%15==0,startOf30Seconds=startOfSecond&&nowSeconds%30==0,startOfMinute=nowMinutes!==prevDate.getMinutes(),startOf5Minutes=startOfMinute&&nowMinutes%5<=prevDate.getMinutes()%5,startOf15Minutes=startOfMinute&&nowMinutes%15<=prevDate.getMinutes()%15,startOf30Minutes=startOfMinute&&nowMinutes%30<=prevDate.getMinutes()%30,startOfHour=nowHours!==prevDate.getHours(),startOfEighthOfADay=startOfHour&&nowHours%3==0,startOfQuarterDay=startOfHour&&nowHours%6==0,startOfHalfDay=startOfHour&&nowHours%12==0,startOfDay=nowDay!==prevDate.getDay(),startOfWeek=nowDay<prevDate.getDay(),startOfMonth=nowMonth!==prevDate.getMonth(),startOfQuarter=startOfMonth&&nowMonth%3<=prevDate.getMonth()%3,startOfYear=nowDate.getFullYear()!==prevDate.getFullYear(),row={date:nowDate.getTime(),startOfSecond,startOf5Seconds,startOf15Seconds,startOf30Seconds,startOfMinute,startOf5Minutes,startOf15Minutes,startOf30Minutes,startOfHour,startOfEighthOfADay,startOfQuarterDay,startOfHalfDay,startOfDay,startOfWeek,startOfMonth,startOfQuarter,startOfYear},level=evaluateLevel(row,nowDate,i,formatters);return{...row,index:i+initialIndex,...level}});function createIndex(realDateAccessor,inputDateAccessor,initialIndex,formatters){return function(data){const dateAccessor=realDateAccessor(inputDateAccessor);return{index:discontinuousIndexCalculatorLocalTime.source(dateAccessor).misc({initialIndex,formatters})(data).map(each=>{const{format}=each;return{index:each.index,level:each.level,date:new Date(each.date),format:(0,defaultLocale.DC)(format)}})}}}function discontinuousTimeScaleProviderBuilder(){let withIndex,initialIndex=0,realDateAccessor=d=>d,inputDateAccessor=d=>d.date,indexAccessor=d=>d.idx,indexMutator=(d,idx)=>({...d,idx}),currentFormatters=defaultFormatters;const discontinuousTimeScaleProvider=function(data){let index=withIndex;if(void 0===index){index=createIndex(realDateAccessor,inputDateAccessor,initialIndex,currentFormatters)(data).index}const inputIndex=index,xScale=financeDiscontinuousScale(inputIndex);return{data:(0,zipper.A)().combine(indexMutator)(data,inputIndex),xScale,xAccessor:d=>d&&indexAccessor(d)?.index,displayXAccessor:realDateAccessor(inputDateAccessor)}};return discontinuousTimeScaleProvider.initialIndex=function(x){return arguments.length?(initialIndex=x,discontinuousTimeScaleProvider):initialIndex},discontinuousTimeScaleProvider.inputDateAccessor=function(x){return arguments.length?(inputDateAccessor=x,discontinuousTimeScaleProvider):inputDateAccessor},discontinuousTimeScaleProvider.indexAccessor=function(x){return arguments.length?(indexAccessor=x,discontinuousTimeScaleProvider):indexAccessor},discontinuousTimeScaleProvider.indexMutator=function(x){return arguments.length?(indexMutator=x,discontinuousTimeScaleProvider):indexMutator},discontinuousTimeScaleProvider.withIndex=function(x){return arguments.length?(withIndex=x,discontinuousTimeScaleProvider):withIndex},discontinuousTimeScaleProvider.utc=()=>(realDateAccessor=dateAccessor=>d=>{const date=dateAccessor(d),offsetInMillis=60*date.getTimezoneOffset()*1e3;return new Date(date.getTime()+offsetInMillis)},discontinuousTimeScaleProvider),discontinuousTimeScaleProvider.setLocale=(locale,formatters)=>(void 0!==locale&&(0,defaultLocale.Ay)(locale),void 0!==formatters&&(currentFormatters=formatters),discontinuousTimeScaleProvider),discontinuousTimeScaleProvider.indexCalculator=function(){return createIndex(realDateAccessor,inputDateAccessor,initialIndex,currentFormatters)},discontinuousTimeScaleProvider}const discontinuousTimeScaleProvider=discontinuousTimeScaleProviderBuilder()},"../scales/lib/timeFormat.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{D:()=>timeFormat});var d3_time__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/d3-time/src/second.js"),d3_time__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/d3-time/src/minute.js"),d3_time__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../node_modules/d3-time/src/hour.js"),d3_time__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../node_modules/d3-time/src/day.js"),d3_time__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../node_modules/d3-time/src/week.js"),d3_time__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../node_modules/d3-time/src/month.js"),d3_time__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../node_modules/d3-time/src/year.js"),d3_time_format__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../../node_modules/d3-time-format/src/defaultLocale.js");const formatMillisecond=(0,d3_time_format__WEBPACK_IMPORTED_MODULE_7__.DC)(".%L"),formatSecond=(0,d3_time_format__WEBPACK_IMPORTED_MODULE_7__.DC)(":%S"),formatMinute=(0,d3_time_format__WEBPACK_IMPORTED_MODULE_7__.DC)("%H:%M"),formatHour=(0,d3_time_format__WEBPACK_IMPORTED_MODULE_7__.DC)("%H:%M"),formatDay=(0,d3_time_format__WEBPACK_IMPORTED_MODULE_7__.DC)("%e"),formatWeek=(0,d3_time_format__WEBPACK_IMPORTED_MODULE_7__.DC)("%e"),formatMonth=(0,d3_time_format__WEBPACK_IMPORTED_MODULE_7__.DC)("%b"),formatYear=(0,d3_time_format__WEBPACK_IMPORTED_MODULE_7__.DC)("%Y"),timeFormat=date=>((0,d3_time__WEBPACK_IMPORTED_MODULE_0__.R)(date)<date?formatMillisecond:(0,d3_time__WEBPACK_IMPORTED_MODULE_1__.wX)(date)<date?formatSecond:(0,d3_time__WEBPACK_IMPORTED_MODULE_2__.Ag)(date)<date?formatMinute:(0,d3_time__WEBPACK_IMPORTED_MODULE_3__.UA)(date)<date?formatHour:(0,d3_time__WEBPACK_IMPORTED_MODULE_5__.Ui)(date)<date?(0,d3_time__WEBPACK_IMPORTED_MODULE_4__.YP)(date)<date?formatDay:formatWeek:(0,d3_time__WEBPACK_IMPORTED_MODULE_6__.he)(date)<date?formatMonth:formatYear)(date)},"../series/lib/CandlestickSeries.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{H:()=>CandlestickSeries});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/react/jsx-runtime.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../core/lib/GenericChartComponent.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../core/lib/GenericComponent.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../core/lib/utils/index.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../core/lib/utils/barWidth.js"),d3_array__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../node_modules/d3-array/src/group.js"),react__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../node_modules/react/index.js");class CandlestickSeries extends react__WEBPACK_IMPORTED_MODULE_6__.Component{constructor(){super(...arguments),this.drawOnCanvas=(ctx,moreProps)=>{const{candleStrokeWidth=CandlestickSeries.defaultProps.candleStrokeWidth}=this.props,{xScale,chartConfig:{yScale},plotData,xAccessor}=moreProps,candleData=this.getCandleData(xAccessor,xScale,yScale,plotData);(0,d3_array__WEBPACK_IMPORTED_MODULE_5__.Ay)(candleData,d=>d.wick.stroke).forEach((values,key)=>{ctx.fillStyle=key,values.forEach(each=>{const d=each.wick;ctx.fillRect(d.x-.5,d.y1,1,d.y2-d.y1),ctx.fillRect(d.x-.5,d.y3,1,d.y4-d.y3)})});(0,d3_array__WEBPACK_IMPORTED_MODULE_5__.Ay)(candleData,d=>d.stroke,d=>d.fill).forEach((strokeValues,strokeKey)=>{"none"!==strokeKey&&(ctx.strokeStyle=strokeKey,ctx.lineWidth=candleStrokeWidth),strokeValues.forEach((values,key)=>{ctx.fillStyle=key,values.forEach(d=>{d.width<=1?ctx.fillRect(d.x-.5,d.y,1,d.height):0===d.height?ctx.fillRect(d.x-.5,d.y,d.width,1):(ctx.fillRect(d.x-.5,d.y,d.width,d.height),"none"!==strokeKey&&ctx.strokeRect(d.x,d.y,d.width,d.height))})})})},this.getCandleData=(xAccessor,xScale,yScale,plotData)=>{const{fill:fillProp,stroke:strokeProp,yAccessor,wickStroke:wickStrokeProp}=this.props,fill=(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__.ER)(fillProp),stroke=(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__.ER)(strokeProp),wickStroke=(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__.ER)(wickStrokeProp),offset=.5*(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__.ER)(this.props.width)(this.props,{xScale,xAccessor,plotData});return plotData.filter(d=>void 0!==yAccessor(d)).map(d=>{const ohlc=yAccessor(d);if(void 0===ohlc)return;const xValue=xAccessor(d),x=xScale(xValue),y=Math.round(yScale(Math.max(ohlc.open,ohlc.close))),height=Math.max(1,Math.round(Math.abs(yScale(ohlc.open)-yScale(ohlc.close))));return{x:x-offset,y,wick:{stroke:wickStroke(ohlc),x,y1:Math.round(yScale(ohlc.high)),y2:y,y3:y+height,y4:Math.round(yScale(ohlc.low))},height,width:2*offset,fill:fill(ohlc),stroke:stroke(ohlc),direction:ohlc.close-ohlc.open}}).filter(d=>void 0!==d)}}render(){const{clip}=this.props;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_1__.P,{clip,canvasDraw:this.drawOnCanvas,canvasToDraw:_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_2__.WJ,drawOn:["pan"]})}}CandlestickSeries.defaultProps={candleStrokeWidth:.5,clip:!0,fill:d=>d.close>d.open?"#26a69a":"#ef5350",stroke:"none",wickStroke:d=>d.close>d.open?"#26a69a":"#ef5350",width:_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_4__.h,widthRatio:.8,yAccessor:d=>({open:d.open,high:d.high,low:d.low,close:d.close})}},"./src/data/index.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{p:()=>withOHLCData,R:()=>withUpdatingData});var jsx_runtime=__webpack_require__("../../node_modules/react/jsx-runtime.js"),tsv=__webpack_require__("../../node_modules/d3-dsv/src/tsv.js"),defaultLocale=__webpack_require__("../../node_modules/d3-time-format/src/defaultLocale.js"),react=__webpack_require__("../../node_modules/react/index.js");const parseDate=(0,defaultLocale.T6)("%Y-%m-%d"),parseData=()=>d=>{const date=parseDate(d.date);d.date=null===date?new Date(Number(d.date)):new Date(date);for(const key in d)"date"!==key&&Object.prototype.hasOwnProperty.call(d,key)&&(d[key]=+d[key]);return d};function withOHLCData(dataSet="DAILY"){return OriginalComponent=>class WithOHLCData extends react.Component{constructor(props){super(props),this.state={message:`Loading ${dataSet} data...`}}componentDidMount(){fetch(`https://raw.githubusercontent.com/reactivemarkets/react-financial-charts/master/packages/stories/src/data/${dataSet}.tsv`).then(response=>response.text()).then(data=>(0,tsv.Nu)(data,parseData())).then(data=>{this.setState({data})}).catch(()=>{this.setState({message:"Failed to fetch data."})})}render(){const{data,message}=this.state;return void 0===data?(0,jsx_runtime.jsx)("div",{className:"center",children:message}):(0,jsx_runtime.jsx)(OriginalComponent,{...this.props,data})}}}function withUpdatingData(initialLength=120,interval=1e3){return OriginalComponent=>class WithOHLCData extends react.Component{constructor(props){super(props),this.state={data:props.data.slice(0,initialLength),length:initialLength}}componentDidMount(){this.interval=window.setInterval(()=>{const{data}=this.props,{length}=this.state;length<data.length?this.setState({data:data.slice(0,length+1),length:length+1}):window.clearInterval(this.interval)},interval)}componentWillUnmount(){window.clearInterval(this.interval)}render(){const{data}=this.state;return(0,jsx_runtime.jsx)(OriginalComponent,{...this.props,data})}}}},"./src/features/loading/index.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{WithGaps:()=>WithGaps,WithoutGaps:()=>WithoutGaps,__namedExportsOrder:()=>__namedExportsOrder,default:()=>index_stories});var jsx_runtime=__webpack_require__("../../node_modules/react/jsx-runtime.js"),time=__webpack_require__("../../node_modules/d3-scale/src/time.js"),react=__webpack_require__("../../node_modules/react/index.js"),ChartCanvas=__webpack_require__("../core/lib/ChartCanvas.js"),Chart=__webpack_require__("../core/lib/Chart.js"),CandlestickSeries=__webpack_require__("../series/lib/CandlestickSeries.js"),XAxis=__webpack_require__("../axes/lib/XAxis.js"),timeFormat=__webpack_require__("../scales/lib/timeFormat.js"),YAxis=__webpack_require__("../axes/lib/YAxis.js"),CrossHairCursor=__webpack_require__("../coordinates/lib/CrossHairCursor.js"),withSize=__webpack_require__("../utils/lib/withSize.js"),withDeviceRatio=__webpack_require__("../utils/lib/withDeviceRatio.js"),data=__webpack_require__("./src/data/index.ts");class LoadingChart extends react.Component{constructor(props){super(props),this.margin={left:0,right:56,top:0,bottom:24},this.padding={left:0,right:32,top:0,bottom:0},this.handleLoadBefore=(start,end)=>{console.log("onLoadBefore triggered:",{start,end});const{data:fullData}=this.props,{data:currentData}=this.state,earliestCurrent=currentData[0].date,newDataPoints=fullData.filter(d=>d.date<earliestCurrent&&d.date>=start);newDataPoints.length>0&&setTimeout(()=>{this.setState(prevState=>({data:[...newDataPoints,...prevState.data]})),console.log(`Loaded ${newDataPoints.length} earlier data points`)},500)},this.handleLoadAfter=(start,end)=>{console.log("onLoadAfter triggered:",{start,end});const{data:fullData}=this.props,{data:currentData}=this.state,latestCurrent=currentData[currentData.length-1].date,newDataPoints=fullData.filter(d=>d.date>latestCurrent&&d.date<=end);newDataPoints.length>0&&setTimeout(()=>{this.setState(prevState=>({data:[...prevState.data,...newDataPoints]})),console.log(`Loaded ${newDataPoints.length} later data points`)},500)},this.yExtentsCalculator=({plotData})=>{let min,max;for(const{low,high}of plotData)void 0===min&&(min=low),void 0===max&&(max=high),void 0!==low&&min>low&&(min=low),void 0!==high&&max<high&&(max=high);void 0===min&&(min=0),void 0===max&&(max=0);const padding=.1*(max-min);return[min-padding,max+2*padding]};const startIndex=Math.floor(.4*props.data.length),endIndex=Math.floor(.6*props.data.length);this.state={data:props.data.slice(startIndex,endIndex)}}render(){const{height,ratio,width}=this.props,{data}=this.state,xScale=(0,time.A)();return(0,jsx_runtime.jsxs)(ChartCanvas.v,{height,ratio,width,margin:this.margin,padding:this.padding,data,seriesName:"Data",xScale,xAccessor:d=>d.date,onLoadBefore:this.handleLoadBefore,onLoadAfter:this.handleLoadAfter,children:[(0,jsx_runtime.jsxs)(Chart.t,{id:1,yExtentsCalculator:this.yExtentsCalculator,children:[(0,jsx_runtime.jsx)(CandlestickSeries.H,{}),(0,jsx_runtime.jsx)(XAxis.W,{tickFormat:timeFormat.D}),(0,jsx_runtime.jsx)(YAxis.h,{})]}),(0,jsx_runtime.jsx)(CrossHairCursor.H,{snapX:!1})]})}}const Loading=(0,data.p)("DAILY")((0,withSize.U)({style:{minHeight:600}})((0,withDeviceRatio.O)()(LoadingChart)));var discontinuousTimeScaleProvider=__webpack_require__("../scales/lib/discontinuousTimeScaleProvider.js");class LoadingChartNoGaps extends react.Component{constructor(props){super(props),this.margin={left:0,right:56,top:0,bottom:24},this.padding={left:0,right:32,top:0,bottom:0},this.cumulativeOffset=0,this.handleLoadBefore=(start,end)=>{console.log("onLoadBefore triggered:",{start,end});const currentData=this.state.data,{xAccessor}=this.state,earliestCurrent=currentData[0].date,firstIndex=xAccessor(currentData[0]),gap=Math.ceil(firstIndex-start),chunkSize=Math.max(1,gap);console.log(`Gap: ${gap}, loading ${chunkSize} candles`);const candidatePoints=this.fullData.filter(d=>d.date<earliestCurrent);if(0===candidatePoints.length)return void console.log("No more data to load before");const actualChunkSize=Math.min(chunkSize,candidatePoints.length),newDataPoints=candidatePoints.slice(-actualChunkSize);console.log(`Loading ${newDataPoints.length} earlier data points`),console.log(`Offset before: ${this.cumulativeOffset} → after: ${this.cumulativeOffset-newDataPoints.length}`),this.cumulativeOffset-=newDataPoints.length;const mergedData=[...newDataPoints,...currentData],xScaleProvider=(0,discontinuousTimeScaleProvider.L)().inputDateAccessor(d=>d.date).initialIndex(this.cumulativeOffset),{data,xScale,xAccessor:newXAccessor,displayXAccessor}=xScaleProvider(mergedData);this.setState({data,xScale,xAccessor:newXAccessor,displayXAccessor})},this.handleLoadAfter=(start,end)=>{console.log("onLoadAfter triggered:",{start,end});const currentData=this.state.data,{xAccessor}=this.state,latestCurrent=currentData[currentData.length-1].date,lastIndex=xAccessor(currentData[currentData.length-1]),gap=Math.ceil(end-lastIndex),chunkSize=Math.max(1,gap);console.log(`Gap: ${gap}, loading ${chunkSize} candles`);const candidatePoints=this.fullData.filter(d=>d.date>latestCurrent);if(0===candidatePoints.length)return void console.log("No more data to load after");const actualChunkSize=Math.min(chunkSize,candidatePoints.length),newDataPoints=candidatePoints.slice(0,actualChunkSize);console.log(`Loading ${newDataPoints.length} later data points`);const mergedData=[...currentData,...newDataPoints],xScaleProvider=(0,discontinuousTimeScaleProvider.L)().inputDateAccessor(d=>d.date).initialIndex(this.cumulativeOffset),{data,xScale,xAccessor:newXAccessor,displayXAccessor}=xScaleProvider(mergedData);this.setState({data,xScale,xAccessor:newXAccessor,displayXAccessor})},this.yExtentsCalculator=({plotData})=>{let min,max;for(const{low,high}of plotData)void 0===min&&(min=low),void 0===max&&(max=high),void 0!==low&&min>low&&(min=low),void 0!==high&&max<high&&(max=high);void 0===min&&(min=0),void 0===max&&(max=0);const padding=.1*(max-min);return[min-padding,max+2*padding]};const startIndex=Math.floor(.4*props.data.length),endIndex=Math.floor(.6*props.data.length);this.fullData=props.data;const initialData=props.data.slice(startIndex,endIndex),xScaleProvider=(0,discontinuousTimeScaleProvider.L)().inputDateAccessor(d=>d.date).initialIndex(0),{data,xScale,xAccessor,displayXAccessor}=xScaleProvider(initialData);this.state={data,xScale,xAccessor,displayXAccessor}}render(){const{height,ratio,width}=this.props,{data,xScale,xAccessor,displayXAccessor}=this.state;return(0,jsx_runtime.jsxs)(ChartCanvas.v,{height,ratio,width,margin:this.margin,padding:this.padding,data,seriesName:"Data",xScale,xAccessor,displayXAccessor,onLoadBefore:this.handleLoadBefore,onLoadAfter:this.handleLoadAfter,children:[(0,jsx_runtime.jsxs)(Chart.t,{id:1,yExtentsCalculator:this.yExtentsCalculator,children:[(0,jsx_runtime.jsx)(CandlestickSeries.H,{}),(0,jsx_runtime.jsx)(XAxis.W,{}),(0,jsx_runtime.jsx)(YAxis.h,{})]}),(0,jsx_runtime.jsx)(CrossHairCursor.H,{snapX:!1})]})}}const LoadingNoGaps=(0,data.p)("DAILY")((0,withSize.U)({style:{minHeight:600}})((0,withDeviceRatio.O)()(LoadingChartNoGaps))),index_stories={title:"Features/Loading Data",component:Loading,parameters:{docs:{description:{component:"\nThis example demonstrates the `onLoadBefore` and `onLoadAfter` callbacks.\n\nThese callbacks enable **infinite scrolling** by loading more data when users pan or zoom beyond the current dataset boundaries.\n\n## How It Works\n\n- **onLoadBefore**: Called when panning/zooming **left** (earlier in time) past the first data point\n- **onLoadAfter**: Called when panning/zooming **right** (later in time) past the last data point\n\n## Try It\n\n1. The chart initially shows only a subset of data (middle 20%)\n2. **Pan left** or **zoom out** on the left edge to trigger `onLoadBefore`\n3. **Pan right** or **zoom out** on the right edge to trigger `onLoadAfter`\n4. Watch the console for callback logs\n\n## Typical Use Case\n\n```typescript\n<ChartCanvas\n    data={data}\n    onLoadBefore={(start, end) => {\n        // Fetch historical data from API\n        fetchHistoricalData(start, end).then(newData => {\n            setData([...newData, ...data]);\n        });\n    }}\n    onLoadAfter={(start, end) => {\n        // Fetch recent data from API\n        fetchRecentData(start, end).then(newData => {\n            setData([...data, ...newData]);\n        });\n    }}\n/>\n```\n\n## ⚠️ discontinuousTimeScaleProvider + pan-to-load = Bug\n\nUsing `discontinuousTimeScaleProvider` with `.initialIndex()` and pan-to-load causes viewport jumping.\nThis is a fundamental bug in react-stockcharts3's `ChartCanvas.getDerivedStateFromProps`.\n\nSee `PAN_TO_LOAD_IMPLEMENTATION.md` for full technical analysis.\n\n**Working Solutions:**\n1. Use `scaleTime()` (shows gaps - technically accurate)\n2. Use `scaleTime()` + preprocess data to remove gaps (no gaps, works perfectly)\n                "}}}},WithGaps={name:"With Time Gaps (Accurate)",render:()=>(0,jsx_runtime.jsx)(Loading,{}),parameters:{docs:{description:{story:"\nUses `scaleTime()` which shows market closures as gaps.\n\n**Pros:**\n- ✅ Perfect pan-to-load without jumping\n- ✅ Technically accurate (gaps = market closures)\n\n**Cons:**\n- ⚠️ Visible gaps in weekends/after-hours\n                "}}}},WithoutGaps={name:"No Gaps (TradingView-like)",render:()=>(0,jsx_runtime.jsx)(LoadingNoGaps,{}),parameters:{docs:{description:{story:"\nUses `scaleTime()` + custom data preprocessing to remove gaps.\n\n**Pros:**\n- ✅ No gaps (TradingView-like appearance)\n- ✅ Perfect pan-to-load without jumping\n- ✅ Wider candles fill the space\n\n**Cons:**\n- ⚠️ Time axis shows compressed timestamps\n- ⚠️ Not technically accurate (hides market closures)\n                "}}}},__namedExportsOrder=["WithGaps","WithoutGaps"];WithGaps.parameters={...WithGaps.parameters,docs:{...WithGaps.parameters?.docs,source:{originalSource:'{\n  name: "With Time Gaps (Accurate)",\n  render: () => <Loading />,\n  parameters: {\n    docs: {\n      description: {\n        story: `\nUses \\`scaleTime()\\` which shows market closures as gaps.\n\n**Pros:**\n- ✅ Perfect pan-to-load without jumping\n- ✅ Technically accurate (gaps = market closures)\n\n**Cons:**\n- ⚠️ Visible gaps in weekends/after-hours\n                `\n      }\n    }\n  }\n}',...WithGaps.parameters?.docs?.source}}},WithoutGaps.parameters={...WithoutGaps.parameters,docs:{...WithoutGaps.parameters?.docs,source:{originalSource:'{\n  name: "No Gaps (TradingView-like)",\n  render: () => <LoadingNoGaps />,\n  parameters: {\n    docs: {\n      description: {\n        story: `\nUses \\`scaleTime()\\` + custom data preprocessing to remove gaps.\n\n**Pros:**\n- ✅ No gaps (TradingView-like appearance)\n- ✅ Perfect pan-to-load without jumping\n- ✅ Wider candles fill the space\n\n**Cons:**\n- ⚠️ Time axis shows compressed timestamps\n- ⚠️ Not technically accurate (hides market closures)\n                `\n      }\n    }\n  }\n}',...WithoutGaps.parameters?.docs?.source}}}}}]);