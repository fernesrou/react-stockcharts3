"use strict";(self.webpackChunk_react_stockcharts3_stories=self.webpackChunk_react_stockcharts3_stories||[]).push([[7389],{"./src/series/renko/index.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{__namedExportsOrder:()=>__namedExportsOrder,daily:()=>daily,default:()=>index_stories,intraday:()=>intraday});var jsx_runtime=__webpack_require__("../../node_modules/react/jsx-runtime.js"),react=__webpack_require__("../../node_modules/react/index.js"),utils=__webpack_require__("../core/lib/utils/index.js"),GenericChartComponent=__webpack_require__("../core/lib/GenericChartComponent.js"),GenericComponent=__webpack_require__("../core/lib/GenericComponent.js");class RenkoSeries extends react.Component{constructor(){super(...arguments),this.drawOnCanvas=(ctx,moreProps)=>{const{xAccessor,xScale,chartConfig:{yScale},plotData}=moreProps;this.getRenko(plotData,xScale,xAccessor,yScale).forEach(d=>{const{fillStyle,strokeStyle}=d;ctx.beginPath(),void 0!==strokeStyle&&(ctx.strokeStyle=strokeStyle),void 0!==fillStyle&&(ctx.fillStyle=fillStyle),ctx.rect(d.x,d.y,d.width,d.height),ctx.closePath(),ctx.fill()})},this.getRenko=(plotData,xScale,xAccessor,yScale)=>{const{fill,stroke,yAccessor=RenkoSeries.defaultProps.yAccessor}=this.props,candleWidth=(xScale(xAccessor(plotData[plotData.length-1]))-xScale(xAccessor(plotData[0])))/(plotData.length-1);return plotData.filter(d=>(0,utils.O9)(yAccessor(d).close)).map(d=>{const ohlc=yAccessor(d),x=xScale(xAccessor(d))-.5*candleWidth,y=yScale(Math.max(ohlc.open,ohlc.close)),height=Math.abs(yScale(ohlc.open)-yScale(ohlc.close));return{fillStyle:d.fullyFormed?ohlc.open<=ohlc.close?fill?.up:fill?.down:fill?.partial,height,strokeStyle:d.fullyFormed?ohlc.open<=ohlc.close?stroke?.up:stroke?.down:void 0,width:candleWidth,x,y}})}}render(){const{clip}=this.props;return(0,jsx_runtime.jsx)(GenericChartComponent.P,{clip,canvasDraw:this.drawOnCanvas,canvasToDraw:GenericComponent.WJ,drawOn:["pan"]})}}RenkoSeries.defaultProps={clip:!0,fill:{up:"#26a69a",down:"#ef5350",partial:"#4682B4"},stroke:{up:"none",down:"none"},yAccessor:d=>({open:d.open,high:d.high,low:d.low,close:d.close})};var ChartCanvas=__webpack_require__("../core/lib/ChartCanvas.js"),Chart=__webpack_require__("../core/lib/Chart.js"),XAxis=__webpack_require__("../axes/lib/XAxis.js"),YAxis=__webpack_require__("../axes/lib/YAxis.js"),rebind=__webpack_require__("../indicators/lib/utils/rebind.js"),merge=__webpack_require__("../indicators/lib/utils/merge.js"),functor=__webpack_require__("../indicators/lib/utils/functor.js"),atr=__webpack_require__("../indicators/lib/calculator/atr.js"),defaultOptionsForComputation=__webpack_require__("../indicators/lib/calculator/defaultOptionsForComputation.js");var baseIndicator=__webpack_require__("../indicators/lib/indicator/baseIndicator.js");function indicator_renko(){const base=(0,baseIndicator.A)().type("Renko"),underlyingAlgorithm=function renko(){let options=defaultOptionsForComputation.Mb,dateAccessor=d=>d.date,dateMutator=(d,date)=>{d.date=date};const calculator=rawData=>{const{reversalType,fixedBrickSize,sourcePath,windowSize}=options,pricingMethod="high/low"===sourcePath?d=>({high:d.high,low:d.low}):d=>({high:d.close,low:d.close});let brickSize;if("ATR"===reversalType){const atrAlgorithm=(0,atr.A)().options({windowSize});(0,merge.A)().algorithm(atrAlgorithm).merge((d,c)=>{d["atr"+windowSize]=c})(rawData),brickSize=d=>d["atr"+windowSize]}else brickSize=(0,functor.E)(fixedBrickSize);const renkoData=[];let index=0,prevBrickClose=rawData[index].open,prevBrickOpen=rawData[index].open,brick={},direction=0;return rawData.forEach(function(d,idx){void 0===brick.from&&(brick.high=d.high,brick.low=d.low,brick.startOfYear=d.startOfYear,brick.startOfQuarter=d.startOfQuarter,brick.startOfMonth=d.startOfMonth,brick.startOfWeek=d.startOfWeek,brick.from=idx,brick.fromDate=dateAccessor(d),dateMutator(brick,dateAccessor(d))),brick.volume=(brick.volume||0)+d.volume;const prevCloseToHigh=prevBrickClose-pricingMethod(d).high,prevCloseToLow=prevBrickClose-pricingMethod(d).low,prevOpenToHigh=prevBrickOpen-pricingMethod(d).high,prevOpenToLow=prevBrickOpen-pricingMethod(d).low,priceMovement=Math.min(Math.abs(prevCloseToHigh),Math.abs(prevCloseToLow),Math.abs(prevOpenToHigh),Math.abs(prevOpenToLow));if(brick.high=Math.max(brick.high,d.high),brick.low=Math.min(brick.low,d.low),brick.startOfYear||(brick.startOfYear=d.startOfYear,brick.startOfYear&&dateMutator(brick,dateAccessor(d))),brick.startOfQuarter||(brick.startOfQuarter=d.startOfQuarter,brick.startOfQuarter&&!brick.startOfYear&&dateMutator(brick,dateAccessor(d))),brick.startOfMonth||(brick.startOfMonth=d.startOfMonth,brick.startOfMonth&&!brick.startOfQuarter&&dateMutator(brick,dateAccessor(d))),brick.startOfWeek||(brick.startOfWeek=d.startOfWeek,brick.startOfWeek&&!brick.startOfMonth&&dateMutator(brick,dateAccessor(d))),brickSize(d)){const noOfBricks=Math.floor(priceMovement/brickSize(d));if(brick.open=Math.abs(prevCloseToHigh)<Math.abs(prevOpenToHigh)||Math.abs(prevCloseToLow)<Math.abs(prevOpenToLow)?prevBrickClose:prevBrickOpen,noOfBricks>=1){let j=0;for(j=0;j<noOfBricks;j++){brick.close=brick.open<pricingMethod(d).high?brick.open+brickSize(d):brick.open-brickSize(d),direction=brick.close>brick.open?1:-1,brick.direction=direction,brick.to=idx,brick.toDate=dateAccessor(d),brick.fullyFormed=!0,renkoData.push(brick),prevBrickClose=brick.close,prevBrickOpen=brick.open;const newBrick={high:brick.high,low:brick.low,open:brick.close,startOfYear:!1,startOfMonth:!1,startOfQuarter:!1,startOfWeek:!1};brick=newBrick,brick.from=idx,brick.fromDate=dateAccessor(d),dateMutator(brick,dateAccessor(d)),brick.volume=(brick.volume||0)+d.volume}index=index+j-1,brick={}}else idx===rawData.length-1&&(brick.close=direction>0?pricingMethod(d).high:pricingMethod(d).low,brick.to=idx,brick.toDate=dateAccessor(d),dateMutator(brick,dateAccessor(d)),brick.fullyFormed=!1,renkoData.push(brick))}}),renkoData};return calculator.options=newOptions=>void 0===newOptions?options:(options={...defaultOptionsForComputation.Mb,...newOptions},calculator),calculator.dateMutator=newDateMutator=>void 0===newDateMutator?dateMutator:(dateMutator=newDateMutator,calculator),calculator.dateAccessor=newDateAccessor=>void 0===newDateAccessor?dateAccessor:(dateAccessor=newDateAccessor,calculator),calculator}(),indicator=underlyingAlgorithm;return(0,rebind.A)(indicator,base,"id","stroke","fill","echo","type"),(0,rebind.A)(indicator,underlyingAlgorithm,"options","dateAccessor","dateMutator"),indicator}var discontinuousTimeScaleProvider=__webpack_require__("../scales/lib/discontinuousTimeScaleProvider.js");class RenkoSeries_RenkoSeries extends react.Component{constructor(){super(...arguments),this.drawOnCanvas=(ctx,moreProps)=>{const{xAccessor,xScale,chartConfig:{yScale},plotData}=moreProps;this.getRenko(plotData,xScale,xAccessor,yScale).forEach(d=>{const{fillStyle,strokeStyle}=d;ctx.beginPath(),void 0!==strokeStyle&&(ctx.strokeStyle=strokeStyle),void 0!==fillStyle&&(ctx.fillStyle=fillStyle),ctx.rect(d.x,d.y,d.width,d.height),ctx.closePath(),ctx.fill()})},this.getRenko=(plotData,xScale,xAccessor,yScale)=>{const{fill,stroke,yAccessor=RenkoSeries_RenkoSeries.defaultProps.yAccessor}=this.props,candleWidth=(xScale(xAccessor(plotData[plotData.length-1]))-xScale(xAccessor(plotData[0])))/(plotData.length-1);return plotData.filter(d=>(0,utils.O9)(yAccessor(d).close)).map(d=>{const ohlc=yAccessor(d),x=xScale(xAccessor(d))-.5*candleWidth,y=yScale(Math.max(ohlc.open,ohlc.close)),height=Math.abs(yScale(ohlc.open)-yScale(ohlc.close));return{fillStyle:d.fullyFormed?ohlc.open<=ohlc.close?fill?.up:fill?.down:fill?.partial,height,strokeStyle:d.fullyFormed?ohlc.open<=ohlc.close?stroke?.up:stroke?.down:void 0,width:candleWidth,x,y}})}}render(){const{clip}=this.props;return(0,jsx_runtime.jsx)(GenericChartComponent.P,{clip,canvasDraw:this.drawOnCanvas,canvasToDraw:GenericComponent.WJ,drawOn:["pan"]})}}RenkoSeries_RenkoSeries.defaultProps={clip:!0,fill:{up:"#26a69a",down:"#ef5350",partial:"#4682B4"},stroke:{up:"none",down:"none"},yAccessor:d=>({open:d.open,high:d.high,low:d.low,close:d.close})};var data=__webpack_require__("./src/data/index.ts"),withSize=__webpack_require__("../utils/lib/withSize.js"),withDeviceRatio=__webpack_require__("../utils/lib/withDeviceRatio.js");class BasicRenkoSeries extends react.Component{constructor(){super(...arguments),this.margin={left:0,right:40,top:0,bottom:24},this.xScaleProvider=(0,discontinuousTimeScaleProvider.L)().inputDateAccessor(d=>d.date),this.yExtents=data=>[data.high,data.low]}render(){const{data:initialData,height,ratio,width}=this.props,calculatedData=indicator_renko()(initialData),{data,xScale,xAccessor,displayXAccessor}=this.xScaleProvider(calculatedData),max=xAccessor(data[data.length-1]),xExtents=[xAccessor(data[Math.max(0,data.length-100)]),max];return(0,jsx_runtime.jsx)(ChartCanvas.v,{height,ratio,width,margin:this.margin,data,displayXAccessor,seriesName:"Data",xScale,xAccessor,xExtents,children:(0,jsx_runtime.jsxs)(Chart.t,{id:1,yExtents:this.yExtents,children:[(0,jsx_runtime.jsx)(RenkoSeries_RenkoSeries,{}),(0,jsx_runtime.jsx)(XAxis.W,{}),(0,jsx_runtime.jsx)(YAxis.h,{})]})})}}const Daily=(0,data.p)()((0,withSize.U)({style:{minHeight:600}})((0,withDeviceRatio.O)()(BasicRenkoSeries))),Intraday=(0,data.p)("MINUTES")((0,withSize.U)({style:{minHeight:600}})((0,withDeviceRatio.O)()(BasicRenkoSeries))),index_stories={component:RenkoSeries,title:"Visualization/Series/Renko"},daily={render:()=>(0,jsx_runtime.jsx)(Daily,{})},intraday={render:()=>(0,jsx_runtime.jsx)(Intraday,{})},__namedExportsOrder=["daily","intraday"];daily.parameters={...daily.parameters,docs:{...daily.parameters?.docs,source:{originalSource:"{\n  render: () => <Daily />\n}",...daily.parameters?.docs?.source}}},intraday.parameters={...intraday.parameters,docs:{...intraday.parameters?.docs,source:{originalSource:"{\n  render: () => <Intraday />\n}",...intraday.parameters?.docs?.source}}}}}]);