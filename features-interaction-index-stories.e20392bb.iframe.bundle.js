"use strict";(self.webpackChunk_react_stockcharts3_stories=self.webpackChunk_react_stockcharts3_stories||[]).push([[1290],{"../../node_modules/d3-array/src/group.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Ay:()=>group,z:()=>rollup});var internmap__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/internmap/src/index.js"),_identity_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/d3-array/src/identity.js");function group(values,...keys){return nest(values,_identity_js__WEBPACK_IMPORTED_MODULE_1__.A,_identity_js__WEBPACK_IMPORTED_MODULE_1__.A,keys)}function rollup(values,reduce,...keys){return nest(values,_identity_js__WEBPACK_IMPORTED_MODULE_1__.A,reduce,keys)}function nest(values,map,reduce,keys){return function regroup(values,i){if(i>=keys.length)return reduce(values);const groups=new internmap__WEBPACK_IMPORTED_MODULE_0__.B,keyof=keys[i++];let index=-1;for(const value of values){const key=keyof(value,++index,values),group=groups.get(key);group?group.push(value):groups.set(key,[value])}for(const[key,values]of groups)groups.set(key,regroup(values,i));return map(groups)}(values,0)}},"../../node_modules/d3-array/src/identity.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function __WEBPACK_DEFAULT_EXPORT__(x){return x}__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__})},"../../node_modules/d3-dsv/src/tsv.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Nu:()=>tsvParse});var EOL={},EOF={};function objectConverter(columns){return new Function("d","return {"+columns.map(function(name,i){return JSON.stringify(name)+": d["+i+'] || ""'}).join(",")+"}")}function inferColumns(rows){var columnSet=Object.create(null),columns=[];return rows.forEach(function(row){for(var column in row)column in columnSet||columns.push(columnSet[column]=column)}),columns}function pad(value,width){var s=value+"",length=s.length;return length<width?new Array(width-length+1).join(0)+s:s}function formatDate(date){var hours=date.getUTCHours(),minutes=date.getUTCMinutes(),seconds=date.getUTCSeconds(),milliseconds=date.getUTCMilliseconds();return isNaN(date)?"Invalid Date":function formatYear(year){return year<0?"-"+pad(-year,6):year>9999?"+"+pad(year,6):pad(year,4)}(date.getUTCFullYear())+"-"+pad(date.getUTCMonth()+1,2)+"-"+pad(date.getUTCDate(),2)+(milliseconds?"T"+pad(hours,2)+":"+pad(minutes,2)+":"+pad(seconds,2)+"."+pad(milliseconds,3)+"Z":seconds?"T"+pad(hours,2)+":"+pad(minutes,2)+":"+pad(seconds,2)+"Z":minutes||hours?"T"+pad(hours,2)+":"+pad(minutes,2)+"Z":"")}var tsv=function dsv(delimiter){var reFormat=new RegExp('["'+delimiter+"\n\r]"),DELIMITER=delimiter.charCodeAt(0);function parseRows(text,f){var t,rows=[],N=text.length,I=0,n=0,eof=N<=0,eol=!1;function token(){if(eof)return EOF;if(eol)return eol=!1,EOL;var i,c,j=I;if(34===text.charCodeAt(j)){for(;I++<N&&34!==text.charCodeAt(I)||34===text.charCodeAt(++I););return(i=I)>=N?eof=!0:10===(c=text.charCodeAt(I++))?eol=!0:13===c&&(eol=!0,10===text.charCodeAt(I)&&++I),text.slice(j+1,i-1).replace(/""/g,'"')}for(;I<N;){if(10===(c=text.charCodeAt(i=I++)))eol=!0;else if(13===c)eol=!0,10===text.charCodeAt(I)&&++I;else if(c!==DELIMITER)continue;return text.slice(j,i)}return eof=!0,text.slice(j,N)}for(10===text.charCodeAt(N-1)&&--N,13===text.charCodeAt(N-1)&&--N;(t=token())!==EOF;){for(var row=[];t!==EOL&&t!==EOF;)row.push(t),t=token();f&&null==(row=f(row,n++))||rows.push(row)}return rows}function preformatBody(rows,columns){return rows.map(function(row){return columns.map(function(column){return formatValue(row[column])}).join(delimiter)})}function formatRow(row){return row.map(formatValue).join(delimiter)}function formatValue(value){return null==value?"":value instanceof Date?formatDate(value):reFormat.test(value+="")?'"'+value.replace(/"/g,'""')+'"':value}return{parse:function parse(text,f){var convert,columns,rows=parseRows(text,function(row,i){if(convert)return convert(row,i-1);columns=row,convert=f?function customConverter(columns,f){var object=objectConverter(columns);return function(row,i){return f(object(row),i,columns)}}(row,f):objectConverter(row)});return rows.columns=columns||[],rows},parseRows,format:function format(rows,columns){return null==columns&&(columns=inferColumns(rows)),[columns.map(formatValue).join(delimiter)].concat(preformatBody(rows,columns)).join("\n")},formatBody:function formatBody(rows,columns){return null==columns&&(columns=inferColumns(rows)),preformatBody(rows,columns).join("\n")},formatRows:function formatRows(rows){return rows.map(formatRow).join("\n")},formatRow,formatValue}}("\t"),tsvParse=tsv.parse;tsv.parseRows,tsv.format,tsv.formatBody,tsv.formatRows,tsv.formatRow,tsv.formatValue},"../../node_modules/internmap/src/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{B:()=>InternMap});class InternMap extends Map{constructor(entries,key=keyof){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:key}}),null!=entries)for(const[key,value]of entries)this.set(key,value)}get(key){return super.get(intern_get(this,key))}has(key){return super.has(intern_get(this,key))}set(key,value){return super.set(intern_set(this,key),value)}delete(key){return super.delete(intern_delete(this,key))}}Set;function intern_get({_intern,_key},value){const key=_key(value);return _intern.has(key)?_intern.get(key):value}function intern_set({_intern,_key},value){const key=_key(value);return _intern.has(key)?_intern.get(key):(_intern.set(key,value),value)}function intern_delete({_intern,_key},value){const key=_key(value);return _intern.has(key)&&(value=_intern.get(value),_intern.delete(key)),value}function keyof(value){return null!==value&&"object"==typeof value?value.valueOf():value}},"../core/lib/utils/barWidth.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{h:()=>plotDataLengthBarWidth});var ___WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../core/lib/utils/index.js");const plotDataLengthBarWidth=(props,moreProps)=>{const{widthRatio}=props,{xAccessor,xScale,plotData}=moreProps,[l,r]=xScale.range();if(null!=xScale.invert){const[dl,dr]=xScale.domain();if("number"==typeof dl&&"number"==typeof dr){return Math.abs(r-l)/Math.abs(dl-dr)*widthRatio}return(xScale(xAccessor((0,___WEBPACK_IMPORTED_MODULE_0__.HV)(plotData)))-xScale(xAccessor((0,___WEBPACK_IMPORTED_MODULE_0__.$1)(plotData))))/plotData.length*widthRatio*.7}return Math.abs(r-l)/xScale.domain().length*widthRatio}},"../core/lib/utils/noop.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{l:()=>noop});const noop=()=>{}},"../scales/lib/discontinuousTimeScaleProvider.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>discontinuousTimeScaleProvider,L:()=>discontinuousTimeScaleProviderBuilder});var utils=__webpack_require__("../core/lib/utils/index.js"),noop=__webpack_require__("../core/lib/utils/noop.js");var zipper=__webpack_require__("../core/lib/utils/zipper.js"),defaultLocale=__webpack_require__("../../node_modules/d3-time-format/src/defaultLocale.js"),ascending=__webpack_require__("../../node_modules/d3-array/src/ascending.js"),linear=__webpack_require__("../../node_modules/d3-scale/src/linear.js");const defaultFormatters={yearFormat:"%Y",quarterFormat:"%b",monthFormat:"%b",weekFormat:"%e",dayFormat:"%e",hourFormat:"%H:%M",minuteFormat:"%H:%M",secondFormat:"%H:%M:%S",milliSecondFormat:".%L"},levelDefinition=[(d,date,i)=>d.startOfYear&&date.getFullYear()%12==0&&"yearFormat",(d,date,i)=>d.startOfYear&&date.getFullYear()%4==0&&"yearFormat",(d,date,i)=>d.startOfYear&&date.getFullYear()%2==0&&"yearFormat",(d,date,i)=>d.startOfYear&&"yearFormat",(d,date,i)=>d.startOfQuarter&&"quarterFormat",(d,date,i)=>d.startOfMonth&&"monthFormat",(d,date,i)=>d.startOfWeek&&"weekFormat",(d,date,i)=>d.startOfDay&&i%2==0&&"dayFormat",(d,date,i)=>d.startOfDay&&"dayFormat",(d,date,i)=>d.startOfHalfDay&&"hourFormat",(d,date,i)=>d.startOfQuarterDay&&"hourFormat",(d,date,i)=>d.startOfEighthOfADay&&"hourFormat",(d,date,i)=>d.startOfHour&&date.getHours()%2==0&&"hourFormat",(d,date,i)=>d.startOfHour&&"hourFormat",(d,date,i)=>d.startOf30Minutes&&"minuteFormat",(d,date,i)=>d.startOf15Minutes&&"minuteFormat",(d,date,i)=>d.startOf5Minutes&&"minuteFormat",(d,date,i)=>d.startOfMinute&&"minuteFormat",(d,date,i)=>d.startOf30Seconds&&"secondFormat",(d,date,i)=>d.startOf15Seconds&&"secondFormat",(d,date,i)=>d.startOf5Seconds&&"secondFormat",(d,date,i)=>d.startOfSecond&&"secondFormat",(d,date,i)=>"milliSecondFormat"],MAX_LEVEL=levelDefinition.length-1;function financeDiscontinuousScale(index,backingLinearScale=(0,linear.A)()){if(void 0===index)throw new Error("Use the discontinuousTimeScaleProvider to create financeDiscontinuousScale");function scale(newScale){return backingLinearScale(newScale)}return scale.invert=value=>{const inverted=backingLinearScale.invert(value);return Math.round(1e4*inverted)/1e4},scale.domain=newDomain=>void 0===newDomain?backingLinearScale.domain():(backingLinearScale.domain(newDomain),scale),scale.range=range=>void 0===range?backingLinearScale.range():(backingLinearScale.range(range),scale),scale.rangeRound=range=>backingLinearScale.rangeRound(range),scale.clamp=clamp=>void 0===clamp?backingLinearScale.clamp():(backingLinearScale.clamp(clamp),scale),scale.interpolate=interpolate=>void 0===interpolate?backingLinearScale.interpolate():(backingLinearScale.interpolate(interpolate),scale),scale.ticks=m=>{const backingTicks=backingLinearScale.ticks(m),ticksMap=new Map,[domainStart,domainEnd]=backingLinearScale.domain(),dStart=Math.ceil(domainStart),dHead=index[0]?.index,start=Math.max(dStart,dHead)+Math.abs(dHead),end=Math.min(Math.floor(domainEnd),index[index.length-1]?.index)+Math.abs(dHead),desiredTickCount=Math.ceil((end-start)/(domainEnd-domainStart)*backingTicks.length);for(let i=MAX_LEVEL;i>=0;i--){const ticksAtLevel=ticksMap.get(i),temp=void 0===ticksAtLevel?[]:ticksAtLevel.slice();for(let j=start;j<=end;j++)index[j].level===i&&temp.push(index[j]);ticksMap.set(i,temp)}let unsortedTicks=[];for(let k=MAX_LEVEL;k>=0;k--){const selectedTicks=ticksMap.get(k)??[];if(selectedTicks.length+unsortedTicks.length>1.5*desiredTickCount)break;unsortedTicks=unsortedTicks.concat(selectedTicks.map(d=>d.index))}const ticks=unsortedTicks.sort(ascending.A);if(end-start>ticks.length){const ticksSet=new Set(ticks),d=Math.abs(index[0].index),distance=Math.ceil(1.5*(backingTicks.length>0?(backingTicks[backingTicks.length-1]-backingTicks[0])/backingTicks.length/4:1));for(let i=0;i<ticks.length-1;i++)for(let j=i+1;j<ticks.length;j++)ticks[j]-ticks[i]<=distance&&ticksSet.delete(index[ticks[i]+d].level>=index[ticks[j]+d].level?ticks[j]:ticks[i]);return[...ticksSet.values()].map(i=>parseInt(i,10))}return ticks},scale.tickFormat=()=>function(x){const d=Math.abs(index[0].index),{format,date}=index[Math.floor(x+d)];return format(date)},scale.value=x=>{const d=Math.abs(index[0].index),row=index[Math.floor(x+d)];if(void 0!==row){const{date}=row;return date}},scale.nice=count=>(backingLinearScale.nice(count),scale),scale.index=x=>void 0===x?index:(index=x,scale),scale.copy=()=>financeDiscontinuousScale(index,backingLinearScale.copy()),scale}const evaluateLevel=(row,date,i,formatters)=>levelDefinition.map((eachLevel,idx)=>({level:levelDefinition.length-idx-1,format:formatters[eachLevel(row,date,i)]})).find(level=>!!level.format),discontinuousIndexCalculator=function slidingWindow(){let undefinedValue,sourcePath,source,misc,windowSize=10,accumulator=noop.l,skipInitial=0;const slidingWindow=data=>{const sourceFunction=source||(0,utils.Ae)(sourcePath),size=(0,utils.ER)(windowSize).apply(this,arguments),windowData=data.slice(skipInitial,size+skipInitial).map(sourceFunction);let accumulatorIdx=0;const undef=(0,utils.ER)(undefinedValue);return data.map((d,i)=>i<skipInitial+size-1?undef(sourceFunction(d),i,misc):(i>=skipInitial+size&&(windowData.shift(),windowData.push(sourceFunction(d,i))),accumulator(windowData,i,accumulatorIdx++,misc)))};return slidingWindow.undefinedValue=function(x){return arguments.length?(undefinedValue=x,slidingWindow):undefinedValue},slidingWindow.windowSize=function(x){return arguments.length?(windowSize=x,slidingWindow):windowSize},slidingWindow.misc=function(x){return arguments.length?(misc=x,slidingWindow):misc},slidingWindow.accumulator=function(x){return arguments.length?(accumulator=x,slidingWindow):accumulator},slidingWindow.skipInitial=function(x){return arguments.length?(skipInitial=x,slidingWindow):skipInitial},slidingWindow.sourcePath=function(x){return arguments.length?(sourcePath=x,slidingWindow):sourcePath},slidingWindow.source=function(x){return arguments.length?(source=x,slidingWindow):source},slidingWindow}().windowSize(2).undefinedValue((d,idx,{initialIndex,formatters})=>{const i=initialIndex,row={date:d.getTime(),startOfSecond:!1,startOf5Seconds:!1,startOf15Seconds:!1,startOf30Seconds:!1,startOfMinute:!1,startOf5Minutes:!1,startOf15Minutes:!1,startOf30Minutes:!1,startOfHour:!1,startOfEighthOfADay:!1,startOfQuarterDay:!1,startOfHalfDay:!1,startOfDay:!0,startOfWeek:!1,startOfMonth:!1,startOfQuarter:!1,startOfYear:!1},level=evaluateLevel(row,d,i,formatters);return{...row,index:i,...level}}),discontinuousIndexCalculatorLocalTime=discontinuousIndexCalculator.accumulator(([prevDate,nowDate],i,idx,{initialIndex,formatters})=>{const nowSeconds=nowDate.getSeconds(),nowMinutes=nowDate.getMinutes(),nowHours=nowDate.getHours(),nowDay=nowDate.getDay(),nowMonth=nowDate.getMonth(),startOfSecond=nowSeconds!==prevDate.getSeconds(),startOf5Seconds=startOfSecond&&nowSeconds%5==0,startOf15Seconds=startOfSecond&&nowSeconds%15==0,startOf30Seconds=startOfSecond&&nowSeconds%30==0,startOfMinute=nowMinutes!==prevDate.getMinutes(),startOf5Minutes=startOfMinute&&nowMinutes%5<=prevDate.getMinutes()%5,startOf15Minutes=startOfMinute&&nowMinutes%15<=prevDate.getMinutes()%15,startOf30Minutes=startOfMinute&&nowMinutes%30<=prevDate.getMinutes()%30,startOfHour=nowHours!==prevDate.getHours(),startOfEighthOfADay=startOfHour&&nowHours%3==0,startOfQuarterDay=startOfHour&&nowHours%6==0,startOfHalfDay=startOfHour&&nowHours%12==0,startOfDay=nowDay!==prevDate.getDay(),startOfWeek=nowDay<prevDate.getDay(),startOfMonth=nowMonth!==prevDate.getMonth(),startOfQuarter=startOfMonth&&nowMonth%3<=prevDate.getMonth()%3,startOfYear=nowDate.getFullYear()!==prevDate.getFullYear(),row={date:nowDate.getTime(),startOfSecond,startOf5Seconds,startOf15Seconds,startOf30Seconds,startOfMinute,startOf5Minutes,startOf15Minutes,startOf30Minutes,startOfHour,startOfEighthOfADay,startOfQuarterDay,startOfHalfDay,startOfDay,startOfWeek,startOfMonth,startOfQuarter,startOfYear},level=evaluateLevel(row,nowDate,i,formatters);return{...row,index:i+initialIndex,...level}});function createIndex(realDateAccessor,inputDateAccessor,initialIndex,formatters){return function(data){const dateAccessor=realDateAccessor(inputDateAccessor);return{index:discontinuousIndexCalculatorLocalTime.source(dateAccessor).misc({initialIndex,formatters})(data).map(each=>{const{format}=each;return{index:each.index,level:each.level,date:new Date(each.date),format:(0,defaultLocale.DC)(format)}})}}}function discontinuousTimeScaleProviderBuilder(){let withIndex,initialIndex=0,realDateAccessor=d=>d,inputDateAccessor=d=>d.date,indexAccessor=d=>d.idx,indexMutator=(d,idx)=>({...d,idx}),currentFormatters=defaultFormatters;const discontinuousTimeScaleProvider=function(data){let index=withIndex;if(void 0===index){index=createIndex(realDateAccessor,inputDateAccessor,initialIndex,currentFormatters)(data).index}const inputIndex=index,xScale=financeDiscontinuousScale(inputIndex);return{data:(0,zipper.A)().combine(indexMutator)(data,inputIndex),xScale,xAccessor:d=>d&&indexAccessor(d)?.index,displayXAccessor:realDateAccessor(inputDateAccessor)}};return discontinuousTimeScaleProvider.initialIndex=function(x){return arguments.length?(initialIndex=x,discontinuousTimeScaleProvider):initialIndex},discontinuousTimeScaleProvider.inputDateAccessor=function(x){return arguments.length?(inputDateAccessor=x,discontinuousTimeScaleProvider):inputDateAccessor},discontinuousTimeScaleProvider.indexAccessor=function(x){return arguments.length?(indexAccessor=x,discontinuousTimeScaleProvider):indexAccessor},discontinuousTimeScaleProvider.indexMutator=function(x){return arguments.length?(indexMutator=x,discontinuousTimeScaleProvider):indexMutator},discontinuousTimeScaleProvider.withIndex=function(x){return arguments.length?(withIndex=x,discontinuousTimeScaleProvider):withIndex},discontinuousTimeScaleProvider.utc=()=>(realDateAccessor=dateAccessor=>d=>{const date=dateAccessor(d),offsetInMillis=60*date.getTimezoneOffset()*1e3;return new Date(date.getTime()+offsetInMillis)},discontinuousTimeScaleProvider),discontinuousTimeScaleProvider.setLocale=(locale,formatters)=>(void 0!==locale&&(0,defaultLocale.Ay)(locale),void 0!==formatters&&(currentFormatters=formatters),discontinuousTimeScaleProvider),discontinuousTimeScaleProvider.indexCalculator=function(){return createIndex(realDateAccessor,inputDateAccessor,initialIndex,currentFormatters)},discontinuousTimeScaleProvider}const discontinuousTimeScaleProvider=discontinuousTimeScaleProviderBuilder()},"../series/lib/CandlestickSeries.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{H:()=>CandlestickSeries});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/react/jsx-runtime.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../core/lib/GenericChartComponent.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../core/lib/GenericComponent.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../core/lib/utils/index.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../core/lib/utils/barWidth.js"),d3_array__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../node_modules/d3-array/src/group.js"),react__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../node_modules/react/index.js");class CandlestickSeries extends react__WEBPACK_IMPORTED_MODULE_6__.Component{constructor(){super(...arguments),this.drawOnCanvas=(ctx,moreProps)=>{const{candleStrokeWidth=CandlestickSeries.defaultProps.candleStrokeWidth}=this.props,{xScale,chartConfig:{yScale},plotData,xAccessor}=moreProps,candleData=this.getCandleData(xAccessor,xScale,yScale,plotData);(0,d3_array__WEBPACK_IMPORTED_MODULE_5__.Ay)(candleData,d=>d.wick.stroke).forEach((values,key)=>{ctx.fillStyle=key,values.forEach(each=>{const d=each.wick;ctx.fillRect(d.x-.5,d.y1,1,d.y2-d.y1),ctx.fillRect(d.x-.5,d.y3,1,d.y4-d.y3)})});(0,d3_array__WEBPACK_IMPORTED_MODULE_5__.Ay)(candleData,d=>d.stroke,d=>d.fill).forEach((strokeValues,strokeKey)=>{"none"!==strokeKey&&(ctx.strokeStyle=strokeKey,ctx.lineWidth=candleStrokeWidth),strokeValues.forEach((values,key)=>{ctx.fillStyle=key,values.forEach(d=>{d.width<=1?ctx.fillRect(d.x-.5,d.y,1,d.height):0===d.height?ctx.fillRect(d.x-.5,d.y,d.width,1):(ctx.fillRect(d.x-.5,d.y,d.width,d.height),"none"!==strokeKey&&ctx.strokeRect(d.x,d.y,d.width,d.height))})})})},this.getCandleData=(xAccessor,xScale,yScale,plotData)=>{const{fill:fillProp,stroke:strokeProp,yAccessor,wickStroke:wickStrokeProp}=this.props,fill=(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__.ER)(fillProp),stroke=(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__.ER)(strokeProp),wickStroke=(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__.ER)(wickStrokeProp),offset=.5*(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__.ER)(this.props.width)(this.props,{xScale,xAccessor,plotData});return plotData.filter(d=>void 0!==yAccessor(d)).map(d=>{const ohlc=yAccessor(d);if(void 0===ohlc)return;const xValue=xAccessor(d),x=xScale(xValue),y=Math.round(yScale(Math.max(ohlc.open,ohlc.close))),height=Math.max(1,Math.round(Math.abs(yScale(ohlc.open)-yScale(ohlc.close))));return{x:x-offset,y,wick:{stroke:wickStroke(ohlc),x,y1:Math.round(yScale(ohlc.high)),y2:y,y3:y+height,y4:Math.round(yScale(ohlc.low))},height,width:2*offset,fill:fill(ohlc),stroke:stroke(ohlc),direction:ohlc.close-ohlc.open}}).filter(d=>void 0!==d)}}render(){const{clip}=this.props;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_1__.P,{clip,canvasDraw:this.drawOnCanvas,canvasToDraw:_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_2__.WJ,drawOn:["pan"]})}}CandlestickSeries.defaultProps={candleStrokeWidth:.5,clip:!0,fill:d=>d.close>d.open?"#26a69a":"#ef5350",stroke:"none",wickStroke:d=>d.close>d.open?"#26a69a":"#ef5350",width:_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_4__.h,widthRatio:.8,yAccessor:d=>({open:d.open,high:d.high,low:d.low,close:d.close})}},"./src/data/index.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{p:()=>withOHLCData,R:()=>withUpdatingData});var jsx_runtime=__webpack_require__("../../node_modules/react/jsx-runtime.js"),tsv=__webpack_require__("../../node_modules/d3-dsv/src/tsv.js"),defaultLocale=__webpack_require__("../../node_modules/d3-time-format/src/defaultLocale.js"),react=__webpack_require__("../../node_modules/react/index.js");const parseDate=(0,defaultLocale.T6)("%Y-%m-%d"),parseData=()=>d=>{const date=parseDate(d.date);d.date=null===date?new Date(Number(d.date)):new Date(date);for(const key in d)"date"!==key&&Object.prototype.hasOwnProperty.call(d,key)&&(d[key]=+d[key]);return d};function withOHLCData(dataSet="DAILY"){return OriginalComponent=>class WithOHLCData extends react.Component{constructor(props){super(props),this.state={message:`Loading ${dataSet} data...`}}componentDidMount(){fetch(`https://raw.githubusercontent.com/reactivemarkets/react-financial-charts/master/packages/stories/src/data/${dataSet}.tsv`).then(response=>response.text()).then(data=>(0,tsv.Nu)(data,parseData())).then(data=>{this.setState({data})}).catch(()=>{this.setState({message:"Failed to fetch data."})})}render(){const{data,message}=this.state;return void 0===data?(0,jsx_runtime.jsx)("div",{className:"center",children:message}):(0,jsx_runtime.jsx)(OriginalComponent,{...this.props,data})}}}function withUpdatingData(initialLength=120,interval=1e3){return OriginalComponent=>class WithOHLCData extends react.Component{constructor(props){super(props),this.state={data:props.data.slice(0,initialLength),length:initialLength}}componentDidMount(){this.interval=window.setInterval(()=>{const{data}=this.props,{length}=this.state;length<data.length?this.setState({data:data.slice(0,length+1),length:length+1}):window.clearInterval(this.interval)},interval)}componentWillUnmount(){window.clearInterval(this.interval)}render(){const{data}=this.state;return(0,jsx_runtime.jsx)(OriginalComponent,{...this.props,data})}}}},"./src/features/interaction/index.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{__namedExportsOrder:()=>__namedExportsOrder,clamp:()=>clamp,default:()=>index_stories,disable:()=>disable,disablePan:()=>disablePan,disableZoom:()=>disableZoom,zoomAnchorToBounds:()=>zoomAnchorToBounds,zoomAnchorToLastVisible:()=>zoomAnchorToLastVisible,zoomAnchorToMouse:()=>zoomAnchorToMouse});var jsx_runtime=__webpack_require__("../../node_modules/react/jsx-runtime.js"),zoomBehavior=__webpack_require__("../core/lib/zoom/zoomBehavior.js"),src_extent=__webpack_require__("../../node_modules/d3-array/src/extent.js"),min=__webpack_require__("../../node_modules/d3-array/src/min.js"),max=__webpack_require__("../../node_modules/d3-array/src/max.js"),react=__webpack_require__("../../node_modules/react/index.js"),react_dom=__webpack_require__("../../node_modules/react-dom/index.js");const shallowEqual=(a,b)=>{if(a===b)return!0;if(!(a instanceof Object&&b instanceof Object))return!1;const keys=Object.keys(a),length=keys.length;for(let i=0;i<length;i++)if(!(keys[i]in b))return!1;for(let i=0;i<length;i++)if(a[keys[i]]!==b[keys[i]])return!1;return length===Object.keys(b).length},identity=d=>d,functor=v=>"function"==typeof v?v:()=>v;function d3Window(node){return node&&(node.ownerDocument&&node.ownerDocument.defaultView||node.document&&node||node.defaultView)}const MOUSEMOVE="mousemove.pan",MOUSEUP="mouseup.pan",TOUCHEND="touchend.pan touchcancel.pan";function getTouchProps(touch){return{pageX:touch.pageX,pageY:touch.pageY,clientX:touch.clientX,clientY:touch.clientY}}function head(array,accessor){if(accessor&&array){let value;for(let i=0;i<array.length;i++)if(value=array[i],isDefined(accessor(value)))return value;return}return array?array[0]:void 0}function utils_last(array,accessor){if(accessor&&array){let value;for(let i=array.length-1;i>=0;i--)if(value=array[i],isDefined(accessor(value)))return value;return}const length=array?array.length:0;return length?array[length-1]:void 0}const isDefined=d=>null!=d;function isNotDefined(d){return!isDefined(d)}function touchPosition(touch,e){const container=e.currentTarget,rect=container.getBoundingClientRect(),x=touch.clientX-rect.left-container.clientLeft,y=touch.clientY-rect.top-container.clientTop;return[Math.round(x),Math.round(y)]}function mousePosition(e,defaultRect){const container=e.currentTarget,rect=defaultRect??container.getBoundingClientRect(),x=e.clientX-rect.left-container.clientLeft,y=e.clientY-rect.top-container.clientTop;return[Math.round(x),Math.round(y)]}function clearCanvas(canvasList,ratio){canvasList.forEach(each=>{each.setTransform(1,0,0,1,0,0),each.clearRect(-1,-1,each.canvas.width+2,each.canvas.height+2),each.scale(ratio,ratio)})}var linear=__webpack_require__("../../node_modules/d3-scale/src/linear.js"),lodash_flattendeep=__webpack_require__("../../node_modules/lodash.flattendeep/index.js"),lodash_flattendeep_default=__webpack_require__.n(lodash_flattendeep);const getClosestItemIndexes=(array,value,accessor)=>{let lo=0,hi=array.length-1;for(;hi-lo>1;){const mid=Math.round((lo+hi)/2);accessor(array[mid])<=value?lo=mid:hi=mid}const lowItemValue=accessor(array[lo]),highItemValue=accessor(array[hi]);return lowItemValue?.valueOf()===value?.valueOf()&&(hi=lo),highItemValue?.valueOf()===value?.valueOf()&&(lo=hi),lowItemValue<value&&highItemValue<value&&(lo=hi),lowItemValue>value&&highItemValue>value&&(hi=lo),{left:lo,right:hi}},ChartDefaultConfig={flipYScale:!1,id:0,origin:[0,0],padding:0,yPan:!0,yPanEnabled:!1,yScale:(0,linear.A)()};function values(func){return d=>{const obj=func(d);return function isObject(d){return isDefined(d)&&"object"==typeof d&&!Array.isArray(d)}(obj)?function mapObject(object={},iteratee=x=>x){const props=Object.keys(object),result=new Array(props.length);return props.forEach((key,index)=>{result[index]=iteratee(object[key],key,object)}),result}(obj):obj}}function isArraySize2AndNumber(yExtentsProp){if(Array.isArray(yExtentsProp)&&2===yExtentsProp.length){const[a,b]=yExtentsProp;return"number"==typeof a&&"number"==typeof b}return!1}function getNewChartConfig(innerDimension,children,existingChartConfig=[]){return react.Children.map(children,each=>{if(!each||(void 0===(props=each.props)||void 0===props.id))return;var props;const chartProps={...ChartDefaultConfig,...each.props},{id,origin,padding,yExtents:yExtentsProp,yScale:yScaleProp=ChartDefaultConfig.yScale,flipYScale,yExtentsCalculator}=chartProps,yScale=yScaleProp.copy(),{width,height,availableHeight}=function getDimensions({width,height},chartProps){return{availableHeight:height,width,height:chartProps.height||height}}(innerDimension,chartProps),{yPan}=chartProps;let{yPanEnabled}=chartProps;const yExtents=yExtentsProp?(Array.isArray(yExtentsProp)?yExtentsProp:[yExtentsProp]).map(functor):void 0,prevChartConfig=existingChartConfig.find(d=>d.id===id);if(isArraySize2AndNumber(yExtentsProp))if(prevChartConfig&&prevChartConfig.yPan&&prevChartConfig.yPanEnabled&&yPan&&yPanEnabled&&shallowEqual(prevChartConfig.originalYExtentsProp,yExtentsProp))yScale.domain(prevChartConfig.yScale.domain());else{const[a,b]=yExtentsProp;yScale.domain([a,b])}else prevChartConfig&&prevChartConfig.yPanEnabled&&(isArraySize2AndNumber(prevChartConfig.originalYExtentsProp)||(yScale.domain(prevChartConfig.yScale.domain()),yPanEnabled=!0));return{id,origin:functor(origin)(width,availableHeight),padding,originalYExtentsProp:yExtentsProp,yExtents,yExtentsCalculator,flipYScale,yScale,yPan,yPanEnabled,width,height}}).filter(each=>void 0!==each)}function getCurrentCharts(chartConfig,mouseXY){return chartConfig.filter(eachConfig=>{const top=eachConfig.origin[1],bottom=top+eachConfig.height;return mouseXY[1]>top&&mouseXY[1]<bottom}).map(config=>config.id)}function getChartConfigWithUpdatedYScales(chartConfig,{plotData,xAccessor,displayXAccessor,fullData},xDomain,dy,chartsToPan){const yDomains=chartConfig.map(({yExtentsCalculator,yExtents,yScale})=>{const realYDomain=yExtentsCalculator?yExtentsCalculator({plotData,xDomain,xAccessor,displayXAccessor,fullData}):function yDomainFromYExtents(yExtents,yScale,plotData){const yValues=yExtents.map(eachExtent=>plotData.map(values(eachExtent))),allYValues=lodash_flattendeep_default()(yValues);return yScale.invert?(0,src_extent.A)(allYValues):[...new Set(allYValues).values()]}(yExtents,yScale,plotData);return{realYDomain,yDomainDY:void 0!==dy?yScale.range().map(each=>each-dy).map(yScale.invert):yScale.domain(),prevYDomain:yScale.domain()}}),combine=function zipper(){let combine=identity;function zip(){const n=arguments.length;if(0===n)return[];const m=(0,min.A)(arguments,d3_zipLength)??0,zips=new Array(m);for(let i=-1;++i<m;){for(let j=-1,zip=zips[i]=new Array(n);++j<n;)zip[j]=arguments[j][i];zips[i]=combine.apply(this,zips[i])}return zips}function d3_zipLength(d){return d.length}return zip.combine=function(x){return arguments.length?(combine=x,zip):combine},zip}().combine((config,{realYDomain,yDomainDY,prevYDomain})=>{const{id,padding,height,yScale,yPan,flipYScale,yPanEnabled=!1}=config,another=void 0===chartsToPan||chartsToPan.indexOf(id)>-1,domain=yPan&&yPanEnabled?another?yDomainDY:prevYDomain:realYDomain,newYScale=function setRange(scale,height,padding,flipYScale){if(scale.rangeRoundPoints||isNotDefined(scale.invert)){if(isNaN(padding))throw new Error("padding has to be a number for ordinal scale");scale.rangeRoundPoints&&scale.rangeRoundPoints(flipYScale?[0,height]:[height,0],padding),scale.rangeRound&&scale.range(flipYScale?[0,height]:[height,0]).padding(padding)}else{const{top,bottom}=isNaN(padding)?padding:{top:padding,bottom:padding};scale.range(flipYScale?[top,height-bottom]:[height-bottom,top])}return scale}(yScale.copy().domain(domain),height,padding,flipYScale);return{...config,yScale:newYScale,realYDomain}});return combine(chartConfig,yDomains)}function getCurrentItem(xScale,xAccessor,mouseXY,plotData){let xValue,item;if(xScale.invert)xValue=xScale.invert(mouseXY[0]),item=((array,value,accessor)=>{const{left,right}=getClosestItemIndexes(array,value,accessor);if(left===right)return array[left];const leftItem=accessor(array[left]),rightItem=accessor(array[right]);return Math.abs(leftItem.valueOf()-value.valueOf())<Math.abs(rightItem.valueOf()-value.valueOf())?array[left]:array[right]})(plotData,xValue,xAccessor);else{const dr=xScale.range().map((d,idx)=>({x:Math.abs(d-mouseXY[0]),idx})).reduce((a,b)=>a.x<b.x?a:b);item=void 0!==dr?plotData[dr.idx]:plotData[0]}return item}var src_select=__webpack_require__("../../node_modules/d3-selection/src/select.js"),pointer=__webpack_require__("../../node_modules/d3-selection/src/pointer.js"),pointers=__webpack_require__("../../node_modules/d3-selection/src/pointers.js");class EventCapture extends react.Component{constructor(props){super(props),this.dx=0,this.dy=0,this.mouseInside=!1,this.mouseInteraction=!0,this.ref=react.createRef(),this.handleEnter=e=>{const{onMouseEnter}=this.props;if(void 0!==onMouseEnter){if(this.mouseInside=!0,!this.state.panInProgress&&!this.state.dragInProgress){const win=d3Window(this.ref.current);(0,src_select.A)(win).on(MOUSEMOVE,this.handleMouseMove)}onMouseEnter(e)}},this.handleLeave=e=>{const{onMouseLeave}=this.props;if(void 0!==onMouseLeave){if(this.mouseInside=!1,!this.state.panInProgress&&!this.state.dragInProgress){const win=d3Window(this.ref.current);(0,src_select.A)(win).on(MOUSEMOVE,null)}onMouseLeave(e)}},this.handleWheel=e=>{const{pan,onPan,zoom,onZoom}=this.props;if(!pan&&!zoom)return;const{panInProgress}=this.state,yZoom=Math.abs(e.deltaY)>Math.abs(e.deltaX)&&Math.abs(e.deltaY)>0,mouseXY=mousePosition(e);if(e.preventDefault(),zoom&&this.focus&&yZoom&&!panInProgress){const zoomDir=e.deltaY>0?1:-1;void 0!==onZoom&&(0,react_dom.flushSync)(()=>{onZoom(zoomDir,mouseXY,e)})}else if(this.focus){if(this.shouldPan()&&void 0!==this.state.panStart){const{panStartXScale,chartsToPan}=this.state.panStart;this.lastNewPos=mouseXY,this.panHappened=!0,void 0===this.dx&&(this.dx=0),void 0===this.dy&&(this.dy=0),this.dx-=e.deltaX,this.dy+=e.deltaY;const dxdy={dx:this.dx,dy:this.dy};void 0!==onPan&&onPan(mouseXY,panStartXScale,dxdy,chartsToPan,e)}else{const{xScale,chartConfig}=this.props,currentCharts=getCurrentCharts(chartConfig,mouseXY);this.dx=0,this.dy=0,react.startTransition(()=>{this.setState({panInProgress:!0,panStart:{panStartXScale:xScale,panOrigin:mouseXY,chartsToPan:currentCharts}})})}this.queuePanEnd(e)}},this.handleMouseMove=e=>{const{onMouseMove,mouseMove}=this.props;if(void 0!==onMouseMove&&this.mouseInteraction&&mouseMove&&!this.state.panInProgress){onMouseMove((0,pointer.A)(e,this.ref.current),"mouse",e)}},this.handleClick=e=>{const mouseXY=mousePosition(e),{onClick,onDoubleClick}=this.props;this.panHappened||this.dragHappened||(this.clicked&&void 0!==onDoubleClick?(onDoubleClick(mouseXY,e),this.clicked=!1):void 0!==onClick&&(onClick(mouseXY,e),this.clicked=!0,setTimeout(()=>{this.clicked&&(this.clicked=!1)},400)))},this.handleRightClick=e=>{e.stopPropagation(),e.preventDefault();const{onContextMenu,onPanEnd}=this.props,mouseXY=mousePosition(e,this.ref.current.getBoundingClientRect());if(void 0!==this.state.panStart){const{panStartXScale,panOrigin:[dx,dy],chartsToPan}=this.state.panStart;this.panHappened&&void 0!==onPanEnd&&onPanEnd(mouseXY,panStartXScale,{dx,dy},chartsToPan,e);const win=d3Window(this.ref.current);(0,src_select.A)(win).on(MOUSEMOVE,null).on(MOUSEUP,null),this.setState({panInProgress:!1,panStart:void 0})}void 0!==onContextMenu&&onContextMenu(mouseXY,e)},this.handleDrag=e=>{const{onDrag}=this.props;if(void 0===onDrag)return;this.dragHappened=!0;const{dragStartPosition}=this.state;if(void 0===dragStartPosition)return;onDrag({startPos:dragStartPosition,mouseXY:(0,pointer.A)(e,this.ref.current)},e)},this.handleDragEnd=e=>{const mouseXY=(0,pointer.A)(e,this.ref.current),win=d3Window(this.ref.current);if((0,src_select.A)(win).on(MOUSEMOVE,this.mouseInside?this.handleMouseMove:null).on(MOUSEUP,null),this.dragHappened){const{onDragComplete}=this.props;void 0!==onDragComplete&&onDragComplete({mouseXY},e)}this.setState({dragInProgress:!1}),this.mouseInteraction=!0},this.canPan=()=>{const{getAllPanConditions}=this.props,{pan:initialPanEnabled}=this.props,{panEnabled,draggable:somethingSelected}=getAllPanConditions().reduce((returnObj,a)=>({draggable:returnObj.draggable||a.draggable,panEnabled:returnObj.panEnabled&&a.panEnabled}),{draggable:!1,panEnabled:initialPanEnabled});return{panEnabled,somethingSelected}},this.handleMouseDown=e=>{if(0!==e.button)return;const{xScale,chartConfig,onMouseDown}=this.props;if(this.panHappened=!1,this.dragHappened=!1,this.focus=!0,!this.state.panInProgress&&this.mouseInteraction){const mouseXY=mousePosition(e),currentCharts=getCurrentCharts(chartConfig,mouseXY),{panEnabled,somethingSelected}=this.canPan(),pan=panEnabled&&!somethingSelected;if(pan){react.startTransition(()=>{this.setState({panInProgress:pan,panStart:{panStartXScale:xScale,panOrigin:mouseXY,chartsToPan:currentCharts}})});const win=d3Window(this.ref.current);(0,src_select.A)(win).on(MOUSEMOVE,this.handlePan).on(MOUSEUP,this.handlePanEnd)}else if(somethingSelected){react.startTransition(()=>{this.setState({panInProgress:!1,dragInProgress:!0,panStart:void 0,dragStartPosition:mouseXY})});const{onDragStart}=this.props;void 0!==onDragStart&&onDragStart({startPos:mouseXY},e);const win=d3Window(this.ref.current);(0,src_select.A)(win).on(MOUSEMOVE,this.handleDrag).on(MOUSEUP,this.handleDragEnd)}void 0!==onMouseDown&&onMouseDown(mouseXY,currentCharts,e)}e.preventDefault()},this.shouldPan=()=>{const{pan:panEnabled,onPan}=this.props;return panEnabled&&onPan&&void 0!==this.state.panStart},this.handlePan=e=>{if(this.shouldPan()&&void 0!==this.state.panStart){this.panHappened=!0;const{panStartXScale,panOrigin,chartsToPan}=this.state.panStart;let dx,dy,mouseXY;this.mouseInteraction?(mouseXY=(0,pointer.A)(e,this.ref.current),this.lastNewPos=mouseXY,dx=mouseXY[0]-panOrigin[0],dy=mouseXY[1]-panOrigin[1]):(mouseXY=(0,pointers.A)(e,this.ref.current)[0],this.lastNewPos=mouseXY,dx=panOrigin[0]-mouseXY[0],dy=panOrigin[1]-mouseXY[1]),this.dx=dx,this.dy=dy;const{onPan}=this.props;void 0!==onPan&&onPan(mouseXY,panStartXScale,{dx,dy},chartsToPan,e)}},this.handlePanEnd=e=>{const{pan:panEnabled,onPanEnd}=this.props;if(void 0!==this.state.panStart){const{panStartXScale,chartsToPan}=this.state.panStart,win=d3Window(this.ref.current);if((0,src_select.A)(win).on(MOUSEMOVE,this.mouseInside?this.handleMouseMove:null).on(MOUSEUP,null).on("touchmove.pan",null).on(TOUCHEND,null),this.panHappened&&panEnabled&&onPanEnd){const{dx=0,dy=0}=this;delete this.dx,delete this.dy,void 0!==this.lastNewPos&&onPanEnd(this.lastNewPos,panStartXScale,{dx,dy},chartsToPan,e)}react.startTransition(()=>{this.setState({panInProgress:!1,panStart:void 0})})}},this.handleTouchMove=e=>{const{onMouseMove}=this.props;if(void 0===onMouseMove)return;onMouseMove(touchPosition(getTouchProps(e.touches[0]),e),"touch",e)},this.handleTouchStart=e=>{this.mouseInteraction=!1;const{pan:panEnabled,chartConfig,onMouseMove,xScale,onPanEnd}=this.props;if(1===e.touches.length){this.panHappened=!1;const touchXY=touchPosition(getTouchProps(e.touches[0]),e);if(void 0!==onMouseMove&&onMouseMove(touchXY,"touch",e),panEnabled){const currentCharts=getCurrentCharts(chartConfig,touchXY);this.setState({panInProgress:!0,panStart:{panStartXScale:xScale,panOrigin:touchXY,chartsToPan:currentCharts}});const win=d3Window(this.ref.current);(0,src_select.A)(win).on("touchmove.pan",this.handlePan,!1).on(TOUCHEND,this.handlePanEnd,!1)}}else if(2===e.touches.length){const{panInProgress,panStart}=this.state;if(panInProgress&&panEnabled&&onPanEnd&&void 0!==panStart){const{panStartXScale,panOrigin:[dx,dy],chartsToPan}=panStart,win=d3Window(this.ref.current);(0,src_select.A)(win).on(MOUSEMOVE,this.mouseInside?this.handleMouseMove:null).on(MOUSEUP,null).on("touchmove.pan",this.handlePinchZoom,!1).on(TOUCHEND,this.handlePinchZoomEnd,!1);const touch1Pos=touchPosition(getTouchProps(e.touches[0]),e),touch2Pos=touchPosition(getTouchProps(e.touches[1]),e);this.panHappened&&panEnabled&&onPanEnd&&void 0!==this.lastNewPos&&onPanEnd(this.lastNewPos,panStartXScale,{dx,dy},chartsToPan,e),this.setState({panInProgress:!1,pinchZoomStart:{xScale,touch1Pos,touch2Pos,range:xScale.range(),chartsToPan}})}}},this.handlePinchZoom=e=>{const{pinchZoomStart}=this.state;if(void 0===pinchZoomStart)return;const{xScale,zoom:zoomEnabled,onPinchZoom}=this.props;if(!zoomEnabled||void 0===onPinchZoom)return;const[touch1Pos,touch2Pos]=(0,pointers.A)(this.ref.current),{chartsToPan,...initialPinch}=pinchZoomStart;onPinchZoom(initialPinch,{touch1Pos,touch2Pos,xScale},e)},this.handlePinchZoomEnd=e=>{const win=d3Window(this.ref.current);(0,src_select.A)(win).on("touchmove.pan",null).on(TOUCHEND,null);const{pinchZoomStart}=this.state;if(void 0===pinchZoomStart)return;const{chartsToPan,...initialPinch}=pinchZoomStart,{zoom:zoomEnabled,onPinchZoomEnd}=this.props;zoomEnabled&&onPinchZoomEnd&&onPinchZoomEnd(initialPinch,e),this.setState({pinchZoomStart:void 0})},this.setCursorClass=cursorOverrideClass=>{cursorOverrideClass!==this.state.cursorOverrideClass&&this.setState({cursorOverrideClass:null===cursorOverrideClass?void 0:cursorOverrideClass})},this.focus=props.focus,this.state={panInProgress:!1}}componentDidMount(){const{disableInteraction}=this.props,{current}=this.ref;null!==current&&(disableInteraction||((0,src_select.A)(current).on("mouseenter.interaction",this.handleEnter).on("mouseleave.interaction",this.handleLeave),current.addEventListener("wheel",this.handleWheel,{passive:!1})))}componentDidUpdate(){this.componentDidMount()}componentWillUnmount(){const{disableInteraction}=this.props,{current}=this.ref;if(null!==current&&!disableInteraction){(0,src_select.A)(current).on("mouseenter.interaction",null).on("mouseleave.interaction",null);const win=d3Window(current);(0,src_select.A)(win).on(MOUSEMOVE,null),current.removeEventListener("wheel",this.handleWheel,{passive:!1})}}queuePanEnd(e){void 0!==this.panEndTimeout&&window.clearTimeout(this.panEndTimeout),this.panEndTimeout=window.setTimeout(()=>{this.handlePanEnd(e)},100)}cancelDrag(){const win=d3Window(this.ref.current);(0,src_select.A)(win).on(MOUSEMOVE,this.mouseInside?this.handleMouseMove:null).on(MOUSEUP,null),this.setState({dragInProgress:!1}),this.mouseInteraction=!0}render(){const{height,width,disableInteraction,useCrossHairStyleCursor}=this.props,className=disableInteraction?void 0:void 0!==this.state.cursorOverrideClass?this.state.cursorOverrideClass:useCrossHairStyleCursor?this.state.panInProgress?"react-financial-charts-grabbing-cursor":"react-financial-charts-crosshair-cursor":void 0,interactionProps=disableInteraction?void 0:{onMouseDown:this.handleMouseDown,onClick:this.handleClick,onContextMenu:this.handleRightClick,onTouchStart:this.handleTouchStart,onTouchMove:this.handleTouchMove};return(0,jsx_runtime.jsx)("rect",{ref:this.ref,className,width,height,style:{opacity:0},...interactionProps})}}EventCapture.defaultProps={mouseMove:!1,zoom:!1,pan:!1,panSpeedMultiplier:1,focus:!1,disableInteraction:!1};class CanvasContainer extends react.PureComponent{constructor(){super(...arguments),this.bgRef=react.createRef(),this.axesRef=react.createRef(),this.mouseRef=react.createRef()}getCanvasContexts(){return{bg:this.bgRef.current?.getContext("2d")??void 0,axes:this.axesRef.current?.getContext("2d")??void 0,mouseCoord:this.mouseRef.current?.getContext("2d")??void 0}}render(){const{height,ratio,style,width}=this.props,adjustedWidth=width*ratio,adjustedHeight=height*ratio,canvasStyle={position:"absolute",width,height};return(0,jsx_runtime.jsxs)("div",{style:{...style,position:"absolute"},children:[(0,jsx_runtime.jsx)("canvas",{ref:this.bgRef,width:adjustedWidth,height:adjustedHeight,style:canvasStyle}),(0,jsx_runtime.jsx)("canvas",{ref:this.axesRef,width:adjustedWidth,height:adjustedHeight,style:canvasStyle}),(0,jsx_runtime.jsx)("canvas",{ref:this.mouseRef,width:adjustedWidth,height:adjustedHeight,style:canvasStyle})]})}}function getNewEnd(fallbackEnd,xAccessor,initialXScale,start){const{lastItem,lastItemX}=fallbackEnd,lastItemXValue=xAccessor(lastItem),[rangeStart,rangeEnd]=initialXScale.range();return(rangeEnd-rangeStart)/(lastItemX.valueOf()-rangeStart)*(lastItemXValue.valueOf()-start.valueOf())+start.valueOf()}function extentsWrapper(useWholeData,clamp,pointsPerPxThreshold,minPointsPerPxThreshold,flipXScale){return{filterData:function filterData(data,inputDomain,xAccessor,initialXScale,{currentPlotData,currentDomain,fallbackStart,fallbackEnd,ignoreThresholds=!1}={}){if(useWholeData)return{plotData:data,domain:inputDomain};let left=head(inputDomain),right=utils_last(inputDomain),clampedDomain=inputDomain,filteredData=getFilteredResponse(data,left,right,xAccessor);1===filteredData.length&&void 0!==fallbackStart&&(left=fallbackStart,right=getNewEnd(fallbackEnd,xAccessor,initialXScale,left),clampedDomain=[left,right],filteredData=getFilteredResponse(data,left,right,xAccessor)),"function"==typeof clamp?clampedDomain=clamp(clampedDomain,[xAccessor(head(data)),xAccessor(utils_last(data))]):("left"!==clamp&&"both"!==clamp&&!0!==clamp||(clampedDomain=[(0,max.A)([left,xAccessor(head(data))]),clampedDomain[1]]),"right"!==clamp&&"both"!==clamp&&!0!==clamp||(clampedDomain=[clampedDomain[0],(0,min.A)([right,xAccessor(utils_last(data))])])),clampedDomain!==inputDomain&&(filteredData=getFilteredResponse(data,clampedDomain[0],clampedDomain[1],xAccessor));const realInputDomain=clampedDomain,xScale=initialXScale.copy().domain(realInputDomain);let plotData,domain,width=Math.floor(xScale(xAccessor(utils_last(filteredData)))-xScale(xAccessor(head(filteredData))));flipXScale&&width<0&&(width*=-1);const chartWidth=utils_last(xScale.range())-head(xScale.range());if(ignoreThresholds&&filteredData.length>1||function canShowTheseManyPeriods(width,arrayLength,maxThreshold,minThreshold){const widthAdjustedMinThreshold=function showMinThreshold(width,threshold){return Math.max(1,Math.ceil(width*threshold))}(width,minThreshold),widthAdjustedMaxTheshold=showMaxThreshold(width,maxThreshold);return arrayLength>=widthAdjustedMinThreshold&&arrayLength<widthAdjustedMaxTheshold}(width,filteredData.length,pointsPerPxThreshold,minPointsPerPxThreshold))plotData=filteredData,domain=realInputDomain;else if(chartWidth>showMaxThreshold(width,pointsPerPxThreshold)&&isDefined(fallbackEnd)){plotData=filteredData;const newEnd=getNewEnd(fallbackEnd,xAccessor,initialXScale,head(realInputDomain));domain=[head(realInputDomain),newEnd]}else plotData=currentPlotData??filteredData.slice(filteredData.length-function showMax(width,threshold){return Math.floor(.97*showMaxThreshold(width,threshold))}(width,pointsPerPxThreshold)),domain=currentDomain??[xAccessor(head(plotData)),xAccessor(utils_last(plotData))];return{plotData,domain}}}}function showMaxThreshold(width,threshold){return Math.floor(width*threshold)}function getFilteredResponse(data,left,right,xAccessor){const newLeftIndex=getClosestItemIndexes(data,left,xAccessor).left,newRightIndex=getClosestItemIndexes(data,right,xAccessor).right;return data.slice(newLeftIndex,newRightIndex+1)}const CANDIDATES_FOR_RESET=["seriesName"],noop=()=>{},chartCanvasContextDefaultValue={amIOnTop:()=>!1,chartConfigs:[],chartId:0,ratio:0,displayXAccessor:()=>0,fullData:[],getMutableState:()=>({}),height:0,margin:{top:0,right:0,bottom:0,left:0},plotData:[],setCursorClass:noop,subscribe:noop,unsubscribe:noop,redraw:noop,width:0,xAccessor:()=>0,xScale:noop},ChartCanvasContext=react.createContext(chartCanvasContextDefaultValue),ChartCanvas_getDimensions=props=>{const{margin,height,width}=props;return{height:height-margin.top-margin.bottom,width:width-margin.left-margin.right}},getXScaleDirection=flipXScale=>flipXScale?-1:1,calculateFullData=props=>{const{data:fullData,plotFull,xScale,clamp,pointsPerPxThreshold,flipXScale,xAccessor,displayXAccessor,minPointsPerPxThreshold}=props,useWholeData=void 0!==plotFull?plotFull:xAccessor===identity,{filterData}=function evaluator({xScale,useWholeData,clamp,pointsPerPxThreshold,minPointsPerPxThreshold,flipXScale}){return extentsWrapper(useWholeData||isNotDefined(xScale.invert),clamp,pointsPerPxThreshold,minPointsPerPxThreshold,flipXScale)}({xScale,useWholeData,clamp,pointsPerPxThreshold,minPointsPerPxThreshold,flipXScale});return{xAccessor,displayXAccessor:displayXAccessor??xAccessor,xScale:xScale.copy(),fullData,filterData}},resetChart=props=>{const state=calculateState(props),{xAccessor,displayXAccessor,fullData,plotData:initialPlotData,xScale}=state,{postCalculator,children}=props,plotData=void 0!==postCalculator?postCalculator(initialPlotData):initialPlotData,chartConfigs=getChartConfigWithUpdatedYScales(getNewChartConfig(ChartCanvas_getDimensions(props),children),{plotData,xAccessor,displayXAccessor,fullData},xScale.domain());return{...state,xScale,plotData,chartConfigs}},calculateState=props=>{const{xAccessor:inputXAccessor,xExtents:xExtentsProp,data,padding,flipXScale}=props,direction=getXScaleDirection(flipXScale),dimensions=ChartCanvas_getDimensions(props),extent="function"==typeof xExtentsProp?xExtentsProp(data):(0,src_extent.A)(xExtentsProp.map(d=>functor(d)).map(each=>each(data,inputXAccessor))),{xAccessor,displayXAccessor,xScale,fullData,filterData}=calculateFullData(props),updatedXScale=setXRange(xScale,dimensions,padding,direction),{plotData,domain}=filterData(fullData,extent,inputXAccessor,updatedXScale);return{plotData,xScale:updatedXScale.domain(domain),xAccessor,displayXAccessor,fullData,filterData}},setXRange=(xScale,dimensions,padding,direction=1)=>{if(xScale.rangeRoundPoints){if(isNaN(padding))throw new Error("padding has to be a number for ordinal scale");xScale.rangeRoundPoints([0,dimensions.width],padding)}else if(xScale.padding){if(isNaN(padding))throw new Error("padding has to be a number for ordinal scale");xScale.range([0,dimensions.width]),xScale.padding(padding/2)}else{const{left,right}=isNaN(padding)?padding:{left:padding,right:padding};direction>0?xScale.range([left,dimensions.width-right]):xScale.range([dimensions.width-right,left])}return xScale},pinchCoordinates=pinch=>{const{touch1Pos,touch2Pos}=pinch;return{topLeft:[Math.min(touch1Pos[0],touch2Pos[0]),Math.min(touch1Pos[1],touch2Pos[1])],bottomRight:[Math.max(touch1Pos[0],touch2Pos[0]),Math.max(touch1Pos[1],touch2Pos[1])]}},isInteractionEnabled=(xScale,xAccessor,data)=>!isNaN(xScale(xAccessor(head(data))))&&isDefined(xScale.invert);class ChartCanvas extends react.Component{constructor(props){super(props),this.canvasContainerRef=react.createRef(),this.eventCaptureRef=react.createRef(),this.lastSubscriptionId=0,this.mutableState={mouseXY:[0,0],currentCharts:[],currentItem:null},this.panInProgress=!1,this.subscriptions=[],this.isStrictMode=!1,this.strictModeRenderCount=0,this.canvasUpdateQueue=[],this.isProcessingQueue=!1,this.getMutableState=()=>this.mutableState,this.getCanvasContexts=()=>this.canvasContainerRef.current?.getCanvasContexts(),this.generateSubscriptionId=()=>(this.lastSubscriptionId++,this.lastSubscriptionId),this.subscribe=(id,rest)=>{const{getPanConditions=functor({draggable:!1,panEnabled:!0})}=rest;this.subscriptions=this.subscriptions.concat({id,...rest,getPanConditions})},this.unsubscribe=id=>{this.subscriptions=this.subscriptions.filter(each=>each.id!==id)},this.getAllPanConditions=()=>this.subscriptions.map(each=>each.getPanConditions()),this.setCursorClass=className=>{this.eventCaptureRef.current?.setCursorClass(className)},this.amIOnTop=id=>{const dragableComponents=this.subscriptions.filter(each=>each.getPanConditions().draggable);return dragableComponents.length>0&&utils_last(dragableComponents).id===id},this.handleContextMenu=(mouseXY,e)=>{const{xAccessor,chartConfigs,plotData,xScale}=this.state,currentCharts=getCurrentCharts(chartConfigs,mouseXY),currentItem=getCurrentItem(xScale,xAccessor,mouseXY,plotData);this.triggerEvent("contextmenu",{mouseXY,currentItem,currentCharts},e)},this.calculateStateForDomain=newDomain=>{const{xAccessor,displayXAccessor,xScale:initialXScale,chartConfigs:initialChartConfig,plotData:initialPlotData}=this.state,{filterData,fullData}=this.state,{postCalculator=ChartCanvas.defaultProps.postCalculator}=this.props,{plotData:beforePlotData,domain}=filterData(fullData,newDomain,xAccessor,initialXScale,{currentPlotData:initialPlotData,currentDomain:initialXScale.domain()}),plotData=postCalculator(beforePlotData),updatedScale=initialXScale.copy().domain(domain),chartConfigs=getChartConfigWithUpdatedYScales(initialChartConfig,{plotData,xAccessor,displayXAccessor,fullData},updatedScale.domain());return{xScale:updatedScale,plotData,chartConfigs}},this.pinchZoomHelper=(initialPinch,finalPinch)=>{const{xScale:initialPinchXScale}=initialPinch,{xScale:initialXScale,chartConfigs:initialChartConfig,plotData:initialPlotData,xAccessor,displayXAccessor,filterData,fullData}=this.state,{postCalculator=ChartCanvas.defaultProps.postCalculator}=this.props,{topLeft:iTL,bottomRight:iBR}=pinchCoordinates(initialPinch),{topLeft:fTL,bottomRight:fBR}=pinchCoordinates(finalPinch),e=initialPinchXScale.range()[1],xDash=Math.round(-(iBR[0]*fTL[0]-iTL[0]*fBR[0])/(iTL[0]-iBR[0])),yDash=Math.round(e+((e-iBR[0])*(e-fTL[0])-(e-iTL[0])*(e-fBR[0]))/(e-iTL[0]-(e-iBR[0]))),newDomain=[Math.round(-xDash*iTL[0]/(-xDash+fTL[0])),Math.round(e-(yDash-e)*(e-iTL[0])/(yDash+(e-fTL[0])))].map(initialPinchXScale.invert),{plotData:beforePlotData,domain}=filterData(fullData,newDomain,xAccessor,initialPinchXScale,{currentPlotData:initialPlotData,currentDomain:initialXScale.domain()}),plotData=postCalculator(beforePlotData),updatedScale=initialXScale.copy().domain(domain),mouseXY=finalPinch.touch1Pos;return{chartConfigs:getChartConfigWithUpdatedYScales(initialChartConfig,{plotData,xAccessor,displayXAccessor,fullData},updatedScale.domain()),xScale:updatedScale,plotData,mouseXY,currentItem:getCurrentItem(updatedScale,xAccessor,mouseXY,plotData),xAccessor,fullData}},this.handlePinchZoom=(initialPinch,finalPinch,e)=>{if(!this.waitingForPinchZoomAnimationFrame){this.waitingForPinchZoomAnimationFrame=!0;const state=this.pinchZoomHelper(initialPinch,finalPinch);this.triggerEvent("pinchzoom",state,e),this.finalPinch=finalPinch,this.safeCanvasUpdate(()=>{this.clearBothCanvas(),this.draw({trigger:"pinchzoom"}),this.waitingForPinchZoomAnimationFrame=!1})}},this.handlePinchZoomEnd=(initialPinch,e)=>{const{xAccessor=ChartCanvas.defaultProps.xAccessor}=this.state;if(this.finalPinch){const state=this.pinchZoomHelper(initialPinch,this.finalPinch),{xScale,fullData}=state;this.triggerEvent("pinchzoom",state,e),this.finalPinch=void 0,this.clearThreeCanvas();const firstItem=head(fullData),scale_start=head(xScale.domain()),data_start=xAccessor(firstItem),lastItem=utils_last(fullData),scale_end=utils_last(xScale.domain()),data_end=xAccessor(lastItem),{onLoadAfter,onLoadBefore}=this.props;this.setState(state,()=>{scale_start<data_start&&void 0!==onLoadBefore&&onLoadBefore(scale_start,data_start),data_end<scale_end&&void 0!==onLoadAfter&&onLoadAfter(data_end,scale_end)})}},this.handleZoom=(zoomDirection,mouseXY,e)=>{if(this.panInProgress)return;const{xAccessor,xScale:initialXScale,plotData:initialPlotData,fullData}=this.state,{zoomMultiplier=ChartCanvas.defaultProps.zoomMultiplier,zoomAnchor=ChartCanvas.defaultProps.zoomAnchor}=this.props,item=zoomAnchor({xScale:initialXScale,xAccessor,mouseXY,plotData:initialPlotData}),cx=initialXScale(item),c=zoomDirection>0?1*zoomMultiplier:1/zoomMultiplier,newDomain=initialXScale.range().map(x=>cx+(x-cx)*c).map(x=>initialXScale.invert(x)),{xScale,plotData,chartConfigs}=this.calculateStateForDomain(newDomain),currentItem=getCurrentItem(xScale,xAccessor,mouseXY,plotData),currentCharts=getCurrentCharts(chartConfigs,mouseXY);this.clearThreeCanvas();const firstItem=head(fullData),scale_start=head(xScale.domain()),data_start=xAccessor(firstItem),lastItem=utils_last(fullData),scale_end=utils_last(xScale.domain()),data_end=xAccessor(lastItem);this.mutableState={mouseXY,currentItem,currentCharts},this.triggerEvent("zoom",{xScale,plotData,chartConfigs,mouseXY,currentCharts,currentItem,show:!0},e);const{onLoadAfter,onLoadBefore}=this.props;this.safeCanvasUpdate(()=>{this.setState({xScale,plotData,chartConfigs},()=>{scale_start<data_start&&void 0!==onLoadBefore&&onLoadBefore(scale_start,data_start),data_end<scale_end&&void 0!==onLoadAfter&&onLoadAfter(data_end,scale_end)})})},this.xAxisZoom=newDomain=>{const{xScale,plotData,chartConfigs}=this.calculateStateForDomain(newDomain);this.clearThreeCanvas();const{xAccessor,fullData}=this.state,firstItem=head(fullData),scale_start=head(xScale.domain()),data_start=xAccessor(firstItem),lastItem=utils_last(fullData),scale_end=utils_last(xScale.domain()),data_end=xAccessor(lastItem),{onLoadAfter,onLoadBefore}=this.props;this.safeCanvasUpdate(()=>{this.setState({xScale,plotData,chartConfigs},()=>{scale_start<data_start&&void 0!==onLoadBefore&&onLoadBefore(scale_start,data_start),data_end<scale_end&&void 0!==onLoadAfter&&onLoadAfter(data_end,scale_end)})})},this.yAxisZoom=(chartId,newDomain)=>{this.clearThreeCanvas();const{chartConfigs:initialChartConfig}=this.state,chartConfigs=initialChartConfig.map(each=>{if(each.id==chartId){const{yScale}=each;return{...each,yScale:yScale.copy().domain(newDomain),yPanEnabled:!0}}return each});this.safeCanvasUpdate(()=>{this.setState({chartConfigs})})},this.safeCanvasUpdate=operation=>{if(this.isStrictMode)try{(0,react_dom.flushSync)(()=>{operation()})}catch(error){console.warn("[React Financial Charts] flushSync failed, falling back to direct execution:",error),operation()}else this.canvasUpdateQueue.push(operation),this.processCanvasQueue()},this.processCanvasQueue=()=>{if(this.isProcessingQueue||0===this.canvasUpdateQueue.length)return;this.isProcessingQueue=!0;const processNext=()=>{const operation=this.canvasUpdateQueue.shift();operation&&operation(),this.canvasUpdateQueue.length>0?"scheduler"in window&&"postTask"in window.scheduler?window.scheduler.postTask(processNext,{priority:"user-blocking"}):requestAnimationFrame(processNext):this.isProcessingQueue=!1};processNext()},this.draw=props=>{this.subscriptions.forEach(each=>{isDefined(each.draw)&&each.draw(props)})},this.redraw=()=>{this.clearThreeCanvas(),this.draw({force:!0})},this.panHelper=(mouseXY,initialXScale,{dx,dy},chartsToPan)=>{const{xAccessor,displayXAccessor,chartConfigs:initialChartConfig,filterData,fullData}=this.state,{postCalculator=ChartCanvas.defaultProps.postCalculator}=this.props,newDomain=initialXScale.range().map(x=>x-dx).map(x=>initialXScale.invert(x)),{plotData:beforePlotData,domain}=filterData(fullData,newDomain,xAccessor,initialXScale,{currentPlotData:this.hackyWayToStopPanBeyondBounds__plotData,currentDomain:this.hackyWayToStopPanBeyondBounds__domain,ignoreThresholds:!0}),updatedScale=initialXScale.copy().domain(domain),plotData=postCalculator(beforePlotData),currentItem=getCurrentItem(updatedScale,xAccessor,mouseXY,plotData),chartConfigs=getChartConfigWithUpdatedYScales(initialChartConfig,{plotData,xAccessor,displayXAccessor,fullData},updatedScale.domain(),dy,chartsToPan);return{xScale:updatedScale,plotData,chartConfigs,mouseXY,currentCharts:getCurrentCharts(chartConfigs,mouseXY),currentItem}},this.handlePan=(mousePosition,panStartXScale,dxdy,chartsToPan,e)=>{if(this.waitingForPanAnimationFrame)return;this.waitingForPanAnimationFrame=!0,this.hackyWayToStopPanBeyondBounds__plotData=this.hackyWayToStopPanBeyondBounds__plotData??this.state.plotData,this.hackyWayToStopPanBeyondBounds__domain=this.hackyWayToStopPanBeyondBounds__domain??this.state.xScale.domain();const newState=this.panHelper(mousePosition,panStartXScale,dxdy,chartsToPan);this.hackyWayToStopPanBeyondBounds__plotData=newState.plotData,this.hackyWayToStopPanBeyondBounds__domain=newState.xScale.domain(),this.panInProgress=!0,this.triggerEvent("pan",newState,e),this.mutableState={mouseXY:newState.mouseXY,currentItem:newState.currentItem,currentCharts:newState.currentCharts},this.safeCanvasUpdate(()=>{this.waitingForPanAnimationFrame=!1,this.clearBothCanvas(),this.draw({trigger:"pan"})})},this.handlePanEnd=(mousePosition,panStartXScale,dxdy,chartsToPan,e)=>{const state=this.panHelper(mousePosition,panStartXScale,dxdy,chartsToPan);this.hackyWayToStopPanBeyondBounds__plotData=null,this.hackyWayToStopPanBeyondBounds__domain=null,this.panInProgress=!1;const{xScale,plotData,chartConfigs}=state;this.triggerEvent("panend",state,e),this.safeCanvasUpdate(()=>{const{xAccessor,fullData}=this.state,firstItem=head(fullData),scale_start=head(xScale.domain()),data_start=xAccessor(firstItem),lastItem=utils_last(fullData),scale_end=utils_last(xScale.domain()),data_end=xAccessor(lastItem),{onLoadAfter,onLoadBefore}=this.props;this.clearThreeCanvas(),this.setState({xScale,plotData,chartConfigs},()=>{scale_start<data_start&&void 0!==onLoadBefore&&onLoadBefore(scale_start,data_start),data_end<scale_end&&void 0!==onLoadAfter&&onLoadAfter(data_end,scale_end)})})},this.handleMouseDown=(_,__,e)=>{this.triggerEvent("mousedown",this.mutableState,e)},this.handleMouseEnter=e=>{this.triggerEvent("mouseenter",{show:!0},e)},this.handleMouseMove=(mouseXY,_,e)=>{if(this.waitingForMouseMoveAnimationFrame)return;this.waitingForMouseMoveAnimationFrame=!0;const{chartConfigs,plotData,xScale,xAccessor}=this.state,currentCharts=getCurrentCharts(chartConfigs,mouseXY),currentItem=getCurrentItem(xScale,xAccessor,mouseXY,plotData);this.triggerEvent("mousemove",{show:!0,mouseXY,prevMouseXY:this.prevMouseXY,currentItem,currentCharts},e),this.prevMouseXY=mouseXY,this.mutableState={mouseXY,currentItem,currentCharts},this.safeCanvasUpdate(()=>{this.clearMouseCanvas(),this.draw({trigger:"mousemove"}),this.waitingForMouseMoveAnimationFrame=!1})},this.handleMouseLeave=e=>{this.triggerEvent("mouseleave",{show:!1},e),this.clearMouseCanvas(),this.draw({trigger:"mouseleave"})},this.handleDragStart=({startPos},e)=>{this.triggerEvent("dragstart",{startPos},e)},this.handleDrag=({startPos,mouseXY},e)=>{const{chartConfigs,plotData,xScale,xAccessor}=this.state,currentCharts=getCurrentCharts(chartConfigs,mouseXY),currentItem=getCurrentItem(xScale,xAccessor,mouseXY,plotData);this.triggerEvent("drag",{startPos,mouseXY,currentItem,currentCharts},e),this.mutableState={mouseXY,currentItem,currentCharts},this.safeCanvasUpdate(()=>{this.clearMouseCanvas(),this.draw({trigger:"drag"})})},this.handleDragEnd=({mouseXY},e)=>{this.triggerEvent("dragend",{mouseXY},e),this.safeCanvasUpdate(()=>{this.clearMouseCanvas(),this.draw({trigger:"dragend"})})},this.handleClick=(_,e)=>{this.triggerEvent("click",this.mutableState,e),this.safeCanvasUpdate(()=>{this.clearMouseCanvas(),this.draw({trigger:"click"})})},this.handleDoubleClick=(_,e)=>{this.triggerEvent("dblclick",{},e)},this.resetYDomain=chartId=>{const{chartConfigs}=this.state;let changed=!1;const newChartConfig=chartConfigs.map(each=>!isNotDefined(chartId)&&each.id!==chartId||shallowEqual(each.yScale.domain(),each.realYDomain)?each:(changed=!0,{...each,yScale:each.yScale.domain(each.realYDomain),yPanEnabled:!1}));changed&&(this.clearThreeCanvas(),this.setState({chartConfigs:newChartConfig}))},this.resetChart=()=>{const newState=resetChart(this.props);this.clearThreeCanvas(),this.setState(newState)},this.state=resetChart(props),this.strictModeRenderCount++,setTimeout(()=>{this.strictModeRenderCount>1&&(this.isStrictMode=!0,console.info("[React Financial Charts] React Strict Mode detected - using optimized canvas rendering"))},0)}static getDerivedStateFromProps(props,state){const{chartConfigs:initialChartConfig,plotData,xAccessor,xScale}=state,interaction=isInteractionEnabled(xScale,xAccessor,plotData),shouldReset=(thisProps=state.lastProps||{},nextProps=props,!CANDIDATES_FOR_RESET.every(key=>shallowEqual(thisProps[key],nextProps[key])));var thisProps,nextProps;let newState;if(interaction&&!shouldReset&&shallowEqual(state.lastProps?.xExtents,props.xExtents)){const[start,end]=xScale.domain(),prevLastItem=utils_last(state.fullData),calculatedState=calculateFullData(props),{xAccessor}=calculatedState,previousX=xAccessor(prevLastItem);newState=((newState,initialXScale,props,lastItemWasVisible,initialChartConfig)=>{const{fullData,xScale,xAccessor,displayXAccessor,filterData}=newState,lastItem=utils_last(fullData),lastXItem=xAccessor(lastItem),[start,end]=initialXScale.domain(),{postCalculator,children,padding,flipXScale,maintainPointsPerPixelOnResize}=props,direction=getXScaleDirection(flipXScale),dimensions=ChartCanvas_getDimensions(props),updatedXScale=setXRange(xScale,dimensions,padding,direction);let initialPlotData;if(!lastItemWasVisible||end>=lastXItem){const[rangeStart,rangeEnd]=initialXScale.range(),[newRangeStart,newRangeEnd]=updatedXScale.range(),newDomainExtent=(newRangeEnd-newRangeStart)/(rangeEnd-rangeStart)*(end.valueOf()-start.valueOf()),response=filterData(fullData,[maintainPointsPerPixelOnResize?end.valueOf()-newDomainExtent:start,end],xAccessor,updatedXScale,{fallbackStart:start,fallbackEnd:{lastItem,lastItemX:initialXScale(lastXItem)}});initialPlotData=response.plotData,updatedXScale.domain(response.domain)}else if(lastItemWasVisible&&end<lastXItem){const dx=initialXScale(lastXItem)-initialXScale.range()[1],[newStart,newEnd]=initialXScale.range().map(x=>x+dx).map(x=>initialXScale.invert(x)),response=filterData(fullData,[newStart,newEnd],xAccessor,updatedXScale);initialPlotData=response.plotData,updatedXScale.domain(response.domain)}const plotData=postCalculator(initialPlotData),chartConfigs=getChartConfigWithUpdatedYScales(getNewChartConfig(dimensions,children,initialChartConfig),{plotData,xAccessor,displayXAccessor,fullData},updatedXScale.domain());return{xScale:updatedXScale,xAccessor,chartConfigs,plotData,fullData,filterData}})(calculatedState,xScale,props,previousX<=end&&previousX>=start,initialChartConfig)}else newState=resetChart(props);return{...newState,lastProps:props,propIteration:(state.propIteration||0)+1}}getSnapshotBeforeUpdate(prevProps,prevState){return prevState.propIteration===this.state.propIteration||this.panInProgress||this.clearThreeCanvas(),null}componentDidUpdate(prevProps){prevProps.data!==this.props.data&&this.triggerEvent("dataupdated",{chartConfigs:this.state.chartConfigs,xScale:this.state.xScale,plotData:this.state.plotData})}clearBothCanvas(){const canvases=this.getCanvasContexts();canvases&&canvases.axes&&canvases.mouseCoord&&clearCanvas([canvases.axes,canvases.mouseCoord],this.props.ratio)}clearMouseCanvas(){const canvases=this.getCanvasContexts();canvases&&canvases.mouseCoord&&clearCanvas([canvases.mouseCoord],this.props.ratio)}clearThreeCanvas(){const canvases=this.getCanvasContexts();canvases&&canvases.axes&&canvases.mouseCoord&&canvases.bg&&clearCanvas([canvases.axes,canvases.mouseCoord,canvases.bg],this.props.ratio)}cancelDrag(){this.eventCaptureRef.current?.cancelDrag(),this.triggerEvent("dragcancel")}triggerEvent(type,props,e){this.subscriptions.forEach(each=>{const state={...this.state,subscriptions:this.subscriptions};each.listener(type,props,state,e)})}getContextValues(){const dimensions=ChartCanvas_getDimensions(this.props);return{chartId:-1,fullData:this.state.fullData,plotData:this.state.plotData,width:dimensions.width,height:dimensions.height,chartConfigs:this.state.chartConfigs,xScale:this.state.xScale,xAccessor:this.state.xAccessor,displayXAccessor:this.state.displayXAccessor,margin:this.props.margin,ratio:this.props.ratio,xAxisZoom:this.xAxisZoom,yAxisZoom:this.yAxisZoom,resetYDomain:this.resetYDomain,resetChart:this.resetChart,getCanvasContexts:this.getCanvasContexts,redraw:this.redraw,subscribe:this.subscribe,unsubscribe:this.unsubscribe,generateSubscriptionId:this.generateSubscriptionId,getMutableState:this.getMutableState,amIOnTop:this.amIOnTop,setCursorClass:this.setCursorClass}}shouldComponentUpdate(){return!this.panInProgress}render(){const{disableInteraction,disablePan,disableZoom,useCrossHairStyleCursor,onClick,onDoubleClick,height,width,margin=ChartCanvas.defaultProps.margin,className,zIndex=ChartCanvas.defaultProps.zIndex,defaultFocus,ratio,mouseMoveEvent}=this.props,{plotData,xScale,xAccessor,chartConfigs}=this.state,dimensions=ChartCanvas_getDimensions(this.props),interaction=isInteractionEnabled(xScale,xAccessor,plotData),cursorStyle=useCrossHairStyleCursor&&interaction,cursor=(0,jsx_runtime.jsx)("style",{type:"text/css",children:"\n\t.react-financial-charts-grabbing-cursor {\n\t\tpointer-events: all;\n\t\tcursor: -moz-grabbing;\n\t\tcursor: -webkit-grabbing;\n\t\tcursor: grabbing;\n\t}\n\t.react-financial-charts-crosshair-cursor {\n\t\tpointer-events: all;\n\t\tcursor: crosshair;\n\t}\n\t.react-financial-charts-tooltip-hover {\n\t\tpointer-events: all;\n\t\tcursor: pointer;\n\t}\n\t.react-financial-charts-avoid-interaction {\n\t\tpointer-events: none;\n\t}\n\t.react-financial-charts-enable-interaction {\n\t\tpointer-events: all;\n\t}\n\t.react-financial-charts-tooltip {\n\t\tpointer-events: all;\n\t\tcursor: pointer;\n\t}\n\t.react-financial-charts-default-cursor {\n\t\tcursor: default;\n\t}\n\t.react-financial-charts-move-cursor {\n\t\tcursor: move;\n\t}\n\t.react-financial-charts-pointer-cursor {\n\t\tcursor: pointer;\n\t}\n\t.react-financial-charts-ns-resize-cursor {\n\t\tcursor: ns-resize;\n\t}\n\t.react-financial-charts-ew-resize-cursor {\n\t\tcursor: ew-resize;\n\t}"});return(0,jsx_runtime.jsx)(ChartCanvasContext.Provider,{value:this.getContextValues(),children:(0,jsx_runtime.jsxs)("div",{style:{position:"relative",width,height},className,onClick,onDoubleClick,children:[(0,jsx_runtime.jsx)(CanvasContainer,{ref:this.canvasContainerRef,ratio,width,height,style:{height,zIndex,width}}),(0,jsx_runtime.jsxs)("svg",{className,width,height,style:{position:"absolute",zIndex:zIndex+5},children:[cursor,(0,jsx_runtime.jsxs)("defs",{children:[(0,jsx_runtime.jsx)("clipPath",{id:"chart-area-clip",children:(0,jsx_runtime.jsx)("rect",{x:"0",y:"0",width:dimensions.width,height:dimensions.height})}),chartConfigs.map((each,idx)=>(0,jsx_runtime.jsx)("clipPath",{id:`chart-area-clip-${each.id}`,children:(0,jsx_runtime.jsx)("rect",{x:"0",y:"0",width:each.width,height:each.height})},idx))]}),(0,jsx_runtime.jsxs)("g",{transform:`translate(${margin.left+.5}, ${margin.top+.5})`,children:[(0,jsx_runtime.jsx)(EventCapture,{ref:this.eventCaptureRef,useCrossHairStyleCursor:cursorStyle,mouseMove:mouseMoveEvent&&interaction,zoom:!disableZoom&&interaction,pan:!disablePan&&interaction,width:dimensions.width,height:dimensions.height,chartConfig:chartConfigs,xScale,xAccessor,focus:defaultFocus,disableInteraction,getAllPanConditions:this.getAllPanConditions,onContextMenu:this.handleContextMenu,onClick:this.handleClick,onDoubleClick:this.handleDoubleClick,onMouseDown:this.handleMouseDown,onMouseMove:this.handleMouseMove,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,onDragStart:this.handleDragStart,onDrag:this.handleDrag,onDragComplete:this.handleDragEnd,onZoom:this.handleZoom,onPinchZoom:this.handlePinchZoom,onPinchZoomEnd:this.handlePinchZoomEnd,onPan:this.handlePan,onPanEnd:this.handlePanEnd}),(0,jsx_runtime.jsx)("g",{className:"react-financial-charts-avoid-interaction",children:this.props.children})]})]})]})})}}ChartCanvas.defaultProps={clamp:!1,className:"react-financial-charts",defaultFocus:!0,disablePan:!1,disableInteraction:!1,disableZoom:!1,flipXScale:!1,maintainPointsPerPixelOnResize:!0,margin:{top:0,right:40,bottom:40,left:0},minPointsPerPxThreshold:.01,mouseMoveEvent:!0,postCalculator:identity,padding:0,pointsPerPxThreshold:2,useCrossHairStyleCursor:!0,xAccessor:identity,xExtents:[min.A,max.A],zIndex:1,zoomAnchor:options=>{const{xScale,xAccessor,mouseXY,plotData}=options;return xAccessor(getCurrentItem(xScale,xAccessor,mouseXY,plotData))},zoomMultiplier:1.1};var discontinuousTimeScaleProvider=__webpack_require__("../scales/lib/discontinuousTimeScaleProvider.js"),lib_ChartCanvas=__webpack_require__("../core/lib/ChartCanvas.js"),Chart=__webpack_require__("../core/lib/Chart.js"),CandlestickSeries=__webpack_require__("../series/lib/CandlestickSeries.js"),XAxis=__webpack_require__("../axes/lib/XAxis.js"),YAxis=__webpack_require__("../axes/lib/YAxis.js"),withSize=__webpack_require__("../utils/lib/withSize.js"),withDeviceRatio=__webpack_require__("../utils/lib/withDeviceRatio.js"),data=__webpack_require__("./src/data/index.ts");class Interaction extends react.Component{constructor(){super(...arguments),this.margin={left:0,right:40,top:0,bottom:24},this.xScaleProvider=(0,discontinuousTimeScaleProvider.L)().inputDateAccessor(d=>d.date),this.yExtents=data=>[data.high,data.low]}render(){const{clamp,data:initialData,disablePan=!1,disableZoom=!1,disableInteraction,height,ratio,width,zoomAnchor}=this.props,{margin,xScaleProvider}=this,{data,xScale,xAccessor,displayXAccessor}=xScaleProvider(initialData),max=xAccessor(data[data.length-1]),xExtents=[xAccessor(data[Math.max(0,data.length-100)]),max];return(0,jsx_runtime.jsx)(lib_ChartCanvas.v,{clamp,height,ratio,width,margin,data,disableInteraction,disablePan,disableZoom,displayXAccessor,seriesName:"Data",xScale,xAccessor,xExtents,zoomAnchor,children:(0,jsx_runtime.jsxs)(Chart.t,{id:1,yExtents:this.yExtents,children:[(0,jsx_runtime.jsx)(CandlestickSeries.H,{}),(0,jsx_runtime.jsx)(XAxis.W,{ticks:6}),(0,jsx_runtime.jsx)(YAxis.h,{ticks:5})]})})}}const interaction_Interaction=(0,data.p)()((0,withSize.U)({style:{minHeight:600}})((0,withDeviceRatio.O)()(Interaction))),index_stories={component:ChartCanvas,title:"Features/Interaction"},clamp={render:()=>(0,jsx_runtime.jsx)(interaction_Interaction,{clamp:!0})},disable={render:()=>(0,jsx_runtime.jsx)(interaction_Interaction,{disableInteraction:!0})},disablePan={render:()=>(0,jsx_runtime.jsx)(interaction_Interaction,{disablePan:!0})},disableZoom={render:()=>(0,jsx_runtime.jsx)(interaction_Interaction,{disableZoom:!0})},zoomAnchorToMouse={render:()=>(0,jsx_runtime.jsx)(interaction_Interaction,{zoomAnchor:zoomBehavior.z$})},zoomAnchorToLastVisible={render:()=>(0,jsx_runtime.jsx)(interaction_Interaction,{zoomAnchor:zoomBehavior.by})},zoomAnchorToBounds={render:()=>(0,jsx_runtime.jsx)(interaction_Interaction,{zoomAnchor:zoomBehavior.g0})},__namedExportsOrder=["clamp","disable","disablePan","disableZoom","zoomAnchorToMouse","zoomAnchorToLastVisible","zoomAnchorToBounds"];clamp.parameters={...clamp.parameters,docs:{...clamp.parameters?.docs,source:{originalSource:"{\n  render: () => <Interaction clamp />\n}",...clamp.parameters?.docs?.source}}},disable.parameters={...disable.parameters,docs:{...disable.parameters?.docs,source:{originalSource:"{\n  render: () => <Interaction disableInteraction />\n}",...disable.parameters?.docs?.source}}},disablePan.parameters={...disablePan.parameters,docs:{...disablePan.parameters?.docs,source:{originalSource:"{\n  render: () => <Interaction disablePan />\n}",...disablePan.parameters?.docs?.source}}},disableZoom.parameters={...disableZoom.parameters,docs:{...disableZoom.parameters?.docs,source:{originalSource:"{\n  render: () => <Interaction disableZoom />\n}",...disableZoom.parameters?.docs?.source}}},zoomAnchorToMouse.parameters={...zoomAnchorToMouse.parameters,docs:{...zoomAnchorToMouse.parameters?.docs,source:{originalSource:"{\n  render: () => <Interaction zoomAnchor={mouseBasedZoomAnchor} />\n}",...zoomAnchorToMouse.parameters?.docs?.source}}},zoomAnchorToLastVisible.parameters={...zoomAnchorToLastVisible.parameters,docs:{...zoomAnchorToLastVisible.parameters?.docs,source:{originalSource:"{\n  render: () => <Interaction zoomAnchor={lastVisibleItemBasedZoomAnchor} />\n}",...zoomAnchorToLastVisible.parameters?.docs?.source}}},zoomAnchorToBounds.parameters={...zoomAnchorToBounds.parameters,docs:{...zoomAnchorToBounds.parameters?.docs,source:{originalSource:"{\n  render: () => <Interaction zoomAnchor={rightDomainBasedZoomAnchor} />\n}",...zoomAnchorToBounds.parameters?.docs?.source}}}}}]);