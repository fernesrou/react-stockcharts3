"use strict";(self.webpackChunk_react_stockcharts3_stories=self.webpackChunk_react_stockcharts3_stories||[]).push([[3330],{"../interactive/lib/components/ClickableCircle.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{t:()=>ClickableCircle});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/react/jsx-runtime.js"),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/react/index.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../core/lib/GenericChartComponent.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../core/lib/GenericComponent.js");class ClickableCircle extends react__WEBPACK_IMPORTED_MODULE_1__.Component{constructor(){super(...arguments),this.drawOnCanvas=(ctx,moreProps)=>{const{strokeStyle,strokeWidth,fillStyle,r}=this.props;ctx.lineWidth=strokeWidth,ctx.fillStyle=fillStyle,ctx.strokeStyle=strokeStyle;const[x,y]=this.helper(moreProps);ctx.beginPath(),ctx.arc(x,y,r,0,2*Math.PI,!1),ctx.fill(),ctx.stroke()},this.isHover=moreProps=>{const{mouseXY}=moreProps,r=this.props.r+7,[x,y]=this.helper(moreProps),[mx,my]=mouseXY;return x-r<mx&&mx<x+r&&y-r<my&&my<y+r},this.helper=moreProps=>{const{xyProvider,cx,cy}=this.props;if(void 0!==xyProvider)return xyProvider(moreProps);const{xScale,chartConfig:{yScale}}=moreProps;return[xScale(cx),yScale(cy)]}}render(){const{interactiveCursorClass,onDragStart,onDrag,onDragComplete,show}=this.props;return show?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_2__.P,{interactiveCursorClass,selected:!0,isHover:this.isHover,onDragStart,onDrag,onDragComplete,canvasDraw:this.drawOnCanvas,canvasToDraw:_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__.wk,drawOn:["pan","mousemove","drag"]}):null}}ClickableCircle.defaultProps={className:"react-financial-charts-interactive-line-edge",show:!1}},"../interactive/lib/components/InteractiveStraightLine.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{AK:()=>getSlope,F$:()=>InteractiveStraightLine,KU:()=>getYIntercept,Lg:()=>isHovering,ph:()=>isHovering2,sD:()=>generateLine});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/react/jsx-runtime.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../core/lib/GenericChartComponent.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../core/lib/GenericComponent.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../core/lib/utils/noop.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../core/lib/utils/strokeDasharray.js"),react__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../node_modules/react/index.js");class InteractiveStraightLine extends react__WEBPACK_IMPORTED_MODULE_5__.Component{constructor(){super(...arguments),this.isHover=moreProps=>{const{tolerance,onHover}=this.props;if(void 0!==onHover){const{x1Value,x2Value,y1Value,y2Value,type}=this.props,{mouseXY,xScale}=moreProps,{chartConfig:{yScale}}=moreProps;return isHovering({x1Value,y1Value,x2Value,y2Value,mouseXY,type,tolerance,xScale,yScale})}return!1},this.drawOnCanvas=(ctx,moreProps)=>{const{strokeWidth=InteractiveStraightLine.defaultProps.strokeWidth,strokeDasharray,strokeStyle}=this.props,{x1,y1,x2,y2}=function helper(props,moreProps){const{x1Value,x2Value,y1Value,y2Value,type}=props,{xScale,chartConfig:{yScale}}=moreProps,modLine=generateLine({type,start:[x1Value,y1Value],end:[x2Value,y2Value],xScale,yScale}),x1=xScale(modLine.x1),y1=yScale(modLine.y1),x2=xScale(modLine.x2),y2=yScale(modLine.y2);return{x1,y1,x2,y2}}(this.props,moreProps);ctx.lineWidth=strokeWidth,ctx.strokeStyle=strokeStyle;const lineDash=(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_4__.y)(strokeDasharray);ctx.setLineDash(lineDash),ctx.beginPath(),ctx.moveTo(x1,y1),ctx.lineTo(x2,y2),ctx.stroke()}}render(){const{selected,interactiveCursorClass}=this.props,{onDragStart,onDrag,onDragComplete,onHover,onUnHover}=this.props;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_1__.P,{isHover:this.isHover,canvasToDraw:_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_2__.wk,canvasDraw:this.drawOnCanvas,interactiveCursorClass,selected,onDragStart,onDrag,onDragComplete,onHover,onUnHover,drawOn:["mousemove","pan","drag"]})}}function isHovering2(start,end,[mouseX,mouseY],tolerance){const m=getSlope(start,end);if(void 0!==m){const y=m*mouseX+getYIntercept(m,end);return mouseY<y+tolerance&&mouseY>y-tolerance&&mouseX>Math.min(start[0],end[0])-tolerance&&mouseX<Math.max(start[0],end[0])+tolerance}return mouseY>=Math.min(start[1],end[1])&&mouseY<=Math.max(start[1],end[1])&&mouseX<start[0]+tolerance&&mouseX>start[0]-tolerance}function isHovering({x1Value,y1Value,x2Value,y2Value,mouseXY,type,tolerance,xScale,yScale}){const line=generateLine({type,start:[x1Value,y1Value],end:[x2Value,y2Value],xScale,yScale}),start=[xScale(line.x1),yScale(line.y1)],end=[xScale(line.x2),yScale(line.y2)],m=getSlope(start,end),[mouseX,mouseY]=mouseXY;if(void 0!==m){const y=m*mouseX+getYIntercept(m,end);return mouseY<y+tolerance&&mouseY>y-tolerance&&mouseX>Math.min(start[0],end[0])-tolerance&&mouseX<Math.max(start[0],end[0])+tolerance}return mouseY>=Math.min(start[1],end[1])&&mouseY<=Math.max(start[1],end[1])&&mouseX<start[0]+tolerance&&mouseX>start[0]-tolerance}function getSlope(start,end){return end[0]===start[0]?void 0:(end[1]-start[1])/(end[0]-start[0])}function getYIntercept(m,end){return-1*m*end[0]+end[1]}function generateLine({type,start,end,xScale,yScale}){const m=getSlope(start,end),b=getYIntercept(m,start);switch(type){case"XLINE":return function getXLineCoordinates({start,end,xScale,yScale,m,b}){const[xBegin,xFinish]=xScale.domain(),[yBegin,yFinish]=yScale.domain();if(end[0]===start[0])return{x1:end[0],y1:yBegin,x2:end[0],y2:yFinish};const[x1,x2]=end[0]>start[0]?[xBegin,xFinish]:[xFinish,xBegin];return{x1,y1:m*x1+b,x2,y2:m*x2+b}}({start,end,xScale,yScale,m,b});case"RAY":return function getRayCoordinates({start,end,xScale,yScale,m,b}){const[xBegin,xFinish]=xScale.domain(),[yBegin,yFinish]=yScale.domain(),x1=start[0];if(end[0]===start[0])return{x1,y1:start[1],x2:x1,y2:end[1]>start[1]?yFinish:yBegin};const x2=end[0]>start[0]?xFinish:xBegin;return{x1,y1:m*x1+b,x2,y2:m*x2+b}}({start,end,xScale,yScale,m,b});default:return function getLineCoordinates({start,end}){const[x1,y1]=start,[x2,y2]=end;if(end[0]===start[0])return{x1,y1:start[1],x2:x1,y2:end[1]};return{x1,y1,x2,y2}}({start,end})}}InteractiveStraightLine.defaultProps={onEdge1Drag:_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__.l,onEdge2Drag:_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__.l,edgeStrokeWidth:3,edgeStroke:"#000000",edgeFill:"#FFFFFF",r:10,withEdge:!1,strokeWidth:1,strokeDasharray:"Solid",children:_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__.l,tolerance:7,selected:!1}},"../interactive/lib/components/MouseLocationIndicator.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{O:()=>MouseLocationIndicator});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/react/jsx-runtime.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../core/lib/GenericChartComponent.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../core/lib/GenericComponent.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../core/lib/utils/noop.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../core/lib/utils/index.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../core/lib/utils/shallowEqual.js"),react__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../node_modules/react/index.js"),_react_stockcharts3_core_lib_utils_ChartDataUtil__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../core/lib/utils/ChartDataUtil.js");class MouseLocationIndicator extends react__WEBPACK_IMPORTED_MODULE_6__.Component{constructor(){super(...arguments),this.mutableState={},this.xy=(e,moreProps)=>{const{xAccessor,plotData}=moreProps,{mouseXY,currentItem,xScale,chartConfig:{yScale}}=moreProps,{enabled,snap,shouldDisableSnap,snapTo}=this.props;if(enabled&&(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_4__.O9)(currentItem)&&(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_4__.O9)(e)){const xValue=snap&&!shouldDisableSnap(e)?xAccessor(currentItem):(0,_react_stockcharts3_core_lib_utils_ChartDataUtil__WEBPACK_IMPORTED_MODULE_7__.M4)(xScale,xAccessor,mouseXY,plotData),yValue=snap&&void 0!==snapTo&&!shouldDisableSnap(e)?(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_4__.xZ)(snapTo(currentItem),yScale.invert(mouseXY[1])):yScale.invert(mouseXY[1]);return{xValue,yValue,x:xScale(xValue),y:yScale(yValue)}}},this.handleClick=(e,moreProps)=>{const pos=this.xy(e,moreProps);if(void 0!==pos&&(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_4__.O9)(pos)){const{xValue,yValue,x,y}=pos;this.mutableState={x,y},this.props.onClick(e,[xValue,yValue],moreProps)}},this.handleMouseDown=(e,moreProps)=>{const pos=this.xy(e,moreProps);if(void 0!==pos&&(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_4__.O9)(pos)){const{xValue,yValue,x,y}=pos;this.mutableState={x,y},this.props.onMouseDown(e,[xValue,yValue],moreProps)}},this.handleMousePosChange=(e,moreProps)=>{if(!(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_5__.b)(moreProps.mousXY,moreProps.prevMouseXY)){const pos=this.xy(e,moreProps);if(void 0!==pos&&(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_4__.O9)(pos)){const{xValue,yValue,x,y}=pos;this.mutableState={x,y},this.props.onMouseMove(e,[xValue,yValue],moreProps)}}},this.drawOnCanvas=(ctx,moreProps)=>{const{enabled,r,stroke,strokeWidth}=this.props,{x,y}=this.mutableState,{show}=moreProps;enabled&&show&&(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_4__.O9)(x)&&(ctx.lineWidth=strokeWidth,ctx.strokeStyle=stroke,ctx.moveTo(x,y),ctx.beginPath(),ctx.arc(x,y,r,0,2*Math.PI,!1),ctx.stroke())}}render(){const{enabled,disablePan}=this.props;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_1__.P,{onMouseDown:this.handleMouseDown,onClick:this.handleClick,onMouseMove:this.handleMousePosChange,onPan:this.handleMousePosChange,disablePan:enabled&&disablePan,canvasDraw:this.drawOnCanvas,canvasToDraw:_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_2__.wk,drawOn:["mousemove","pan"]})}}MouseLocationIndicator.defaultProps={onMouseMove:_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__.l,onMouseDown:_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__.l,onClick:_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__.l,shouldDisableSnap:(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_4__.ER)(!1),stroke:"#000000",strokeWidth:1,opacity:1,disablePan:!0}},"../interactive/lib/wrapper/EachTrendLine.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{N:()=>EachTrendLine,Q:()=>getNewXY});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/react/jsx-runtime.js"),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/react/index.js"),d3_array__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../node_modules/d3-array/src/ascending.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../core/lib/utils/noop.js"),_react_stockcharts3_core_lib_utils_ChartDataUtil__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../core/lib/utils/ChartDataUtil.js"),_utils__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../interactive/lib/utils.js"),_components__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../interactive/lib/components/ClickableCircle.js"),_components__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../interactive/lib/components/HoverTextNearMouse.js"),_components__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("../interactive/lib/components/InteractiveStraightLine.js");class EachTrendLine extends react__WEBPACK_IMPORTED_MODULE_1__.Component{constructor(props){super(props),this.handleHover=(_,moreProps)=>{this.state.hover!==moreProps.hovering&&this.setState({hover:moreProps.hovering})},this.handleEdge2Drag=(e,moreProps)=>{const{index,onDrag,x1Value,y1Value}=this.props,[x2Value,y2Value]=getNewXY(moreProps);onDrag(e,index,{x1Value,y1Value,x2Value,y2Value})},this.handleEdge1Drag=(e,moreProps)=>{const{index,onDrag,x2Value,y2Value}=this.props,[x1Value,y1Value]=getNewXY(moreProps);onDrag(e,index,{x1Value,y1Value,x2Value,y2Value})},this.handleDragComplete=(e,moreProps)=>{this.setState({anchor:void 0});const{onDragComplete}=this.props;void 0!==onDragComplete&&onDragComplete(e,moreProps)},this.handleEdge2DragStart=()=>{this.setState({anchor:"edge1"})},this.handleEdge1DragStart=()=>{this.setState({anchor:"edge2"})},this.handleLineDrag=(e,moreProps)=>{const{index,onDrag}=this.props,{x1Value,y1Value,x2Value,y2Value}=this.dragStart,{xScale,chartConfig:{yScale},xAccessor,fullData}=moreProps,{startPos,mouseXY}=moreProps,x1=xScale(x1Value),y1=yScale(y1Value),x2=xScale(x2Value),y2=yScale(y2Value),dx=startPos[0]-mouseXY[0],dy=startPos[1]-mouseXY[1];onDrag(e,index,{x1Value:(0,_react_stockcharts3_core_lib_utils_ChartDataUtil__WEBPACK_IMPORTED_MODULE_4__.M4)(xScale,xAccessor,[x1-dx,y1-dy],fullData),y1Value:yScale.invert(y1-dy),x2Value:(0,_react_stockcharts3_core_lib_utils_ChartDataUtil__WEBPACK_IMPORTED_MODULE_4__.M4)(xScale,xAccessor,[x2-dx,y2-dy],fullData),y2Value:yScale.invert(y2-dy)})},this.handleLineDragStart=()=>{const{x1Value,y1Value,x2Value,y2Value}=this.props;this.dragStart={x1Value,y1Value,x2Value,y2Value}},this.isHover=_utils__WEBPACK_IMPORTED_MODULE_5__.FK.bind(this),this.saveNodeType=_utils__WEBPACK_IMPORTED_MODULE_5__.Ap.bind(this),this.state={hover:!1}}render(){const{x1Value,y1Value,x2Value,y2Value,type,strokeStyle,strokeWidth,strokeDasharray,r,edgeStrokeWidth,edgeFill,edgeStroke,edgeInteractiveCursor,lineInteractiveCursor,hoverText,selected,onDragComplete}=this.props,{enable:hoverTextEnabled,selectedText:hoverTextSelected,text:hoverTextUnselected,...restHoverTextProps}=hoverText,{hover,anchor}=this.state;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("g",{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_components__WEBPACK_IMPORTED_MODULE_8__.F$,{ref:this.saveNodeType("line"),selected:selected||hover,onHover:this.handleHover,onUnHover:this.handleHover,x1Value,y1Value,x2Value,y2Value,type,strokeStyle,strokeWidth:hover||selected?strokeWidth+1:strokeWidth,strokeDasharray,interactiveCursorClass:lineInteractiveCursor,onDragStart:this.handleLineDragStart,onDrag:this.handleLineDrag,onDragComplete}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_components__WEBPACK_IMPORTED_MODULE_6__.t,{ref:this.saveNodeType("edge1"),show:selected||hover,cx:x1Value,cy:y1Value,r,fillStyle:edgeFill,strokeStyle:"edge1"===anchor?strokeStyle:edgeStroke,strokeWidth:edgeStrokeWidth,interactiveCursorClass:edgeInteractiveCursor,onDragStart:this.handleEdge1DragStart,onDrag:this.handleEdge1Drag,onDragComplete:this.handleDragComplete}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_components__WEBPACK_IMPORTED_MODULE_6__.t,{ref:this.saveNodeType("edge2"),show:selected||hover,cx:x2Value,cy:y2Value,r,fillStyle:edgeFill,strokeStyle:"edge2"===anchor?strokeStyle:edgeStroke,strokeWidth:edgeStrokeWidth,interactiveCursorClass:edgeInteractiveCursor,onDragStart:this.handleEdge2DragStart,onDrag:this.handleEdge2Drag,onDragComplete:this.handleDragComplete}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_components__WEBPACK_IMPORTED_MODULE_7__.r,{show:hoverTextEnabled&&hover,...restHoverTextProps,text:selected?hoverTextSelected:hoverTextUnselected})]})}}function getNewXY(moreProps){const{xScale,chartConfig:{yScale},xAccessor,plotData,mouseXY}=moreProps,mouseY=mouseXY[1],x=(0,_react_stockcharts3_core_lib_utils_ChartDataUtil__WEBPACK_IMPORTED_MODULE_4__.M4)(xScale,xAccessor,mouseXY,plotData),[small,big]=yScale.domain().slice().sort(d3_array__WEBPACK_IMPORTED_MODULE_2__.A),y=yScale.invert(mouseY);return[x,Math.min(Math.max(y,small),big)]}EachTrendLine.defaultProps={onDrag:_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__.l,onEdge1Drag:_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__.l,onEdge2Drag:_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__.l,onSelect:_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__.l,selected:!1,edgeStroke:"#000000",edgeFill:"#FFFFFF",edgeStrokeWidth:2,r:5,strokeWidth:1,strokeDasharray:"Solid",hoverText:{enable:!1}}},"./src/features/interactive/FibonacciChart.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,__namedExportsOrder:()=>__namedExportsOrder,default:()=>FibonacciChart_stories});var jsx_runtime=__webpack_require__("../../node_modules/react/jsx-runtime.js"),react=__webpack_require__("../../node_modules/react/index.js"),defaultLocale=__webpack_require__("../../node_modules/d3-format/src/defaultLocale.js"),src_defaultLocale=__webpack_require__("../../node_modules/d3-time-format/src/defaultLocale.js"),ChartCanvas=__webpack_require__("../core/lib/ChartCanvas.js"),Chart=__webpack_require__("../core/lib/Chart.js"),XAxis=__webpack_require__("../axes/lib/XAxis.js"),YAxis=__webpack_require__("../axes/lib/YAxis.js"),CandlestickSeries=__webpack_require__("../series/lib/CandlestickSeries.js"),MouseCoordinateY=__webpack_require__("../coordinates/lib/MouseCoordinateY.js"),MouseCoordinateX=__webpack_require__("../coordinates/lib/MouseCoordinateX.js"),CrossHairCursor=__webpack_require__("../coordinates/lib/CrossHairCursor.js"),discontinuousTimeScaleProvider=__webpack_require__("../scales/lib/discontinuousTimeScaleProvider.js"),utils=__webpack_require__("../core/lib/utils/index.js"),noop=__webpack_require__("../core/lib/utils/noop.js"),MouseLocationIndicator=__webpack_require__("../interactive/lib/components/MouseLocationIndicator.js"),HoverTextNearMouse=__webpack_require__("../interactive/lib/components/HoverTextNearMouse.js"),lib_utils=__webpack_require__("../interactive/lib/utils.js"),ChartDataUtil=__webpack_require__("../core/lib/utils/ChartDataUtil.js"),InteractiveStraightLine=__webpack_require__("../interactive/lib/components/InteractiveStraightLine.js"),GenericChartComponent=__webpack_require__("../core/lib/GenericChartComponent.js"),GenericComponent=__webpack_require__("../core/lib/GenericComponent.js");class Text extends react.Component{constructor(){super(...arguments),this.isHover=()=>!1,this.drawOnCanvas=(ctx,moreProps)=>{const{xyProvider,fontFamily,fontSize,fillStyle,children}=this.props,[x,y]=xyProvider(moreProps);ctx.font=`${fontSize}px ${fontFamily}`,ctx.fillStyle=fillStyle,ctx.beginPath(),ctx.fillText(children,x,y)}}render(){const{selected}=this.props;return(0,jsx_runtime.jsx)(GenericChartComponent.P,{isHover:this.isHover,selected,canvasToDraw:GenericComponent.wk,canvasDraw:this.drawOnCanvas,drawOn:["mousemove","pan","drag"]})}}Text.defaultProps={selected:!1};var ClickableCircle=__webpack_require__("../interactive/lib/components/ClickableCircle.js"),EachTrendLine=__webpack_require__("../interactive/lib/wrapper/EachTrendLine.js");class EachFibRetracement extends react.Component{constructor(props){super(props),this.handleEdge2Drag=(e,moreProps)=>{const{index,onDrag,x1,y1,y2}=this.props,[x2]=(0,EachTrendLine.Q)(moreProps);onDrag(e,index,{x1,y1,x2,y2})},this.handleEdge1Drag=(e,moreProps)=>{const{index,onDrag,y1,x2,y2}=this.props,[x1]=(0,EachTrendLine.Q)(moreProps);onDrag(e,index,{x1,y1,x2,y2})},this.handleLineNSResizeBottom=(e,moreProps)=>{const{index,onDrag,x1,y1,x2}=this.props,[,y2]=(0,EachTrendLine.Q)(moreProps);onDrag(e,index,{x1,y1,x2,y2})},this.handleLineNSResizeTop=(e,moreProps)=>{const{index,onDrag,x1,x2,y2}=this.props,[,y1]=(0,EachTrendLine.Q)(moreProps);onDrag(e,index,{x1,y1,x2,y2})},this.handleLineMove=(e,moreProps)=>{const{index,onDrag}=this.props,{x1:x1Value,y1:y1Value,x2:x2Value,y2:y2Value}=this.dragStart,{xScale,chartConfig:{yScale},xAccessor,fullData}=moreProps,{startPos,mouseXY}=moreProps,x1=xScale(x1Value),y1=yScale(y1Value),x2=xScale(x2Value),y2=yScale(y2Value),dx=startPos[0]-mouseXY[0],dy=startPos[1]-mouseXY[1];onDrag(e,index,{x1:(0,ChartDataUtil.M4)(xScale,xAccessor,[x1-dx,y1-dy],fullData),y1:yScale.invert(y1-dy),x2:(0,ChartDataUtil.M4)(xScale,xAccessor,[x2-dx,y2-dy],fullData),y2:yScale.invert(y2-dy)})},this.handleLineDragStart=()=>{const{x1,y1,x2,y2}=this.props;this.dragStart={x1,y1,x2,y2}},this.handleHover=(_,moreProps)=>{this.state.hover!==moreProps.hovering&&this.setState({hover:moreProps.hovering})},this.isHover=lib_utils.FK.bind(this),this.saveNodeType=lib_utils.Ap.bind(this),this.state={hover:!1}}render(){const{x1,x2,y1,y2}=this.props,{interactive,yDisplayFormat,type,appearance}=this.props,{strokeStyle,strokeWidth}=appearance,{fontFamily,fontSize,fontFill}=appearance,{edgeStroke,edgeFill,nsEdgeFill,edgeStrokeWidth,r}=appearance,{hoverText,selected}=this.props,{hover}=this.state,{onDragComplete}=this.props,lines=function helper({x1,y1,x2,y2}){const dy=y2-y1,retracements=[100,61.8,50,38.2,23.6,0].map(each=>({percent:each,x1,x2,y:y2-each/100*dy}));return retracements}({x1,x2,y1,y2}),{enable:hoverTextEnabled,selectedText:hoverTextSelected,text:hoverTextUnselected,...restHoverTextProps}=hoverText,lineType="EXTEND"===type?"XLINE":"BOUND"===type?"LINE":"RAY",dir=(0,utils.d5)(lines).y1>(0,utils.HV)(lines).y1?3:-1.3;return(0,jsx_runtime.jsxs)("g",{children:[lines.map((line,j)=>{const text=`${yDisplayFormat(line.y)} (${line.percent.toFixed(2)}%)`,firstOrLast=0===j||j===lines.length-1,interactiveCursorClass=firstOrLast?"react-financial-charts-ns-resize-cursor":"react-financial-charts-move-cursor",interactiveEdgeCursorClass=firstOrLast?"react-financial-charts-ns-resize-cursor":"react-financial-charts-ew-resize-cursor",dragHandler=0===j?this.handleLineNSResizeTop:j===lines.length-1?this.handleLineNSResizeBottom:this.handleLineMove,edge1DragHandler=0===j?this.handleLineNSResizeTop:j===lines.length-1?this.handleLineNSResizeBottom:this.handleEdge1Drag,edge2DragHandler=0===j?this.handleLineNSResizeTop:j===lines.length-1?this.handleLineNSResizeBottom:this.handleEdge2Drag,hoverHandler=interactive?{onHover:this.handleHover,onUnHover:this.handleHover}:{};return(0,jsx_runtime.jsxs)("g",{children:[(0,jsx_runtime.jsx)(InteractiveStraightLine.F$,{ref:this.saveNodeType(`line_${j}`),selected:selected||hover,...hoverHandler,type:lineType,x1Value:line.x1,y1Value:line.y,x2Value:line.x2,y2Value:line.y,strokeStyle,strokeWidth:hover||selected?strokeWidth+1:strokeWidth,interactiveCursorClass,onDragStart:this.handleLineDragStart,onDrag:dragHandler,onDragComplete}),(0,jsx_runtime.jsx)(Text,{selected,xyProvider:({xScale,chartConfig})=>{const{yScale}=chartConfig,{x1:lineX1,y1:lineY1,x2:lineX2}=(0,InteractiveStraightLine.sD)({type:lineType,start:[line.x1,line.y],end:[line.x2,line.y],xScale,yScale});return[xScale(Math.min(lineX1,lineX2))+10,yScale(lineY1)+4*dir]},fontFamily,fontSize,fillStyle:fontFill,children:text}),(0,jsx_runtime.jsx)(ClickableCircle.t,{ref:this.saveNodeType("edge1"),show:selected||hover,cx:line.x1,cy:line.y,r,fillStyle:firstOrLast?nsEdgeFill:edgeFill,strokeStyle:edgeStroke,strokeWidth:edgeStrokeWidth,interactiveCursorClass:interactiveEdgeCursorClass,onDrag:edge1DragHandler,onDragComplete}),(0,jsx_runtime.jsx)(ClickableCircle.t,{ref:this.saveNodeType("edge2"),show:selected||hover,cx:line.x2,cy:line.y,r,fillStyle:firstOrLast?nsEdgeFill:edgeFill,strokeStyle:edgeStroke,strokeWidth:edgeStrokeWidth,interactiveCursorClass:interactiveEdgeCursorClass,onDrag:edge2DragHandler,onDragComplete})]},j)}),(0,jsx_runtime.jsx)(HoverTextNearMouse.r,{show:hoverTextEnabled&&hover,...restHoverTextProps,text:selected?hoverTextSelected:hoverTextUnselected})]})}}EachFibRetracement.defaultProps={yDisplayFormat:d=>d.toFixed(2),interactive:!0,appearance:{strokeStyle:"#000000",strokeWidth:1,fontFamily:"-apple-system, system-ui, Roboto, 'Helvetica Neue', Ubuntu, sans-serif",fontSize:10,fontFill:"#000000",edgeStroke:"#000000",edgeFill:"#FFFFFF",nsEdgeFill:"#000000",edgeStrokeWidth:1,r:5},selected:!1,onDrag:noop.l,hoverText:{enable:!1}};class FibonacciRetracement extends react.Component{constructor(props){super(props),this.handleDrawRetracement=(_,xyValue)=>{const{current}=this.state;(0,utils.O9)(current)&&(0,utils.O9)(current.x1)&&(this.mouseMoved=!0,this.setState({current:{...current,x2:xyValue[0],y2:xyValue[1]}}))},this.handleEdge1Drag=(_,echo,newXYValue,origXYValue)=>{const{retracements}=this.props,{index}=echo,dx=origXYValue.x1Value-newXYValue.x1Value;this.setState({override:{index,x1:retracements[index].x1-dx,y1:retracements[index].y1,x2:retracements[index].x2,y2:retracements[index].y2}})},this.handleDrag=(_,index,xy)=>{this.setState({override:{index,...xy}})},this.handleEdge2Drag=(_,echo,newXYValue,origXYValue)=>{const{retracements}=this.props,{index}=echo,dx=origXYValue.x2Value-newXYValue.x2Value;this.setState({override:{index,x1:retracements[index].x1,y1:retracements[index].y1,x2:retracements[index].x2-dx,y2:retracements[index].y2}})},this.handleDragComplete=(e,moreProps)=>{const{retracements}=this.props,{override}=this.state;if((0,utils.O9)(override)){const{index,...rest}=override,newRetracements=retracements.map((each,idx)=>idx===index?{...each,...rest,selected:!0}:each);this.setState({override:null},()=>{const{onComplete}=this.props;void 0!==onComplete&&onComplete(e,newRetracements,moreProps)})}},this.handleStart=(e,xyValue,moreProps)=>{const{current}=this.state;((0,utils.pN)(current)||(0,utils.pN)(current.x1))&&(this.mouseMoved=!1,this.setState({current:{x1:xyValue[0],y1:xyValue[1],x2:null,y2:null}},()=>{const{onStart}=this.props;void 0!==onStart&&onStart(moreProps)}))},this.handleEnd=(e,xyValue,moreProps)=>{const{retracements,appearance,type}=this.props,{current}=this.state;if(this.mouseMoved&&(0,utils.O9)(current)&&(0,utils.O9)(current.x1)){const newRetracements=retracements.concat({...current,x2:xyValue[0],y2:xyValue[1],selected:!0,appearance,type});this.setState({current:null},()=>{const{onComplete}=this.props;void 0!==onComplete&&onComplete(e,newRetracements,moreProps)})}},this.handleEdge1Drag=this.handleEdge1Drag.bind(this),this.handleEdge2Drag=this.handleEdge2Drag.bind(this),this.terminate=lib_utils.MH.bind(this),this.getSelectionState=(0,lib_utils._W)("retracements").bind(this),this.saveNodeType=lib_utils.Ap.bind(this),this.state={}}render(){const{current,override}=this.state,{appearance,currentPositionStroke,currentPositionOpacity,currentPositionStrokeWidth,currentPositionRadius=FibonacciRetracement.defaultProps.currentPositionRadius,retracements,type}=this.props,{enabled,hoverText}=this.props,overrideIndex=(0,utils.O9)(override)?override.index:null,hoverTextWidthDefault={...FibonacciRetracement.defaultProps.hoverText,...hoverText},currentRetracement=(0,utils.O9)(current)&&(0,utils.O9)(current.x2)?(0,jsx_runtime.jsx)(EachFibRetracement,{interactive:!1,type,appearance,hoverText:hoverTextWidthDefault,...current}):null;return(0,jsx_runtime.jsxs)("g",{children:[retracements.map((each,idx)=>{const eachAppearance=(0,utils.O9)(each.appearance)?{...appearance,...each.appearance}:appearance,eachHoverText=(0,utils.O9)(each.hoverText)?{...hoverTextWidthDefault,...each.hoverText}:hoverTextWidthDefault;return(0,jsx_runtime.jsx)(EachFibRetracement,{ref:this.saveNodeType(idx),index:idx,type:each.type,selected:each.selected,...idx===overrideIndex?override:each,hoverText:eachHoverText,appearance:eachAppearance,onDrag:this.handleDrag,onDragComplete:this.handleDragComplete},idx)}),currentRetracement,(0,jsx_runtime.jsx)(MouseLocationIndicator.O,{enabled,snap:!1,r:currentPositionRadius,stroke:currentPositionStroke,opacity:currentPositionOpacity,strokeWidth:currentPositionStrokeWidth,onMouseDown:this.handleStart,onClick:this.handleEnd,onMouseMove:this.handleDrawRetracement})]})}}FibonacciRetracement.defaultProps={enabled:!0,type:"RAY",retracements:[],onSelect:noop.l,hoverText:{...HoverTextNearMouse.r.defaultProps,enable:!0,bgHeight:"auto",bgWidth:"auto",text:"Click to select object",selectedText:""},currentPositionStroke:"#000000",currentPositionOpacity:1,currentPositionStrokeWidth:3,currentPositionRadius:4,appearance:{strokeStyle:"#000000",strokeWidth:1,fontFamily:"-apple-system, system-ui, Roboto, 'Helvetica Neue', Ubuntu, sans-serif",fontSize:11,fontFill:"#000000",edgeStroke:"#000000",edgeFill:"#FFFFFF",nsEdgeFill:"#000000",edgeStrokeWidth:1,r:5}};var DrawingObjectSelector=__webpack_require__("../interactive/lib/DrawingObjectSelector.js"),withSize=__webpack_require__("../utils/lib/withSize.js"),withDeviceRatio=__webpack_require__("../utils/lib/withDeviceRatio.js"),data=__webpack_require__("./src/data/index.ts");class FibonacciChart extends react.Component{constructor(props){super(props),this.interactiveNodes={},this.onKeyPress=e=>{switch(e.key.toLowerCase()){case"escape":this.setState({enableFibonacci:!1});break;case"delete":case"backspace":this.setState(prevState=>({retracements:Array.isArray(prevState.retracements)?prevState.retracements.filter(retracement=>!retracement.selected):[]}));break;case"f":this.setState({enableFibonacci:!0})}},this.onDrawComplete=(e,newRetracements,_moreProps)=>{this.setState({enableFibonacci:!1,retracements:newRetracements})},this.handleSelection=(e,interactives,moreProps)=>{const newState=this.toObject(interactives,each=>[1===each.chartId?"retracements":`${each.type.toLowerCase()}_${each.chartId}`,each.objects||[]]);this.setState(newState)},this.state={enableFibonacci:!1,retracements:[]},this.saveInteractiveNodes=this.saveInteractiveNodes.bind(this),this.getInteractiveNodes=this.getInteractiveNodes.bind(this)}saveInteractiveNodes(type,chartId){return node=>{this.interactiveNodes||(this.interactiveNodes={});const key=`${type}_${chartId}`;(node||this.interactiveNodes[key])&&(this.interactiveNodes={...this.interactiveNodes,[key]:{type,chartId,node}})}}getInteractiveNodes(){return this.interactiveNodes}componentDidMount(){document.addEventListener("keydown",this.onKeyPress)}componentWillUnmount(){document.removeEventListener("keydown",this.onKeyPress)}toObject(interactives,keyMapper){const obj={};return interactives.forEach(each=>{const[key,value]=keyMapper(each);obj[key]=value}),obj}render(){const{data,height,width,ratio}=this.props,{enableFibonacci,retracements}=this.state,safeRetracements=Array.isArray(retracements)?retracements:[],xScaleProvider=discontinuousTimeScaleProvider.A.inputDateAccessor(d=>d.date),{data:chartData,xScale,xAccessor,displayXAccessor}=xScaleProvider(data),xExtents=[xAccessor(chartData[chartData.length-200]),xAccessor(chartData[chartData.length-1])];return(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("div",{style:{padding:"10px",borderBottom:"1px solid #ccc",backgroundColor:"#f5f5f5",display:"flex",gap:"10px",alignItems:"center"},children:[(0,jsx_runtime.jsx)("button",{onClick:()=>this.setState({enableFibonacci:!0}),style:{backgroundColor:enableFibonacci?"#007bff":"#fff",color:enableFibonacci?"#fff":"#000",border:"1px solid #ccc",padding:"8px 12px",cursor:"pointer"},children:"Draw Fibonacci (F)"}),(0,jsx_runtime.jsx)("button",{onClick:()=>this.setState({enableFibonacci:!1}),style:{backgroundColor:enableFibonacci?"#fff":"#007bff",color:enableFibonacci?"#000":"#fff",border:"1px solid #ccc",padding:"8px 12px",cursor:"pointer"},children:"Select Mode"}),(0,jsx_runtime.jsxs)("div",{style:{marginLeft:"20px",color:"#666"},children:["Mode: ",enableFibonacci?"Drawing":"Select"," | Retracements: ",safeRetracements.length," | ESC: Cancel | DEL: Delete Selected | Selector: ",enableFibonacci?"DISABLED":"ENABLED"]})]}),(0,jsx_runtime.jsxs)(ChartCanvas.v,{height,width,ratio,margin:{left:70,right:70,top:20,bottom:30},data:chartData,displayXAccessor,seriesName:"Data",xScale,xAccessor,xExtents,children:[(0,jsx_runtime.jsxs)(Chart.t,{id:1,yExtents:d=>[d.high,d.low],children:[(0,jsx_runtime.jsx)(XAxis.W,{}),(0,jsx_runtime.jsx)(YAxis.h,{}),(0,jsx_runtime.jsx)(CandlestickSeries.H,{}),(0,jsx_runtime.jsx)(FibonacciRetracement,{ref:this.saveInteractiveNodes("FibonacciRetracement",1),enabled:enableFibonacci,snap:!1,onStart:()=>{},onComplete:this.onDrawComplete,retracements:safeRetracements}),(0,jsx_runtime.jsx)(MouseCoordinateY.R,{displayFormat:(0,defaultLocale.GP)(".2f")}),(0,jsx_runtime.jsx)(MouseCoordinateX.Y,{displayFormat:(0,src_defaultLocale.DC)("%Y-%m-%d")}),(0,jsx_runtime.jsx)(DrawingObjectSelector.D,{enabled:!enableFibonacci,getInteractiveNodes:this.getInteractiveNodes,drawingObjectMap:{FibonacciRetracement:"retracements"},onSelect:this.handleSelection})]}),(0,jsx_runtime.jsx)(CrossHairCursor.H,{})]})]})}}const interactive_FibonacciChart=(0,data.p)()((0,withSize.U)({style:{minHeight:600}})((0,withDeviceRatio.O)()(FibonacciChart))),FibonacciChart_stories={title:"Interactive/Fibonacci Retracement",component:interactive_FibonacciChart,parameters:{layout:"fullscreen"}},Default={render:()=>(0,jsx_runtime.jsx)(interactive_FibonacciChart,{})},__namedExportsOrder=["Default"];Default.parameters={...Default.parameters,docs:{...Default.parameters?.docs,source:{originalSource:"{\n  render: () => <FibonacciChart />\n}",...Default.parameters?.docs?.source}}}}}]);