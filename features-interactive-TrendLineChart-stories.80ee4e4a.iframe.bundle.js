"use strict";(self.webpackChunk_react_stockcharts3_stories=self.webpackChunk_react_stockcharts3_stories||[]).push([[2215],{"../interactive/lib/components/ClickableCircle.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{t:()=>ClickableCircle});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/react/jsx-runtime.js"),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/react/index.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../core/lib/GenericChartComponent.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../core/lib/GenericComponent.js");class ClickableCircle extends react__WEBPACK_IMPORTED_MODULE_1__.Component{constructor(){super(...arguments),this.drawOnCanvas=(ctx,moreProps)=>{const{strokeStyle,strokeWidth,fillStyle,r}=this.props;ctx.lineWidth=strokeWidth,ctx.fillStyle=fillStyle,ctx.strokeStyle=strokeStyle;const[x,y]=this.helper(moreProps);ctx.beginPath(),ctx.arc(x,y,r,0,2*Math.PI,!1),ctx.fill(),ctx.stroke()},this.isHover=moreProps=>{const{mouseXY}=moreProps,r=this.props.r+7,[x,y]=this.helper(moreProps),[mx,my]=mouseXY;return x-r<mx&&mx<x+r&&y-r<my&&my<y+r},this.helper=moreProps=>{const{xyProvider,cx,cy}=this.props;if(void 0!==xyProvider)return xyProvider(moreProps);const{xScale,chartConfig:{yScale}}=moreProps;return[xScale(cx),yScale(cy)]}}render(){const{interactiveCursorClass,onDragStart,onDrag,onDragComplete,show}=this.props;return show?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_2__.P,{interactiveCursorClass,selected:!0,isHover:this.isHover,onDragStart,onDrag,onDragComplete,canvasDraw:this.drawOnCanvas,canvasToDraw:_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__.wk,drawOn:["pan","mousemove","drag"]}):null}}ClickableCircle.defaultProps={className:"react-financial-charts-interactive-line-edge",show:!1}},"../interactive/lib/components/InteractiveStraightLine.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{AK:()=>getSlope,F$:()=>InteractiveStraightLine,KU:()=>getYIntercept,Lg:()=>isHovering,ph:()=>isHovering2,sD:()=>generateLine});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/react/jsx-runtime.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../core/lib/GenericChartComponent.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../core/lib/GenericComponent.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../core/lib/utils/noop.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../core/lib/utils/strokeDasharray.js"),react__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../node_modules/react/index.js");class InteractiveStraightLine extends react__WEBPACK_IMPORTED_MODULE_5__.Component{constructor(){super(...arguments),this.isHover=moreProps=>{const{tolerance,onHover}=this.props;if(void 0!==onHover){const{x1Value,x2Value,y1Value,y2Value,type}=this.props,{mouseXY,xScale}=moreProps,{chartConfig:{yScale}}=moreProps;return isHovering({x1Value,y1Value,x2Value,y2Value,mouseXY,type,tolerance,xScale,yScale})}return!1},this.drawOnCanvas=(ctx,moreProps)=>{const{strokeWidth=InteractiveStraightLine.defaultProps.strokeWidth,strokeDasharray,strokeStyle}=this.props,{x1,y1,x2,y2}=function helper(props,moreProps){const{x1Value,x2Value,y1Value,y2Value,type}=props,{xScale,chartConfig:{yScale}}=moreProps,modLine=generateLine({type,start:[x1Value,y1Value],end:[x2Value,y2Value],xScale,yScale}),x1=xScale(modLine.x1),y1=yScale(modLine.y1),x2=xScale(modLine.x2),y2=yScale(modLine.y2);return{x1,y1,x2,y2}}(this.props,moreProps);ctx.lineWidth=strokeWidth,ctx.strokeStyle=strokeStyle;const lineDash=(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_4__.y)(strokeDasharray);ctx.setLineDash(lineDash),ctx.beginPath(),ctx.moveTo(x1,y1),ctx.lineTo(x2,y2),ctx.stroke()}}render(){const{selected,interactiveCursorClass}=this.props,{onDragStart,onDrag,onDragComplete,onHover,onUnHover}=this.props;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_1__.P,{isHover:this.isHover,canvasToDraw:_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_2__.wk,canvasDraw:this.drawOnCanvas,interactiveCursorClass,selected,onDragStart,onDrag,onDragComplete,onHover,onUnHover,drawOn:["mousemove","pan","drag"]})}}function isHovering2(start,end,[mouseX,mouseY],tolerance){const m=getSlope(start,end);if(void 0!==m){const y=m*mouseX+getYIntercept(m,end);return mouseY<y+tolerance&&mouseY>y-tolerance&&mouseX>Math.min(start[0],end[0])-tolerance&&mouseX<Math.max(start[0],end[0])+tolerance}return mouseY>=Math.min(start[1],end[1])&&mouseY<=Math.max(start[1],end[1])&&mouseX<start[0]+tolerance&&mouseX>start[0]-tolerance}function isHovering({x1Value,y1Value,x2Value,y2Value,mouseXY,type,tolerance,xScale,yScale}){const line=generateLine({type,start:[x1Value,y1Value],end:[x2Value,y2Value],xScale,yScale}),start=[xScale(line.x1),yScale(line.y1)],end=[xScale(line.x2),yScale(line.y2)],m=getSlope(start,end),[mouseX,mouseY]=mouseXY;if(void 0!==m){const y=m*mouseX+getYIntercept(m,end);return mouseY<y+tolerance&&mouseY>y-tolerance&&mouseX>Math.min(start[0],end[0])-tolerance&&mouseX<Math.max(start[0],end[0])+tolerance}return mouseY>=Math.min(start[1],end[1])&&mouseY<=Math.max(start[1],end[1])&&mouseX<start[0]+tolerance&&mouseX>start[0]-tolerance}function getSlope(start,end){return end[0]===start[0]?void 0:(end[1]-start[1])/(end[0]-start[0])}function getYIntercept(m,end){return-1*m*end[0]+end[1]}function generateLine({type,start,end,xScale,yScale}){const m=getSlope(start,end),b=getYIntercept(m,start);switch(type){case"XLINE":return function getXLineCoordinates({start,end,xScale,yScale,m,b}){const[xBegin,xFinish]=xScale.domain(),[yBegin,yFinish]=yScale.domain();if(end[0]===start[0])return{x1:end[0],y1:yBegin,x2:end[0],y2:yFinish};const[x1,x2]=end[0]>start[0]?[xBegin,xFinish]:[xFinish,xBegin];return{x1,y1:m*x1+b,x2,y2:m*x2+b}}({start,end,xScale,yScale,m,b});case"RAY":return function getRayCoordinates({start,end,xScale,yScale,m,b}){const[xBegin,xFinish]=xScale.domain(),[yBegin,yFinish]=yScale.domain(),x1=start[0];if(end[0]===start[0])return{x1,y1:start[1],x2:x1,y2:end[1]>start[1]?yFinish:yBegin};const x2=end[0]>start[0]?xFinish:xBegin;return{x1,y1:m*x1+b,x2,y2:m*x2+b}}({start,end,xScale,yScale,m,b});default:return function getLineCoordinates({start,end}){const[x1,y1]=start,[x2,y2]=end;if(end[0]===start[0])return{x1,y1:start[1],x2:x1,y2:end[1]};return{x1,y1,x2,y2}}({start,end})}}InteractiveStraightLine.defaultProps={onEdge1Drag:_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__.l,onEdge2Drag:_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__.l,edgeStrokeWidth:3,edgeStroke:"#000000",edgeFill:"#FFFFFF",r:10,withEdge:!1,strokeWidth:1,strokeDasharray:"Solid",children:_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__.l,tolerance:7,selected:!1}},"../interactive/lib/components/MouseLocationIndicator.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{O:()=>MouseLocationIndicator});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/react/jsx-runtime.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../core/lib/GenericChartComponent.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../core/lib/GenericComponent.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../core/lib/utils/noop.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../core/lib/utils/index.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../core/lib/utils/shallowEqual.js"),react__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../node_modules/react/index.js"),_react_stockcharts3_core_lib_utils_ChartDataUtil__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../core/lib/utils/ChartDataUtil.js");class MouseLocationIndicator extends react__WEBPACK_IMPORTED_MODULE_6__.Component{constructor(){super(...arguments),this.mutableState={},this.xy=(e,moreProps)=>{const{xAccessor,plotData}=moreProps,{mouseXY,currentItem,xScale,chartConfig:{yScale}}=moreProps,{enabled,snap,shouldDisableSnap,snapTo}=this.props;if(enabled&&(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_4__.O9)(currentItem)&&(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_4__.O9)(e)){const xValue=snap&&!shouldDisableSnap(e)?xAccessor(currentItem):(0,_react_stockcharts3_core_lib_utils_ChartDataUtil__WEBPACK_IMPORTED_MODULE_7__.M4)(xScale,xAccessor,mouseXY,plotData),yValue=snap&&void 0!==snapTo&&!shouldDisableSnap(e)?(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_4__.xZ)(snapTo(currentItem),yScale.invert(mouseXY[1])):yScale.invert(mouseXY[1]);return{xValue,yValue,x:xScale(xValue),y:yScale(yValue)}}},this.handleClick=(e,moreProps)=>{const pos=this.xy(e,moreProps);if(void 0!==pos&&(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_4__.O9)(pos)){const{xValue,yValue,x,y}=pos;this.mutableState={x,y},this.props.onClick(e,[xValue,yValue],moreProps)}},this.handleMouseDown=(e,moreProps)=>{const pos=this.xy(e,moreProps);if(void 0!==pos&&(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_4__.O9)(pos)){const{xValue,yValue,x,y}=pos;this.mutableState={x,y},this.props.onMouseDown(e,[xValue,yValue],moreProps)}},this.handleMousePosChange=(e,moreProps)=>{if(!(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_5__.b)(moreProps.mousXY,moreProps.prevMouseXY)){const pos=this.xy(e,moreProps);if(void 0!==pos&&(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_4__.O9)(pos)){const{xValue,yValue,x,y}=pos;this.mutableState={x,y},this.props.onMouseMove(e,[xValue,yValue],moreProps)}}},this.drawOnCanvas=(ctx,moreProps)=>{const{enabled,r,stroke,strokeWidth}=this.props,{x,y}=this.mutableState,{show}=moreProps;enabled&&show&&(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_4__.O9)(x)&&(ctx.lineWidth=strokeWidth,ctx.strokeStyle=stroke,ctx.moveTo(x,y),ctx.beginPath(),ctx.arc(x,y,r,0,2*Math.PI,!1),ctx.stroke())}}render(){const{enabled,disablePan}=this.props;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_1__.P,{onMouseDown:this.handleMouseDown,onClick:this.handleClick,onMouseMove:this.handleMousePosChange,onPan:this.handleMousePosChange,disablePan:enabled&&disablePan,canvasDraw:this.drawOnCanvas,canvasToDraw:_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_2__.wk,drawOn:["mousemove","pan"]})}}MouseLocationIndicator.defaultProps={onMouseMove:_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__.l,onMouseDown:_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__.l,onClick:_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__.l,shouldDisableSnap:(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_4__.ER)(!1),stroke:"#000000",strokeWidth:1,opacity:1,disablePan:!0}},"../interactive/lib/wrapper/EachTrendLine.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{N:()=>EachTrendLine,Q:()=>getNewXY});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/react/jsx-runtime.js"),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/react/index.js"),d3_array__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../node_modules/d3-array/src/ascending.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../core/lib/utils/noop.js"),_react_stockcharts3_core_lib_utils_ChartDataUtil__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../core/lib/utils/ChartDataUtil.js"),_utils__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../interactive/lib/utils.js"),_components__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../interactive/lib/components/ClickableCircle.js"),_components__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../interactive/lib/components/HoverTextNearMouse.js"),_components__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("../interactive/lib/components/InteractiveStraightLine.js");class EachTrendLine extends react__WEBPACK_IMPORTED_MODULE_1__.Component{constructor(props){super(props),this.handleHover=(_,moreProps)=>{this.state.hover!==moreProps.hovering&&this.setState({hover:moreProps.hovering})},this.handleEdge2Drag=(e,moreProps)=>{const{index,onDrag,x1Value,y1Value}=this.props,[x2Value,y2Value]=getNewXY(moreProps);onDrag(e,index,{x1Value,y1Value,x2Value,y2Value})},this.handleEdge1Drag=(e,moreProps)=>{const{index,onDrag,x2Value,y2Value}=this.props,[x1Value,y1Value]=getNewXY(moreProps);onDrag(e,index,{x1Value,y1Value,x2Value,y2Value})},this.handleDragComplete=(e,moreProps)=>{this.setState({anchor:void 0});const{onDragComplete}=this.props;void 0!==onDragComplete&&onDragComplete(e,moreProps)},this.handleEdge2DragStart=()=>{this.setState({anchor:"edge1"})},this.handleEdge1DragStart=()=>{this.setState({anchor:"edge2"})},this.handleLineDrag=(e,moreProps)=>{const{index,onDrag}=this.props,{x1Value,y1Value,x2Value,y2Value}=this.dragStart,{xScale,chartConfig:{yScale},xAccessor,fullData}=moreProps,{startPos,mouseXY}=moreProps,x1=xScale(x1Value),y1=yScale(y1Value),x2=xScale(x2Value),y2=yScale(y2Value),dx=startPos[0]-mouseXY[0],dy=startPos[1]-mouseXY[1];onDrag(e,index,{x1Value:(0,_react_stockcharts3_core_lib_utils_ChartDataUtil__WEBPACK_IMPORTED_MODULE_4__.M4)(xScale,xAccessor,[x1-dx,y1-dy],fullData),y1Value:yScale.invert(y1-dy),x2Value:(0,_react_stockcharts3_core_lib_utils_ChartDataUtil__WEBPACK_IMPORTED_MODULE_4__.M4)(xScale,xAccessor,[x2-dx,y2-dy],fullData),y2Value:yScale.invert(y2-dy)})},this.handleLineDragStart=()=>{const{x1Value,y1Value,x2Value,y2Value}=this.props;this.dragStart={x1Value,y1Value,x2Value,y2Value}},this.isHover=_utils__WEBPACK_IMPORTED_MODULE_5__.FK.bind(this),this.saveNodeType=_utils__WEBPACK_IMPORTED_MODULE_5__.Ap.bind(this),this.state={hover:!1}}render(){const{x1Value,y1Value,x2Value,y2Value,type,strokeStyle,strokeWidth,strokeDasharray,r,edgeStrokeWidth,edgeFill,edgeStroke,edgeInteractiveCursor,lineInteractiveCursor,hoverText,selected,onDragComplete}=this.props,{enable:hoverTextEnabled,selectedText:hoverTextSelected,text:hoverTextUnselected,...restHoverTextProps}=hoverText,{hover,anchor}=this.state;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("g",{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_components__WEBPACK_IMPORTED_MODULE_8__.F$,{ref:this.saveNodeType("line"),selected:selected||hover,onHover:this.handleHover,onUnHover:this.handleHover,x1Value,y1Value,x2Value,y2Value,type,strokeStyle,strokeWidth:hover||selected?strokeWidth+1:strokeWidth,strokeDasharray,interactiveCursorClass:lineInteractiveCursor,onDragStart:this.handleLineDragStart,onDrag:this.handleLineDrag,onDragComplete}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_components__WEBPACK_IMPORTED_MODULE_6__.t,{ref:this.saveNodeType("edge1"),show:selected||hover,cx:x1Value,cy:y1Value,r,fillStyle:edgeFill,strokeStyle:"edge1"===anchor?strokeStyle:edgeStroke,strokeWidth:edgeStrokeWidth,interactiveCursorClass:edgeInteractiveCursor,onDragStart:this.handleEdge1DragStart,onDrag:this.handleEdge1Drag,onDragComplete:this.handleDragComplete}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_components__WEBPACK_IMPORTED_MODULE_6__.t,{ref:this.saveNodeType("edge2"),show:selected||hover,cx:x2Value,cy:y2Value,r,fillStyle:edgeFill,strokeStyle:"edge2"===anchor?strokeStyle:edgeStroke,strokeWidth:edgeStrokeWidth,interactiveCursorClass:edgeInteractiveCursor,onDragStart:this.handleEdge2DragStart,onDrag:this.handleEdge2Drag,onDragComplete:this.handleDragComplete}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_components__WEBPACK_IMPORTED_MODULE_7__.r,{show:hoverTextEnabled&&hover,...restHoverTextProps,text:selected?hoverTextSelected:hoverTextUnselected})]})}}function getNewXY(moreProps){const{xScale,chartConfig:{yScale},xAccessor,plotData,mouseXY}=moreProps,mouseY=mouseXY[1],x=(0,_react_stockcharts3_core_lib_utils_ChartDataUtil__WEBPACK_IMPORTED_MODULE_4__.M4)(xScale,xAccessor,mouseXY,plotData),[small,big]=yScale.domain().slice().sort(d3_array__WEBPACK_IMPORTED_MODULE_2__.A),y=yScale.invert(mouseY);return[x,Math.min(Math.max(y,small),big)]}EachTrendLine.defaultProps={onDrag:_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__.l,onEdge1Drag:_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__.l,onEdge2Drag:_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__.l,onSelect:_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__.l,selected:!1,edgeStroke:"#000000",edgeFill:"#FFFFFF",edgeStrokeWidth:2,r:5,strokeWidth:1,strokeDasharray:"Solid",hoverText:{enable:!1}}},"./src/features/interactive/TrendLineChart.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,__namedExportsOrder:()=>__namedExportsOrder,default:()=>TrendLineChart_stories});var jsx_runtime=__webpack_require__("../../node_modules/react/jsx-runtime.js"),react=__webpack_require__("../../node_modules/react/index.js"),defaultLocale=__webpack_require__("../../node_modules/d3-format/src/defaultLocale.js"),src_defaultLocale=__webpack_require__("../../node_modules/d3-time-format/src/defaultLocale.js"),ChartCanvas=__webpack_require__("../core/lib/ChartCanvas.js"),Chart=__webpack_require__("../core/lib/Chart.js"),XAxis=__webpack_require__("../axes/lib/XAxis.js"),YAxis=__webpack_require__("../axes/lib/YAxis.js"),CandlestickSeries=__webpack_require__("../series/lib/CandlestickSeries.js"),MouseCoordinateY=__webpack_require__("../coordinates/lib/MouseCoordinateY.js"),MouseCoordinateX=__webpack_require__("../coordinates/lib/MouseCoordinateX.js"),CrossHairCursor=__webpack_require__("../coordinates/lib/CrossHairCursor.js"),discontinuousTimeScaleProvider=__webpack_require__("../scales/lib/discontinuousTimeScaleProvider.js"),utils=__webpack_require__("../core/lib/utils/index.js"),noop=__webpack_require__("../core/lib/utils/noop.js"),lib_utils=__webpack_require__("../interactive/lib/utils.js"),InteractiveStraightLine=__webpack_require__("../interactive/lib/components/InteractiveStraightLine.js"),MouseLocationIndicator=__webpack_require__("../interactive/lib/components/MouseLocationIndicator.js"),HoverTextNearMouse=__webpack_require__("../interactive/lib/components/HoverTextNearMouse.js"),EachTrendLine=__webpack_require__("../interactive/lib/wrapper/EachTrendLine.js");class TrendLine extends react.Component{constructor(props){super(props),this.handleEnd=(e,xyValue,moreProps)=>{const{current}=this.state,{trends,appearance,type}=this.props;if(this.mouseMoved&&(0,utils.O9)(current)&&(0,utils.O9)(current.start)){const newTrends=[...trends.map(d=>({...d,selected:!1})),{start:current.start,end:xyValue,selected:!0,appearance,type}];this.setState({current:null,trends:newTrends},()=>{const{onComplete}=this.props;void 0!==onComplete&&onComplete(e,newTrends,moreProps)})}},this.handleStart=(e,xyValue,moreProps)=>{const{current}=this.state,{drawingMode=TrendLine.defaultProps.drawingMode}=this.props;drawingMode&&((0,utils.pN)(current)||(0,utils.pN)(current.start))&&(this.mouseMoved=!1,this.setState({current:{start:xyValue,end:null}},()=>{const{onStart}=this.props;void 0!==onStart&&onStart(e,moreProps)}))},this.handleDrawLine=(_,xyValue)=>{const{current}=this.state;(0,utils.O9)(current)&&(0,utils.O9)(current.start)&&(this.mouseMoved=!0,this.setState({current:{start:current.start,end:xyValue}}))},this.handleDragLineComplete=(e,moreProps)=>{const{override}=this.state;if((0,utils.O9)(override)){const{trends}=this.props,newTrends=trends.map((each,idx)=>idx===override.index?{...each,start:[override.x1Value,override.y1Value],end:[override.x2Value,override.y2Value],selected:!0}:{...each,selected:!1});this.setState({override:null},()=>{const{onComplete}=this.props;void 0!==onComplete&&onComplete(e,newTrends,moreProps)})}},this.handleDragLine=(_,index,newXYValue)=>{this.setState({override:{index,...newXYValue}})},this.terminate=lib_utils.MH.bind(this),this.saveNodeType=lib_utils.Ap.bind(this),this.getSelectionState=(0,lib_utils._W)("trends").bind(this),this.state={}}render(){const{appearance,currentPositionstrokeOpacity,currentPositionRadius=TrendLine.defaultProps.currentPositionRadius,currentPositionStroke,currentPositionStrokeWidth,enabled,hoverText,shouldDisableSnap,snap,snapTo,trends,type}=this.props,{current,override}=this.state,tempLine=(0,utils.O9)(current)&&(0,utils.O9)(current.end)?(0,jsx_runtime.jsx)(InteractiveStraightLine.F$,{type,x1Value:current.start[0],y1Value:current.start[1],x2Value:current.end[0],y2Value:current.end[1],strokeStyle:appearance.strokeStyle,strokeWidth:appearance.strokeWidth}):null;return(0,jsx_runtime.jsxs)("g",{children:[trends.map((each,idx)=>{const eachAppearance=(0,utils.O9)(each.appearance)?{...appearance,...each.appearance}:appearance,hoverTextWithDefault={...TrendLine.defaultProps.hoverText,...hoverText};return(0,jsx_runtime.jsx)(EachTrendLine.N,{ref:this.saveNodeType(idx),index:idx,type:each.type,selected:each.selected,x1Value:(0,lib_utils.Ur)(override,idx,"x1Value",each.start[0]),y1Value:(0,lib_utils.Ur)(override,idx,"y1Value",each.start[1]),x2Value:(0,lib_utils.Ur)(override,idx,"x2Value",each.end[0]),y2Value:(0,lib_utils.Ur)(override,idx,"y2Value",each.end[1]),strokeStyle:eachAppearance.strokeStyle,strokeWidth:eachAppearance.strokeWidth,strokeOpacity:eachAppearance.strokeOpacity,strokeDasharray:eachAppearance.strokeDasharray,edgeStroke:eachAppearance.edgeStroke,edgeFill:eachAppearance.edgeFill,edgeStrokeWidth:eachAppearance.edgeStrokeWidth,r:eachAppearance.r,hoverText:hoverTextWithDefault,onDrag:this.handleDragLine,onDragComplete:this.handleDragLineComplete,edgeInteractiveCursor:"react-financial-charts-move-cursor",lineInteractiveCursor:"react-financial-charts-move-cursor"},idx)}),tempLine,(0,jsx_runtime.jsx)(MouseLocationIndicator.O,{enabled,snap,shouldDisableSnap,snapTo,r:currentPositionRadius,stroke:currentPositionStroke,opacity:currentPositionstrokeOpacity,strokeWidth:currentPositionStrokeWidth,onMouseDown:this.handleStart,onClick:this.handleEnd,onMouseMove:this.handleDrawLine})]})}}TrendLine.defaultProps={type:"XLINE",drawingMode:!0,onStart:noop.l,onSelect:noop.l,currentPositionStroke:"#000000",currentPositionstrokeOpacity:1,currentPositionStrokeWidth:3,currentPositionRadius:0,shouldDisableSnap:e=>2===e.button||e.shiftKey,hoverText:{...HoverTextNearMouse.r.defaultProps,enable:!0,bgHeight:"auto",bgWidth:"auto",text:"Click to select object",selectedText:""},trends:[],appearance:{strokeStyle:"#000000",strokeWidth:1,strokeDasharray:"Solid",edgeStrokeWidth:1,edgeFill:"#FFFFFF",edgeStroke:"#000000",r:6}};var DrawingObjectSelector=__webpack_require__("../interactive/lib/DrawingObjectSelector.js"),withSize=__webpack_require__("../utils/lib/withSize.js"),withDeviceRatio=__webpack_require__("../utils/lib/withDeviceRatio.js"),data=__webpack_require__("./src/data/index.ts");class TrendLineChart extends react.Component{constructor(props){super(props),this.interactiveNodes={},this.onKeyPress=e=>{switch(e.key.toLowerCase()){case"escape":this.setState({enableTrendLine:!1});break;case"delete":case"backspace":this.setState(prevState=>({trends:Array.isArray(prevState.trends)?prevState.trends.filter(trend=>!trend.selected):[]}));break;case"d":case"t":this.setState({enableTrendLine:!0})}},this.onDrawComplete=(e,newTrends,_moreProps)=>{this.setState({enableTrendLine:!1,trends:newTrends})},this.handleSelection=(e,interactives,moreProps)=>{const newState=this.toObject(interactives,each=>[1===each.chartId?"trends":`${each.type.toLowerCase()}_${each.chartId}`,each.objects||[]]);this.setState(newState)},this.state={enableTrendLine:!1,trends:[]},this.saveInteractiveNodes=this.saveInteractiveNodes.bind(this),this.getInteractiveNodes=this.getInteractiveNodes.bind(this)}saveInteractiveNodes(type,chartId){return node=>{this.interactiveNodes||(this.interactiveNodes={});const key=`${type}_${chartId}`;(node||this.interactiveNodes[key])&&(this.interactiveNodes={...this.interactiveNodes,[key]:{type,chartId,node}})}}getInteractiveNodes(){return this.interactiveNodes}handleSelectionState(type,chartId){return selectionArray=>{const stateKey=1===chartId?"trends":`${type.toLowerCase()}_${chartId}`,interactive=this.state[stateKey].map((each,idx)=>({...each,selected:selectionArray[idx]}));this.setState({[stateKey]:interactive})}}componentDidMount(){document.addEventListener("keydown",this.onKeyPress)}componentWillUnmount(){document.removeEventListener("keydown",this.onKeyPress)}toObject(interactives,keyMapper){const obj={};return interactives.forEach(each=>{const[key,value]=keyMapper(each);obj[key]=value}),obj}render(){const{data,height,width,ratio}=this.props,{enableTrendLine,trends}=this.state,safeTrends=Array.isArray(trends)?trends:[],xScaleProvider=discontinuousTimeScaleProvider.A.inputDateAccessor(d=>d.date),{data:chartData,xScale,xAccessor,displayXAccessor}=xScaleProvider(data),xExtents=[xAccessor(chartData[chartData.length-200]),xAccessor(chartData[chartData.length-1])];return(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("div",{style:{padding:"10px",borderBottom:"1px solid #ccc",backgroundColor:"#f5f5f5",display:"flex",gap:"10px",alignItems:"center"},children:[(0,jsx_runtime.jsx)("button",{onClick:()=>this.setState({enableTrendLine:!0}),style:{backgroundColor:enableTrendLine?"#007bff":"#fff",color:enableTrendLine?"#fff":"#000",border:"1px solid #ccc",padding:"8px 12px",cursor:"pointer"},children:"Draw Trend Line (D/T)"}),(0,jsx_runtime.jsx)("button",{onClick:()=>this.setState({enableTrendLine:!1}),style:{backgroundColor:enableTrendLine?"#fff":"#007bff",color:enableTrendLine?"#000":"#fff",border:"1px solid #ccc",padding:"8px 12px",cursor:"pointer"},children:"Select Mode"}),(0,jsx_runtime.jsxs)("div",{style:{marginLeft:"20px",color:"#666"},children:["Mode: ",enableTrendLine?"Drawing":"Select"," | Trends: ",safeTrends.length," | ESC: Cancel | DEL: Delete Selected | Selector: ",enableTrendLine?"DISABLED":"ENABLED"]})]}),(0,jsx_runtime.jsxs)(ChartCanvas.v,{height,width,ratio,margin:{left:70,right:70,top:20,bottom:30},data:chartData,displayXAccessor,seriesName:"Data",xScale,xAccessor,xExtents,children:[(0,jsx_runtime.jsxs)(Chart.t,{id:1,yExtents:d=>[d.high,d.low],children:[(0,jsx_runtime.jsx)(XAxis.W,{}),(0,jsx_runtime.jsx)(YAxis.h,{}),(0,jsx_runtime.jsx)(CandlestickSeries.H,{}),(0,jsx_runtime.jsx)(TrendLine,{ref:this.saveInteractiveNodes("TrendLine",1),enabled:enableTrendLine,type:"RAY",snap:!1,onStart:()=>{},onComplete:this.onDrawComplete,trends:safeTrends}),(0,jsx_runtime.jsx)(MouseCoordinateY.R,{displayFormat:(0,defaultLocale.GP)(".2f")}),(0,jsx_runtime.jsx)(MouseCoordinateX.Y,{displayFormat:(0,src_defaultLocale.DC)("%Y-%m-%d")}),(0,jsx_runtime.jsx)(DrawingObjectSelector.D,{enabled:!enableTrendLine,getInteractiveNodes:this.getInteractiveNodes,drawingObjectMap:{TrendLine:"trends"},onSelect:this.handleSelection})]}),(0,jsx_runtime.jsx)(CrossHairCursor.H,{})]})]})}}const interactive_TrendLineChart=(0,data.p)()((0,withSize.U)({style:{minHeight:600}})((0,withDeviceRatio.O)()(TrendLineChart))),TrendLineChart_stories={title:"Interactive/Trend Line",component:interactive_TrendLineChart,parameters:{layout:"fullscreen"}},Default={render:()=>(0,jsx_runtime.jsx)(interactive_TrendLineChart,{})},__namedExportsOrder=["Default"];Default.parameters={...Default.parameters,docs:{...Default.parameters?.docs,source:{originalSource:"{\n  render: () => <TrendLineChart />\n}",...Default.parameters?.docs?.source}}}}}]);