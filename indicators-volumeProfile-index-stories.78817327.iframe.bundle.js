"use strict";(self.webpackChunk_react_stockcharts3_stories=self.webpackChunk_react_stockcharts3_stories||[]).push([[332],{"../../node_modules/d3-array/src/group.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Ay:()=>group,z:()=>rollup});var internmap__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/internmap/src/index.js"),_identity_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/d3-array/src/identity.js");function group(values,...keys){return nest(values,_identity_js__WEBPACK_IMPORTED_MODULE_1__.A,_identity_js__WEBPACK_IMPORTED_MODULE_1__.A,keys)}function rollup(values,reduce,...keys){return nest(values,_identity_js__WEBPACK_IMPORTED_MODULE_1__.A,reduce,keys)}function nest(values,map,reduce,keys){return function regroup(values,i){if(i>=keys.length)return reduce(values);const groups=new internmap__WEBPACK_IMPORTED_MODULE_0__.B,keyof=keys[i++];let index=-1;for(const value of values){const key=keyof(value,++index,values),group=groups.get(key);group?group.push(value):groups.set(key,[value])}for(const[key,values]of groups)groups.set(key,regroup(values,i));return map(groups)}(values,0)}},"../../node_modules/d3-array/src/identity.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function __WEBPACK_DEFAULT_EXPORT__(x){return x}__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__})},"../../node_modules/d3-array/src/merge.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function merge(arrays){return Array.from(function*flatten(arrays){for(const array of arrays)yield*array}(arrays))}__webpack_require__.d(__webpack_exports__,{A:()=>merge})},"../../node_modules/d3-array/src/sum.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function sum(values,valueof){let sum=0;if(void 0===valueof)for(let value of values)(value=+value)&&(sum+=value);else{let index=-1;for(let value of values)(value=+valueof(value,++index,values))&&(sum+=value)}return sum}__webpack_require__.d(__webpack_exports__,{A:()=>sum})},"../../node_modules/d3-dsv/src/tsv.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Nu:()=>tsvParse});var EOL={},EOF={};function objectConverter(columns){return new Function("d","return {"+columns.map(function(name,i){return JSON.stringify(name)+": d["+i+'] || ""'}).join(",")+"}")}function inferColumns(rows){var columnSet=Object.create(null),columns=[];return rows.forEach(function(row){for(var column in row)column in columnSet||columns.push(columnSet[column]=column)}),columns}function pad(value,width){var s=value+"",length=s.length;return length<width?new Array(width-length+1).join(0)+s:s}function formatDate(date){var hours=date.getUTCHours(),minutes=date.getUTCMinutes(),seconds=date.getUTCSeconds(),milliseconds=date.getUTCMilliseconds();return isNaN(date)?"Invalid Date":function formatYear(year){return year<0?"-"+pad(-year,6):year>9999?"+"+pad(year,6):pad(year,4)}(date.getUTCFullYear())+"-"+pad(date.getUTCMonth()+1,2)+"-"+pad(date.getUTCDate(),2)+(milliseconds?"T"+pad(hours,2)+":"+pad(minutes,2)+":"+pad(seconds,2)+"."+pad(milliseconds,3)+"Z":seconds?"T"+pad(hours,2)+":"+pad(minutes,2)+":"+pad(seconds,2)+"Z":minutes||hours?"T"+pad(hours,2)+":"+pad(minutes,2)+"Z":"")}var tsv=function dsv(delimiter){var reFormat=new RegExp('["'+delimiter+"\n\r]"),DELIMITER=delimiter.charCodeAt(0);function parseRows(text,f){var t,rows=[],N=text.length,I=0,n=0,eof=N<=0,eol=!1;function token(){if(eof)return EOF;if(eol)return eol=!1,EOL;var i,c,j=I;if(34===text.charCodeAt(j)){for(;I++<N&&34!==text.charCodeAt(I)||34===text.charCodeAt(++I););return(i=I)>=N?eof=!0:10===(c=text.charCodeAt(I++))?eol=!0:13===c&&(eol=!0,10===text.charCodeAt(I)&&++I),text.slice(j+1,i-1).replace(/""/g,'"')}for(;I<N;){if(10===(c=text.charCodeAt(i=I++)))eol=!0;else if(13===c)eol=!0,10===text.charCodeAt(I)&&++I;else if(c!==DELIMITER)continue;return text.slice(j,i)}return eof=!0,text.slice(j,N)}for(10===text.charCodeAt(N-1)&&--N,13===text.charCodeAt(N-1)&&--N;(t=token())!==EOF;){for(var row=[];t!==EOL&&t!==EOF;)row.push(t),t=token();f&&null==(row=f(row,n++))||rows.push(row)}return rows}function preformatBody(rows,columns){return rows.map(function(row){return columns.map(function(column){return formatValue(row[column])}).join(delimiter)})}function formatRow(row){return row.map(formatValue).join(delimiter)}function formatValue(value){return null==value?"":value instanceof Date?formatDate(value):reFormat.test(value+="")?'"'+value.replace(/"/g,'""')+'"':value}return{parse:function parse(text,f){var convert,columns,rows=parseRows(text,function(row,i){if(convert)return convert(row,i-1);columns=row,convert=f?function customConverter(columns,f){var object=objectConverter(columns);return function(row,i){return f(object(row),i,columns)}}(row,f):objectConverter(row)});return rows.columns=columns||[],rows},parseRows,format:function format(rows,columns){return null==columns&&(columns=inferColumns(rows)),[columns.map(formatValue).join(delimiter)].concat(preformatBody(rows,columns)).join("\n")},formatBody:function formatBody(rows,columns){return null==columns&&(columns=inferColumns(rows)),preformatBody(rows,columns).join("\n")},formatRows:function formatRows(rows){return rows.map(formatRow).join("\n")},formatRow,formatValue}}("\t"),tsvParse=tsv.parse;tsv.parseRows,tsv.format,tsv.formatBody,tsv.formatRows,tsv.formatRow,tsv.formatValue},"../../node_modules/d3-scale/src/ordinal.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>ordinal});var d3_array__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/internmap/src/index.js"),_init_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/d3-scale/src/init.js");const implicit=Symbol("implicit");function ordinal(){var index=new d3_array__WEBPACK_IMPORTED_MODULE_0__.B,domain=[],range=[],unknown=implicit;function scale(d){let i=index.get(d);if(void 0===i){if(unknown!==implicit)return unknown;index.set(d,i=domain.push(d)-1)}return range[i%range.length]}return scale.domain=function(_){if(!arguments.length)return domain.slice();domain=[],index=new d3_array__WEBPACK_IMPORTED_MODULE_0__.B;for(const value of _)index.has(value)||index.set(value,domain.push(value)-1);return scale},scale.range=function(_){return arguments.length?(range=Array.from(_),scale):range.slice()},scale.unknown=function(_){return arguments.length?(unknown=_,scale):unknown},scale.copy=function(){return ordinal(domain,range).unknown(unknown)},_init_js__WEBPACK_IMPORTED_MODULE_1__.C.apply(scale,arguments),scale}},"../../node_modules/d3-shape/src/array.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});Array.prototype.slice;function __WEBPACK_DEFAULT_EXPORT__(x){return"object"==typeof x&&"length"in x?x:Array.from(x)}},"../../node_modules/d3-shape/src/constant.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function __WEBPACK_DEFAULT_EXPORT__(x){return function constant(){return x}}__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__})},"../../node_modules/d3-shape/src/stack.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>stack});var array=__webpack_require__("../../node_modules/d3-shape/src/array.js"),constant=__webpack_require__("../../node_modules/d3-shape/src/constant.js");function none(series,order){if((n=series.length)>1)for(var j,s0,n,i=1,s1=series[order[0]],m=s1.length;i<n;++i)for(s0=s1,s1=series[order[i]],j=0;j<m;++j)s1[j][1]+=s1[j][0]=isNaN(s0[j][1])?s0[j][0]:s0[j][1]}function order_none(series){for(var n=series.length,o=new Array(n);--n>=0;)o[n]=n;return o}function stackValue(d,key){return d[key]}function stackSeries(key){const series=[];return series.key=key,series}function stack(){var keys=(0,constant.A)([]),order=order_none,offset=none,value=stackValue;function stack(data){var i,oz,sz=Array.from(keys.apply(this,arguments),stackSeries),n=sz.length,j=-1;for(const d of data)for(i=0,++j;i<n;++i)(sz[i][j]=[0,+value(d,sz[i].key,j,data)]).data=d;for(i=0,oz=(0,array.A)(order(sz));i<n;++i)sz[oz[i]].index=i;return offset(sz,oz),sz}return stack.keys=function(_){return arguments.length?(keys="function"==typeof _?_:(0,constant.A)(Array.from(_)),stack):keys},stack.value=function(_){return arguments.length?(value="function"==typeof _?_:(0,constant.A)(+_),stack):value},stack.order=function(_){return arguments.length?(order=null==_?order_none:"function"==typeof _?_:(0,constant.A)(Array.from(_)),stack):order},stack.offset=function(_){return arguments.length?(offset=null==_?none:_,stack):offset},stack}},"../../node_modules/internmap/src/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{B:()=>InternMap});class InternMap extends Map{constructor(entries,key=keyof){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:key}}),null!=entries)for(const[key,value]of entries)this.set(key,value)}get(key){return super.get(intern_get(this,key))}has(key){return super.has(intern_get(this,key))}set(key,value){return super.set(intern_set(this,key),value)}delete(key){return super.delete(intern_delete(this,key))}}Set;function intern_get({_intern,_key},value){const key=_key(value);return _intern.has(key)?_intern.get(key):value}function intern_set({_intern,_key},value){const key=_key(value);return _intern.has(key)?_intern.get(key):(_intern.set(key,value),value)}function intern_delete({_intern,_key},value){const key=_key(value);return _intern.has(key)&&(value=_intern.get(value),_intern.delete(key)),value}function keyof(value){return null!==value&&"object"==typeof value?value.valueOf():value}},"../core/lib/utils/barWidth.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{h:()=>plotDataLengthBarWidth});var ___WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../core/lib/utils/index.js");const plotDataLengthBarWidth=(props,moreProps)=>{const{widthRatio}=props,{xAccessor,xScale,plotData}=moreProps,[l,r]=xScale.range();if(null!=xScale.invert){const[dl,dr]=xScale.domain();if("number"==typeof dl&&"number"==typeof dr){return Math.abs(r-l)/Math.abs(dl-dr)*widthRatio}return(xScale(xAccessor((0,___WEBPACK_IMPORTED_MODULE_0__.HV)(plotData)))-xScale(xAccessor((0,___WEBPACK_IMPORTED_MODULE_0__.$1)(plotData))))/plotData.length*widthRatio*.7}return Math.abs(r-l)/xScale.domain().length*widthRatio}},"../indicators/lib/calculator/defaultOptionsForComputation.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Be:()=>Kagi,Mb:()=>Renko,Wq:()=>ForceIndex,Xt:()=>SAR,ZV:()=>FullStochasticOscillator,Zi:()=>RSI,e0:()=>MACD,jt:()=>ElderRay,lY:()=>Change,mV:()=>EMA,q7:()=>PointAndFigure,qd:()=>BollingerBand,yJ:()=>ATR});const BollingerBand={windowSize:20,sourcePath:"close",multiplier:2,movingAverageType:"sma"},ATR={windowSize:14},ForceIndex={sourcePath:"close",volumePath:"volume"},Change={sourcePath:"close",basePath:"close",mainKeys:[],compareKeys:[]},ElderRay={windowSize:13,sourcePath:"close",movingAverageType:"sma"},SAR={accelerationFactor:.02,maxAccelerationFactor:.2},MACD={fast:12,slow:26,signal:9,sourcePath:"close"},FullStochasticOscillator={windowSize:12,kWindowSize:3,dWindowSize:3},RSI={windowSize:14,sourcePath:"close"},EMA={sourcePath:"close",windowSize:10},Kagi={reversalType:"ATR",windowSize:14,reversal:2,sourcePath:"close"},Renko={reversalType:"ATR",windowSize:14,fixedBrickSize:2,sourcePath:"high/low"},PointAndFigure={boxSize:.5,reversal:3,sourcePath:"high/low"}},"../indicators/lib/indicator/change.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>indicator_change});var slidingWindow=__webpack_require__("../indicators/lib/utils/slidingWindow.js"),defaultOptionsForComputation=__webpack_require__("../indicators/lib/calculator/defaultOptionsForComputation.js");var merge=__webpack_require__("../indicators/lib/utils/merge.js"),rebind=__webpack_require__("../indicators/lib/utils/rebind.js"),baseIndicator=__webpack_require__("../indicators/lib/indicator/baseIndicator.js");const ALGORITHM_TYPE="Change";function indicator_change(){const base=(0,baseIndicator.A)().type(ALGORITHM_TYPE),underlyingAlgorithm=function change(){let options=defaultOptionsForComputation.lY;const calculator=data=>{const{sourcePath}=options;return(0,slidingWindow.A)().windowSize(2).sourcePath(sourcePath).accumulator(([prev,curr])=>{const absoluteChange=curr-prev;return{absoluteChange,percentChange:100*absoluteChange/prev}})(data)};return calculator.undefinedLength=()=>1,calculator.options=newOptions=>void 0===newOptions?options:(options={...defaultOptionsForComputation.lY,...newOptions},calculator),calculator}(),mergedAlgorithm=(0,merge.A)().algorithm(underlyingAlgorithm).merge((datum,i)=>{datum.absoluteChange=i.absoluteChange,datum.percentChange=i.percentChange}),indicator=(data,options={merge:!0})=>options.merge?mergedAlgorithm(data):underlyingAlgorithm(data);return(0,rebind.A)(indicator,base,"id","accessor","stroke","fill","echo","type"),(0,rebind.A)(indicator,underlyingAlgorithm,"options"),(0,rebind.A)(indicator,mergedAlgorithm,"merge","skipUndefined"),indicator}},"../indicators/lib/utils/functor.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{E:()=>functor});const functor=v=>"function"==typeof v?v:()=>v},"../indicators/lib/utils/identity.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{D:()=>identity});const identity=d=>d},"../indicators/lib/utils/merge.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _zipper__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../indicators/lib/utils/zipper.js"),_identity__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../indicators/lib/utils/identity.js");function __WEBPACK_DEFAULT_EXPORT__(){let algorithm=_identity__WEBPACK_IMPORTED_MODULE_1__.D,skipUndefined=!0,merge=()=>{};const mergeCompute=data=>(0,_zipper__WEBPACK_IMPORTED_MODULE_0__.A)().combine((datum,indicator)=>{const result=skipUndefined&&void 0===indicator?datum:merge(datum,indicator);return void 0===result?datum:result})(data,algorithm(data));return mergeCompute.algorithm=newAlgorithm=>void 0===newAlgorithm?algorithm:(algorithm=newAlgorithm,mergeCompute),mergeCompute.merge=newMerge=>void 0===newMerge?merge:(merge=newMerge,mergeCompute),mergeCompute.skipUndefined=newSkipUndefined=>void 0===newSkipUndefined?skipUndefined:(skipUndefined=newSkipUndefined,mergeCompute),mergeCompute}},"../indicators/lib/utils/path.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>path});const path=(loc=[])=>{const key=Array.isArray(loc)?loc:[loc],length=key.length;return function(obj,defaultValue){if(0===length)return null!=obj?obj:defaultValue;let index=0;for(;null!=obj&&index<length;)obj=obj[key[index++]];return index===length?obj:defaultValue}}},"../indicators/lib/utils/slidingWindow.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _functor__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../indicators/lib/utils/functor.js"),_path__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../indicators/lib/utils/path.js");function __WEBPACK_DEFAULT_EXPORT__(){let undefinedValue,sourcePath,source,misc,windowSize=10,accumulator=()=>{},skipInitial=0;const slidingWindow=data=>{const sourceFunction=source||(0,_path__WEBPACK_IMPORTED_MODULE_1__.A)(sourcePath),size=(0,_functor__WEBPACK_IMPORTED_MODULE_0__.E)(windowSize).apply(this,arguments),windowData=data.slice(skipInitial,size+skipInitial).map(sourceFunction);let accumulatorIdx=0;const undef=(0,_functor__WEBPACK_IMPORTED_MODULE_0__.E)(undefinedValue);return data.map((d,i)=>i<skipInitial+size-1?undef(sourceFunction(d),i,misc):(i>=skipInitial+size&&(windowData.shift(),windowData.push(sourceFunction(d,i))),accumulator(windowData,i,accumulatorIdx++,misc)))};return slidingWindow.undefinedValue=function(x){return arguments.length?(undefinedValue=x,slidingWindow):undefinedValue},slidingWindow.windowSize=function(x){return arguments.length?(windowSize=x,slidingWindow):windowSize},slidingWindow.misc=function(x){return arguments.length?(misc=x,slidingWindow):misc},slidingWindow.accumulator=function(x){return arguments.length?(accumulator=x,slidingWindow):accumulator},slidingWindow.skipInitial=function(x){return arguments.length?(skipInitial=x,slidingWindow):skipInitial},slidingWindow.sourcePath=function(x){return arguments.length?(sourcePath=x,slidingWindow):sourcePath},slidingWindow.source=function(x){return arguments.length?(source=x,slidingWindow):source},slidingWindow}},"../indicators/lib/utils/zipper.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>zipper});var d3_array__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/d3-array/src/min.js"),_identity__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../indicators/lib/utils/identity.js");function zipper(){let combine=_identity__WEBPACK_IMPORTED_MODULE_1__.D;function zip(){const n=arguments.length;if(0===n)return[];const m=(0,d3_array__WEBPACK_IMPORTED_MODULE_0__.A)(arguments,d3_zipLength)??0,zips=new Array(m);for(let i=-1;++i<m;){for(let j=-1,zip=zips[i]=new Array(n);++j<n;)zip[j]=arguments[j][i];zips[i]=combine.apply(this,zips[i])}return zips}function d3_zipLength(d){return d.length}return zip.combine=function(x){return arguments.length?(combine=x,zip):combine},zip}},"../series/lib/BarSeries.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{R:()=>BarSeries});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/react/jsx-runtime.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../core/lib/GenericChartComponent.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../core/lib/GenericComponent.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../core/lib/utils/index.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../core/lib/utils/barWidth.js"),d3_array__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../node_modules/d3-array/src/group.js"),react__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../node_modules/react/index.js"),_StackedBarSeries__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../series/lib/StackedBarSeries.js");class BarSeries extends react__WEBPACK_IMPORTED_MODULE_6__.Component{constructor(){super(...arguments),this.drawOnCanvas=(ctx,moreProps)=>{if(this.props.swapScales){const{xAccessor}=moreProps;(0,_StackedBarSeries__WEBPACK_IMPORTED_MODULE_7__.aZ)(ctx,this.props,moreProps,xAccessor,_StackedBarSeries__WEBPACK_IMPORTED_MODULE_7__.Th)}else{const bars=this.getBars(moreProps),{strokeStyle}=this.props;(0,d3_array__WEBPACK_IMPORTED_MODULE_5__.Ay)(bars,d=>d.fillStyle).forEach((values,key)=>{void 0!==strokeStyle&&(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__.d5)(values).width>1&&(ctx.strokeStyle=strokeStyle),ctx.fillStyle=key,values.forEach(d=>{d.width<=1?ctx.fillRect(d.x-.5,d.y,1,d.height):(ctx.fillRect(d.x+.5,d.y+.5,d.width,d.height),void 0!==strokeStyle&&ctx.strokeRect(d.x,d.y,d.width,d.height))})})}},this.getBars=moreProps=>{const{baseAt,fillStyle,width,yAccessor}=this.props,{xScale,xAccessor,plotData,chartConfig:{yScale}}=moreProps,getFill=(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__.ER)(fillStyle),getBase=(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__.ER)(baseAt),offset=.5*(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__.ER)(width)(this.props,{xScale,xAccessor,plotData});return plotData.map(d=>{const yValue=yAccessor(d);if(void 0===yValue)return;const xValue=xAccessor(d),x=xScale(xValue)-offset;let y=yScale(yValue),h=getBase(xScale,yScale,d)-yScale(yValue);return h<0&&(y+=h,h=-h),{x,y:Math.round(y),height:Math.round(h),width:2*offset,fillStyle:getFill(d)}}).filter(d=>void 0!==d)}}render(){const{clip}=this.props;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_1__.P,{clip,canvasToDraw:_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_2__.WJ,canvasDraw:this.drawOnCanvas,drawOn:["pan"]})}}BarSeries.defaultProps={baseAt:(xScale,yScale)=>(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__.d5)(yScale.range()),clip:!0,fillStyle:"rgba(70, 130, 180, 0.5)",swapScales:!1,width:_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_4__.h,widthRatio:.8}},"../series/lib/CandlestickSeries.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{H:()=>CandlestickSeries});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/react/jsx-runtime.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../core/lib/GenericChartComponent.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../core/lib/GenericComponent.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../core/lib/utils/index.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../core/lib/utils/barWidth.js"),d3_array__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../node_modules/d3-array/src/group.js"),react__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../node_modules/react/index.js");class CandlestickSeries extends react__WEBPACK_IMPORTED_MODULE_6__.Component{constructor(){super(...arguments),this.drawOnCanvas=(ctx,moreProps)=>{const{candleStrokeWidth=CandlestickSeries.defaultProps.candleStrokeWidth}=this.props,{xScale,chartConfig:{yScale},plotData,xAccessor}=moreProps,candleData=this.getCandleData(xAccessor,xScale,yScale,plotData);(0,d3_array__WEBPACK_IMPORTED_MODULE_5__.Ay)(candleData,d=>d.wick.stroke).forEach((values,key)=>{ctx.fillStyle=key,values.forEach(each=>{const d=each.wick;ctx.fillRect(d.x-.5,d.y1,1,d.y2-d.y1),ctx.fillRect(d.x-.5,d.y3,1,d.y4-d.y3)})});(0,d3_array__WEBPACK_IMPORTED_MODULE_5__.Ay)(candleData,d=>d.stroke,d=>d.fill).forEach((strokeValues,strokeKey)=>{"none"!==strokeKey&&(ctx.strokeStyle=strokeKey,ctx.lineWidth=candleStrokeWidth),strokeValues.forEach((values,key)=>{ctx.fillStyle=key,values.forEach(d=>{d.width<=1?ctx.fillRect(d.x-.5,d.y,1,d.height):0===d.height?ctx.fillRect(d.x-.5,d.y,d.width,1):(ctx.fillRect(d.x-.5,d.y,d.width,d.height),"none"!==strokeKey&&ctx.strokeRect(d.x,d.y,d.width,d.height))})})})},this.getCandleData=(xAccessor,xScale,yScale,plotData)=>{const{fill:fillProp,stroke:strokeProp,yAccessor,wickStroke:wickStrokeProp}=this.props,fill=(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__.ER)(fillProp),stroke=(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__.ER)(strokeProp),wickStroke=(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__.ER)(wickStrokeProp),offset=.5*(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__.ER)(this.props.width)(this.props,{xScale,xAccessor,plotData});return plotData.filter(d=>void 0!==yAccessor(d)).map(d=>{const ohlc=yAccessor(d);if(void 0===ohlc)return;const xValue=xAccessor(d),x=xScale(xValue),y=Math.round(yScale(Math.max(ohlc.open,ohlc.close))),height=Math.max(1,Math.round(Math.abs(yScale(ohlc.open)-yScale(ohlc.close))));return{x:x-offset,y,wick:{stroke:wickStroke(ohlc),x,y1:Math.round(yScale(ohlc.high)),y2:y,y3:y+height,y4:Math.round(yScale(ohlc.low))},height,width:2*offset,fill:fill(ohlc),stroke:stroke(ohlc),direction:ohlc.close-ohlc.open}}).filter(d=>void 0!==d)}}render(){const{clip}=this.props;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_1__.P,{clip,canvasDraw:this.drawOnCanvas,canvasToDraw:_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_2__.WJ,drawOn:["pan"]})}}CandlestickSeries.defaultProps={candleStrokeWidth:.5,clip:!0,fill:d=>d.close>d.open?"#26a69a":"#ef5350",stroke:"none",wickStroke:d=>d.close>d.open?"#26a69a":"#ef5350",width:_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_4__.h,widthRatio:.8,yAccessor:d=>({open:d.open,high:d.high,low:d.low,close:d.close})}},"../series/lib/StackedBarSeries.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Gy:()=>drawOnCanvas2,Th:()=>identityStack,aZ:()=>drawOnCanvasHelper});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/react/jsx-runtime.js"),d3_array__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/d3-array/src/group.js"),d3_array__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../node_modules/d3-array/src/merge.js"),d3_shape__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../node_modules/d3-shape/src/stack.js"),react__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../node_modules/react/index.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../core/lib/GenericChartComponent.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../core/lib/GenericComponent.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../core/lib/utils/identity.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("../core/lib/utils/index.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("../core/lib/utils/barWidth.js");class StackedBarSeries extends react__WEBPACK_IMPORTED_MODULE_4__.Component{constructor(){super(...arguments),this.drawOnCanvas=(ctx,moreProps)=>{const{xAccessor}=moreProps;drawOnCanvasHelper(ctx,this.props,moreProps,xAccessor,d3_shape__WEBPACK_IMPORTED_MODULE_3__.A)}}render(){const{clip}=this.props;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_5__.P,{clip,canvasDraw:this.drawOnCanvas,canvasToDraw:_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_6__.WJ,drawOn:["pan"]})}}function identityStack(){let keys=[];function stack(data){return keys.map((key,i)=>{const arrays=data.map(d=>{const array=[0,d[key]];return array.data=d,array});return arrays.key=key,arrays.index=i,arrays})}return stack.keys=function(x){return arguments.length?(keys=x,stack):keys},stack}function drawOnCanvasHelper(ctx,props,moreProps,xAccessor,stackFn,defaultPostAction=_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_7__.D,postRotateAction=rotateXY){const{xScale,chartConfig:{yScale},plotData}=moreProps,bars=doStuff(props,xAccessor,plotData,xScale,yScale,stackFn,postRotateAction,defaultPostAction);drawOnCanvas2(props,ctx,bars)}function convertToArray(item){return Array.isArray(item)?item:[item]}StackedBarSeries.defaultProps={baseAt:(xScale,yScale)=>(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_8__.d5)(yScale.range()),direction:"up",stroke:!1,fillStyle:"rgba(70, 130, 180, 0.5)",width:_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_9__.h,widthRatio:.8,clip:!0,swapScales:!1};const doStuff=(props,xAccessor,plotData,xScale,yScale,stackFn,postRotateAction,defaultPostAction)=>{const{yAccessor,swapScales}=props,bars=function getBars(props,xAccessor,yAccessor,xScale,yScale,plotData,stack=identityStack,after=_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_7__.D){const{baseAt,fillStyle,stroke,spaceBetweenBar=0}=props,getFill=(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_8__.ER)(fillStyle),getBase=(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_8__.ER)(baseAt),widthFunctor=(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_8__.ER)(props.width),width=widthFunctor(props,{xScale,xAccessor,plotData}),barWidth=Math.round(width),eachBarWidth=(barWidth-spaceBetweenBar*(yAccessor.length-1))/yAccessor.length,offset=1===barWidth?0:.5*width,ds=plotData.map(each=>{const d={appearance:{},x:xAccessor(each)};return yAccessor.forEach((eachYAccessor,i)=>{const key=`y${i}`;d[key]=eachYAccessor(each);const appearance={stroke:stroke?getFill(each,i):"none",fillStyle:getFill(each,i)};d.appearance[key]=appearance}),d}),keys=yAccessor.map((_,i)=>`y${i}`),newData=stack().keys(keys)(ds).map((each,i)=>{const key=each.key;return each.map(d=>{const array=[d[0],d[1]];return array.data={x:d.data.x,i,appearance:d.data.appearance[key]},array})}),bars=(0,d3_array__WEBPACK_IMPORTED_MODULE_2__.A)(newData).map(d=>{let y=yScale(d[1]),h=getBase(xScale,yScale,d.data)-yScale(d[1]-d[0]);return h<0&&(y+=h,h=-h),{...d.data.appearance,x:Math.round(xScale(d.data.x)-width/2),y,groupOffset:Math.round(offset-(d.data.i>0?(eachBarWidth+spaceBetweenBar)*d.data.i:0)),groupWidth:Math.round(eachBarWidth),offset:Math.round(offset),height:h,width:barWidth}}).filter(bar=>!isNaN(bar.y));return after(bars)}(props,swapScales?yAccessor:xAccessor,convertToArray(swapScales?xAccessor:yAccessor),swapScales?yScale:xScale,swapScales?xScale:yScale,plotData,stackFn,swapScales?postRotateAction:defaultPostAction);return bars},rotateXY=array=>array.map(each=>({...each,x:each.y,y:each.x,height:each.width,width:each.height})),drawOnCanvas2=(props,ctx,bars)=>{const{stroke}=props;(0,d3_array__WEBPACK_IMPORTED_MODULE_1__.Ay)(bars,d=>d.fillStyle).forEach((values,key)=>{(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_8__.d5)(values).width>1&&void 0!==key&&(ctx.strokeStyle=key),ctx.fillStyle=key,values.forEach(d=>{d.width<=1?ctx.fillRect(d.x-.5,d.y,1,d.height):(ctx.fillRect(d.x+.5,d.y+.5,d.width,d.height),stroke&&ctx.strokeRect(d.x,d.y,d.width,d.height))})})}},"./src/indicators/volumeProfile/index.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{__namedExportsOrder:()=>__namedExportsOrder,basic:()=>basic,default:()=>index_stories});var jsx_runtime=__webpack_require__("../../node_modules/react/jsx-runtime.js"),array=Array.prototype,slice=array.slice,bisect=(array.map,__webpack_require__("../../node_modules/d3-array/src/bisect.js"));function constant(x){return function(){return x}}var extent=__webpack_require__("../../node_modules/d3-array/src/extent.js"),identity=__webpack_require__("../../node_modules/d3-array/src/identity.js"),ticks=__webpack_require__("../../node_modules/d3-array/src/ticks.js");function sturges(values){return Math.ceil(Math.log(function count(values,valueof){let count=0;if(void 0===valueof)for(let value of values)null!=value&&(value=+value)>=value&&++count;else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(value=+value)>=value&&++count}return count}(values))/Math.LN2)+1}function bin(){var value=identity.A,domain=extent.A,threshold=sturges;function histogram(data){Array.isArray(data)||(data=Array.from(data));var i,x,n=data.length,values=new Array(n);for(i=0;i<n;++i)values[i]=value(data[i],i,data);var xz=domain(values),x0=xz[0],x1=xz[1],tz=threshold(values,x0,x1);if(!Array.isArray(tz)){const max=x1,tn=+tz;if(domain===extent.A&&([x0,x1]=function nice(start,stop,count){let prestep;for(;;){const step=(0,ticks.lq)(start,stop,count);if(step===prestep||0===step||!isFinite(step))return[start,stop];step>0?(start=Math.floor(start/step)*step,stop=Math.ceil(stop/step)*step):step<0&&(start=Math.ceil(start*step)/step,stop=Math.floor(stop*step)/step),prestep=step}}(x0,x1,tn)),(tz=(0,ticks.Ay)(x0,x1,tn))[tz.length-1]>=x1)if(max>=x1&&domain===extent.A){const step=(0,ticks.lq)(x0,x1,tn);isFinite(step)&&(step>0?x1=(Math.floor(x1/step)+1)*step:step<0&&(x1=(Math.ceil(x1*-step)+1)/-step))}else tz.pop()}for(var m=tz.length;tz[0]<=x0;)tz.shift(),--m;for(;tz[m-1]>x1;)tz.pop(),--m;var bin,bins=new Array(m+1);for(i=0;i<=m;++i)(bin=bins[i]=[]).x0=i>0?tz[i-1]:x0,bin.x1=i<m?tz[i]:x1;for(i=0;i<n;++i)x0<=(x=values[i])&&x<=x1&&bins[(0,bisect.Ay)(tz,x,0,m)].push(data[i]);return bins}return histogram.value=function(_){return arguments.length?(value="function"==typeof _?_:constant(_),histogram):value},histogram.domain=function(_){return arguments.length?(domain="function"==typeof _?_:constant([_[0],_[1]]),histogram):domain},histogram.thresholds=function(_){return arguments.length?(threshold="function"==typeof _?_:Array.isArray(_)?constant(slice.call(_)):constant(_),histogram):threshold},histogram}function descending(a,b){return b<a?-1:b>a?1:b>=a?0:NaN}var ascending=__webpack_require__("../../node_modules/d3-array/src/ascending.js"),group=__webpack_require__("../../node_modules/d3-array/src/group.js"),sum=__webpack_require__("../../node_modules/d3-array/src/sum.js"),max=__webpack_require__("../../node_modules/d3-array/src/max.js"),zip=__webpack_require__("../../node_modules/d3-array/src/zip.js"),merge=__webpack_require__("../../node_modules/d3-array/src/merge.js"),linear=__webpack_require__("../../node_modules/d3-scale/src/linear.js"),react=__webpack_require__("../../node_modules/react/index.js"),utils_identity=__webpack_require__("../core/lib/utils/identity.js"),utils=__webpack_require__("../core/lib/utils/index.js"),noop=__webpack_require__("../core/lib/utils/noop.js");function accumulatingWindow(){let accumulateTill=(0,utils.ER)(!1),accumulator=noop.l,value=utils_identity.D,discardTillStart=!1,discardTillEnd=!1;const accumulatingWindow=function(data){let accumulatedWindow=discardTillStart?void 0:[];const response=[];let accumulatorIdx=0,i=0;for(i=0;i<data.length;i++){const d=data[i];accumulateTill(d,i,accumulatedWindow||[])?(accumulatedWindow&&accumulatedWindow.length>0&&response.push(accumulator(accumulatedWindow,i,accumulatorIdx++)),accumulatedWindow=[value(d)]):accumulatedWindow&&accumulatedWindow.push(value(d))}return discardTillEnd||response.push(accumulator(accumulatedWindow,i,accumulatorIdx)),response};return accumulatingWindow.accumulateTill=function(x){return arguments.length?(accumulateTill=(0,utils.ER)(x),accumulatingWindow):accumulateTill},accumulatingWindow.accumulator=function(x){return arguments.length?(accumulator=x,accumulatingWindow):accumulator},accumulatingWindow.value=function(x){return arguments.length?(value=x,accumulatingWindow):value},accumulatingWindow.discardTillStart=function(x){return arguments.length?(discardTillStart=x,accumulatingWindow):discardTillStart},accumulatingWindow.discardTillEnd=function(x){return arguments.length?(discardTillEnd=x,accumulatingWindow):discardTillEnd},accumulatingWindow}var GenericChartComponent=__webpack_require__("../core/lib/GenericChartComponent.js"),GenericComponent=__webpack_require__("../core/lib/GenericComponent.js");class VolumeProfileSeries extends react.Component{constructor(){super(...arguments),this.drawOnCanvas=(ctx,moreProps)=>{const{xAccessor,width}=moreProps,{rects,sessionBg}=this.helper(this.props,moreProps,xAccessor,width);this.drawOnCanvasContext(ctx,rects,sessionBg)},this.drawOnCanvasContext=(ctx,rects,sessionBg)=>{const{sessionBackGround,showSessionBackground}=this.props;showSessionBackground&&(void 0!==sessionBackGround&&(ctx.fillStyle=sessionBackGround),sessionBg.forEach(each=>{const{x,y,height,width}=each;ctx.beginPath(),ctx.rect(x,y,width,height),ctx.closePath(),ctx.fill()})),rects.forEach(each=>{const{x,y,height,w1,w2,stroke1,stroke2,fill1,fill2}=each;w1>0&&(ctx.fillStyle=fill1,"none"!==stroke1&&(ctx.strokeStyle=stroke1),ctx.beginPath(),ctx.rect(x,y,w1,height),ctx.closePath(),ctx.fill(),"none"!==stroke1&&ctx.stroke()),w2>0&&(ctx.fillStyle=fill2,"none"!==stroke2&&(ctx.strokeStyle=stroke2),ctx.beginPath(),ctx.rect(x+w1,y,w2,height),ctx.closePath(),ctx.fill(),"none"!==stroke2&&ctx.stroke())})},this.helper=(props,moreProps,xAccessor,width)=>{const{xScale:realXScale,chartConfig:{yScale},plotData}=moreProps,{sessionStart,bySession,partialStartOK,partialEndOK,bins,maxProfileWidthPercent,source,volume,absoluteChange,orient,fill,stroke}=props,sessionBuilder=accumulatingWindow().discardTillStart(!partialStartOK).discardTillEnd(!partialEndOK).accumulateTill((d,i)=>sessionStart({d,i,...moreProps})).accumulator(utils_identity.D),dx=plotData.length>1?realXScale(xAccessor(plotData[1]))-realXScale(xAccessor((0,utils.d5)(plotData))):0,allRects=(bySession?sessionBuilder(plotData):[plotData]).map(session=>{const begin=bySession?realXScale(xAccessor((0,utils.d5)(session))):0,finish=bySession?realXScale(xAccessor((0,utils.HV)(session))):width,sessionWidth=finish-begin+dx,histogram2=bin().value(source).thresholds(bins),values=histogram2(session),volumeInBins=values.map(arr=>arr.map(d=>absoluteChange(d)>0?{direction:"up",volume:volume(d)}:{direction:"down",volume:volume(d)})).map(arr=>Array.from((data=>{const sortFunction="right"===orient?descending:ascending.A,sortedData=data.sort((a,b)=>sortFunction(a.direction,b.direction));return(0,group.z)(sortedData,leaves=>(0,sum.A)(leaves,d=>d.volume),d=>d.direction)})(arr))),volumeValues=volumeInBins.map(each=>(0,sum.A)(each.map(d=>d[1]))),[start,end]="right"===orient?[begin,begin+sessionWidth*maxProfileWidthPercent/100]:[finish,finish-sessionWidth*(100-maxProfileWidthPercent)/100],xScale=(0,linear.A)().domain([0,(0,max.A)(volumeValues)]).range([start,end]),totalVolumes=volumeInBins.map(volumes=>{const totalVolume=(0,sum.A)(volumes,d=>d[1]),totalVolumeX=xScale(totalVolume),widthLocal=(xScaleD=xScale,(0,utils.d5)(xScaleD.range())-totalVolumeX);var xScaleD;return{x:widthLocal<0?totalVolumeX+widthLocal:totalVolumeX,ws:volumes.map(d=>({type:d[0],width:d[1]*Math.abs(widthLocal)/totalVolume})),totalVolumeX}}),rects=(0,zip.A)(values,totalVolumes).map(([d,{x,ws}])=>{const w1=ws[0]||{type:"up",width:0},w2=ws[1]||{type:"down",width:0};return{y:yScale(d.x1),height:yScale(d.x1)-yScale(d.x0),x,width,w1:w1.width,w2:w2.width,stroke1:(0,utils.ER)(stroke)(w1),stroke2:(0,utils.ER)(stroke)(w2),fill1:(0,utils.ER)(fill)(w1),fill2:(0,utils.ER)(fill)(w2)}});return{rects,sessionBg:{x:begin,y:(0,utils.HV)(rects).y,height:(0,utils.d5)(rects).y-(0,utils.HV)(rects).y+(0,utils.d5)(rects).height,width:sessionWidth}}});return{rects:(0,merge.A)(allRects.map(d=>d.rects)),sessionBg:allRects.map(d=>d.sessionBg)}}}render(){return(0,jsx_runtime.jsx)(GenericChartComponent.P,{canvasDraw:this.drawOnCanvas,canvasToDraw:GenericComponent.WJ,drawOn:["pan"]})}}VolumeProfileSeries.defaultProps={absoluteChange:d=>d.absoluteChange,bins:20,bySession:!1,fill:({type})=>"up"===type?"rgba(38, 166, 154, 0.5)":"rgba(239, 83, 80, 0.5)",maxProfileWidthPercent:50,orient:"left",partialStartOK:!0,partialEndOK:!0,sessionBackGround:"rgba(70, 130, 180, 0.3)",sessionStart:({d,i,plotData})=>i>0&&plotData[i-1].date.getMonth()!==d.date.getMonth(),showSessionBackground:!1,source:d=>d.close,stroke:"#FFFFFF",volume:d=>d.volume};var ChartCanvas=__webpack_require__("../core/lib/ChartCanvas.js"),Chart=__webpack_require__("../core/lib/Chart.js"),XAxis=__webpack_require__("../axes/lib/XAxis.js"),YAxis=__webpack_require__("../axes/lib/YAxis.js"),discontinuousTimeScaleProvider=__webpack_require__("../scales/lib/discontinuousTimeScaleProvider.js"),BarSeries=__webpack_require__("../series/lib/BarSeries.js"),CandlestickSeries=__webpack_require__("../series/lib/CandlestickSeries.js");class VolumeProfileSeries_VolumeProfileSeries extends react.Component{constructor(){super(...arguments),this.drawOnCanvas=(ctx,moreProps)=>{const{xAccessor,width}=moreProps,{rects,sessionBg}=this.helper(this.props,moreProps,xAccessor,width);this.drawOnCanvasContext(ctx,rects,sessionBg)},this.drawOnCanvasContext=(ctx,rects,sessionBg)=>{const{sessionBackGround,showSessionBackground}=this.props;showSessionBackground&&(void 0!==sessionBackGround&&(ctx.fillStyle=sessionBackGround),sessionBg.forEach(each=>{const{x,y,height,width}=each;ctx.beginPath(),ctx.rect(x,y,width,height),ctx.closePath(),ctx.fill()})),rects.forEach(each=>{const{x,y,height,w1,w2,stroke1,stroke2,fill1,fill2}=each;w1>0&&(ctx.fillStyle=fill1,"none"!==stroke1&&(ctx.strokeStyle=stroke1),ctx.beginPath(),ctx.rect(x,y,w1,height),ctx.closePath(),ctx.fill(),"none"!==stroke1&&ctx.stroke()),w2>0&&(ctx.fillStyle=fill2,"none"!==stroke2&&(ctx.strokeStyle=stroke2),ctx.beginPath(),ctx.rect(x+w1,y,w2,height),ctx.closePath(),ctx.fill(),"none"!==stroke2&&ctx.stroke())})},this.helper=(props,moreProps,xAccessor,width)=>{const{xScale:realXScale,chartConfig:{yScale},plotData}=moreProps,{sessionStart,bySession,partialStartOK,partialEndOK,bins,maxProfileWidthPercent,source,volume,absoluteChange,orient,fill,stroke}=props,sessionBuilder=accumulatingWindow().discardTillStart(!partialStartOK).discardTillEnd(!partialEndOK).accumulateTill((d,i)=>sessionStart({d,i,...moreProps})).accumulator(utils_identity.D),dx=plotData.length>1?realXScale(xAccessor(plotData[1]))-realXScale(xAccessor((0,utils.d5)(plotData))):0,allRects=(bySession?sessionBuilder(plotData):[plotData]).map(session=>{const begin=bySession?realXScale(xAccessor((0,utils.d5)(session))):0,finish=bySession?realXScale(xAccessor((0,utils.HV)(session))):width,sessionWidth=finish-begin+dx,histogram2=bin().value(source).thresholds(bins),values=histogram2(session),volumeInBins=values.map(arr=>arr.map(d=>absoluteChange(d)>0?{direction:"up",volume:volume(d)}:{direction:"down",volume:volume(d)})).map(arr=>Array.from((data=>{const sortFunction="right"===orient?descending:ascending.A,sortedData=data.sort((a,b)=>sortFunction(a.direction,b.direction));return(0,group.z)(sortedData,leaves=>(0,sum.A)(leaves,d=>d.volume),d=>d.direction)})(arr))),volumeValues=volumeInBins.map(each=>(0,sum.A)(each.map(d=>d[1]))),[start,end]="right"===orient?[begin,begin+sessionWidth*maxProfileWidthPercent/100]:[finish,finish-sessionWidth*(100-maxProfileWidthPercent)/100],xScale=(0,linear.A)().domain([0,(0,max.A)(volumeValues)]).range([start,end]),totalVolumes=volumeInBins.map(volumes=>{const totalVolume=(0,sum.A)(volumes,d=>d[1]),totalVolumeX=xScale(totalVolume),widthLocal=(xScaleD=xScale,(0,utils.d5)(xScaleD.range())-totalVolumeX);var xScaleD;return{x:widthLocal<0?totalVolumeX+widthLocal:totalVolumeX,ws:volumes.map(d=>({type:d[0],width:d[1]*Math.abs(widthLocal)/totalVolume})),totalVolumeX}}),rects=(0,zip.A)(values,totalVolumes).map(([d,{x,ws}])=>{const w1=ws[0]||{type:"up",width:0},w2=ws[1]||{type:"down",width:0};return{y:yScale(d.x1),height:yScale(d.x1)-yScale(d.x0),x,width,w1:w1.width,w2:w2.width,stroke1:(0,utils.ER)(stroke)(w1),stroke2:(0,utils.ER)(stroke)(w2),fill1:(0,utils.ER)(fill)(w1),fill2:(0,utils.ER)(fill)(w2)}});return{rects,sessionBg:{x:begin,y:(0,utils.HV)(rects).y,height:(0,utils.d5)(rects).y-(0,utils.HV)(rects).y+(0,utils.d5)(rects).height,width:sessionWidth}}});return{rects:(0,merge.A)(allRects.map(d=>d.rects)),sessionBg:allRects.map(d=>d.sessionBg)}}}render(){return(0,jsx_runtime.jsx)(GenericChartComponent.P,{canvasDraw:this.drawOnCanvas,canvasToDraw:GenericComponent.WJ,drawOn:["pan"]})}}VolumeProfileSeries_VolumeProfileSeries.defaultProps={absoluteChange:d=>d.absoluteChange,bins:20,bySession:!1,fill:({type})=>"up"===type?"rgba(38, 166, 154, 0.5)":"rgba(239, 83, 80, 0.5)",maxProfileWidthPercent:50,orient:"left",partialStartOK:!0,partialEndOK:!0,sessionBackGround:"rgba(70, 130, 180, 0.3)",sessionStart:({d,i,plotData})=>i>0&&plotData[i-1].date.getMonth()!==d.date.getMonth(),showSessionBackground:!1,source:d=>d.close,stroke:"#FFFFFF",volume:d=>d.volume};var data=__webpack_require__("./src/data/index.ts"),withSize=__webpack_require__("../utils/lib/withSize.js"),withDeviceRatio=__webpack_require__("../utils/lib/withDeviceRatio.js"),change=__webpack_require__("../indicators/lib/indicator/change.js");class VolumeProfile extends react.Component{constructor(){super(...arguments),this.margin={left:0,right:40,top:0,bottom:24},this.xScaleProvider=(0,discontinuousTimeScaleProvider.L)().inputDateAccessor(d=>d.date),this.barChartExtents=data=>data.volume,this.yExtents=data=>[data.high,data.low],this.volumeSeries=data=>data.volume}render(){const{data:initialData,height,ratio,width}=this.props,absoluteChange=(0,change.A)()(initialData),{data,xScale,xAccessor,displayXAccessor}=this.xScaleProvider(absoluteChange),barChartHeight=(height-this.margin.top-this.margin.bottom)/4,max=xAccessor(data[data.length-1]),xExtents=[xAccessor(data[Math.max(0,data.length-100)]),max];return(0,jsx_runtime.jsxs)(ChartCanvas.v,{height,ratio,width,margin:this.margin,data,displayXAccessor,seriesName:"Data",xScale,xAccessor,xExtents,children:[(0,jsx_runtime.jsx)(Chart.t,{id:1,height:barChartHeight,origin:(_,h)=>[0,h-barChartHeight],yExtents:this.barChartExtents,children:(0,jsx_runtime.jsx)(BarSeries.R,{yAccessor:this.volumeSeries})}),(0,jsx_runtime.jsxs)(Chart.t,{id:2,yExtents:this.yExtents,children:[(0,jsx_runtime.jsx)(CandlestickSeries.H,{}),(0,jsx_runtime.jsx)(VolumeProfileSeries_VolumeProfileSeries,{}),(0,jsx_runtime.jsx)(XAxis.W,{}),(0,jsx_runtime.jsx)(YAxis.h,{})]})]})}}const volumeProfile_VolumeProfile=(0,data.p)()((0,withSize.U)({style:{minHeight:600}})((0,withDeviceRatio.O)()(VolumeProfile))),index_stories={title:"Visualization/Indicator/Volume Profile",component:VolumeProfileSeries},basic={render:()=>(0,jsx_runtime.jsx)(volumeProfile_VolumeProfile,{})},__namedExportsOrder=["basic"];basic.parameters={...basic.parameters,docs:{...basic.parameters?.docs,source:{originalSource:"{\n  render: () => <VolumeProfile />\n}",...basic.parameters?.docs?.source}}}}}]);