"use strict";(self.webpackChunk_react_stockcharts3_stories=self.webpackChunk_react_stockcharts3_stories||[]).push([[405],{"../../node_modules/d3-array/src/deviation.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function deviation(values,valueof){const v=function variance(values,valueof){let delta,count=0,mean=0,sum=0;if(void 0===valueof)for(let value of values)null!=value&&(value=+value)>=value&&(delta=value-mean,mean+=delta/++count,sum+=delta*(value-mean));else{let index=-1;for(let value of values)null!=(value=valueof(value,++index,values))&&(value=+value)>=value&&(delta=value-mean,mean+=delta/++count,sum+=delta*(value-mean))}if(count>1)return sum/(count-1)}(values,valueof);return v?Math.sqrt(v):v}__webpack_require__.d(__webpack_exports__,{A:()=>deviation})},"../../node_modules/d3-array/src/sum.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function sum(values,valueof){let sum=0;if(void 0===valueof)for(let value of values)(value=+value)&&(sum+=value);else{let index=-1;for(let value of values)(value=+valueof(value,++index,values))&&(sum+=value)}return sum}__webpack_require__.d(__webpack_exports__,{A:()=>sum})},"../interactive/lib/components/ClickableCircle.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{t:()=>ClickableCircle});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/react/jsx-runtime.js"),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/react/index.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../core/lib/GenericChartComponent.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../core/lib/GenericComponent.js");class ClickableCircle extends react__WEBPACK_IMPORTED_MODULE_1__.Component{constructor(){super(...arguments),this.drawOnCanvas=(ctx,moreProps)=>{const{strokeStyle,strokeWidth,fillStyle,r}=this.props;ctx.lineWidth=strokeWidth,ctx.fillStyle=fillStyle,ctx.strokeStyle=strokeStyle;const[x,y]=this.helper(moreProps);ctx.beginPath(),ctx.arc(x,y,r,0,2*Math.PI,!1),ctx.fill(),ctx.stroke()},this.isHover=moreProps=>{const{mouseXY}=moreProps,r=this.props.r+7,[x,y]=this.helper(moreProps),[mx,my]=mouseXY;return x-r<mx&&mx<x+r&&y-r<my&&my<y+r},this.helper=moreProps=>{const{xyProvider,cx,cy}=this.props;if(void 0!==xyProvider)return xyProvider(moreProps);const{xScale,chartConfig:{yScale}}=moreProps;return[xScale(cx),yScale(cy)]}}render(){const{interactiveCursorClass,onDragStart,onDrag,onDragComplete,show}=this.props;return show?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_2__.P,{interactiveCursorClass,selected:!0,isHover:this.isHover,onDragStart,onDrag,onDragComplete,canvasDraw:this.drawOnCanvas,canvasToDraw:_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__.wk,drawOn:["pan","mousemove","drag"]}):null}}ClickableCircle.defaultProps={className:"react-financial-charts-interactive-line-edge",show:!1}},"../interactive/lib/components/InteractiveStraightLine.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{AK:()=>getSlope,F$:()=>InteractiveStraightLine,KU:()=>getYIntercept,Lg:()=>isHovering,ph:()=>isHovering2,sD:()=>generateLine});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/react/jsx-runtime.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../core/lib/GenericChartComponent.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../core/lib/GenericComponent.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../core/lib/utils/noop.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../core/lib/utils/strokeDasharray.js"),react__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../node_modules/react/index.js");class InteractiveStraightLine extends react__WEBPACK_IMPORTED_MODULE_5__.Component{constructor(){super(...arguments),this.isHover=moreProps=>{const{tolerance,onHover}=this.props;if(void 0!==onHover){const{x1Value,x2Value,y1Value,y2Value,type}=this.props,{mouseXY,xScale}=moreProps,{chartConfig:{yScale}}=moreProps;return isHovering({x1Value,y1Value,x2Value,y2Value,mouseXY,type,tolerance,xScale,yScale})}return!1},this.drawOnCanvas=(ctx,moreProps)=>{const{strokeWidth=InteractiveStraightLine.defaultProps.strokeWidth,strokeDasharray,strokeStyle}=this.props,{x1,y1,x2,y2}=function helper(props,moreProps){const{x1Value,x2Value,y1Value,y2Value,type}=props,{xScale,chartConfig:{yScale}}=moreProps,modLine=generateLine({type,start:[x1Value,y1Value],end:[x2Value,y2Value],xScale,yScale}),x1=xScale(modLine.x1),y1=yScale(modLine.y1),x2=xScale(modLine.x2),y2=yScale(modLine.y2);return{x1,y1,x2,y2}}(this.props,moreProps);ctx.lineWidth=strokeWidth,ctx.strokeStyle=strokeStyle;const lineDash=(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_4__.y)(strokeDasharray);ctx.setLineDash(lineDash),ctx.beginPath(),ctx.moveTo(x1,y1),ctx.lineTo(x2,y2),ctx.stroke()}}render(){const{selected,interactiveCursorClass}=this.props,{onDragStart,onDrag,onDragComplete,onHover,onUnHover}=this.props;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_1__.P,{isHover:this.isHover,canvasToDraw:_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_2__.wk,canvasDraw:this.drawOnCanvas,interactiveCursorClass,selected,onDragStart,onDrag,onDragComplete,onHover,onUnHover,drawOn:["mousemove","pan","drag"]})}}function isHovering2(start,end,[mouseX,mouseY],tolerance){const m=getSlope(start,end);if(void 0!==m){const y=m*mouseX+getYIntercept(m,end);return mouseY<y+tolerance&&mouseY>y-tolerance&&mouseX>Math.min(start[0],end[0])-tolerance&&mouseX<Math.max(start[0],end[0])+tolerance}return mouseY>=Math.min(start[1],end[1])&&mouseY<=Math.max(start[1],end[1])&&mouseX<start[0]+tolerance&&mouseX>start[0]-tolerance}function isHovering({x1Value,y1Value,x2Value,y2Value,mouseXY,type,tolerance,xScale,yScale}){const line=generateLine({type,start:[x1Value,y1Value],end:[x2Value,y2Value],xScale,yScale}),start=[xScale(line.x1),yScale(line.y1)],end=[xScale(line.x2),yScale(line.y2)],m=getSlope(start,end),[mouseX,mouseY]=mouseXY;if(void 0!==m){const y=m*mouseX+getYIntercept(m,end);return mouseY<y+tolerance&&mouseY>y-tolerance&&mouseX>Math.min(start[0],end[0])-tolerance&&mouseX<Math.max(start[0],end[0])+tolerance}return mouseY>=Math.min(start[1],end[1])&&mouseY<=Math.max(start[1],end[1])&&mouseX<start[0]+tolerance&&mouseX>start[0]-tolerance}function getSlope(start,end){return end[0]===start[0]?void 0:(end[1]-start[1])/(end[0]-start[0])}function getYIntercept(m,end){return-1*m*end[0]+end[1]}function generateLine({type,start,end,xScale,yScale}){const m=getSlope(start,end),b=getYIntercept(m,start);switch(type){case"XLINE":return function getXLineCoordinates({start,end,xScale,yScale,m,b}){const[xBegin,xFinish]=xScale.domain(),[yBegin,yFinish]=yScale.domain();if(end[0]===start[0])return{x1:end[0],y1:yBegin,x2:end[0],y2:yFinish};const[x1,x2]=end[0]>start[0]?[xBegin,xFinish]:[xFinish,xBegin];return{x1,y1:m*x1+b,x2,y2:m*x2+b}}({start,end,xScale,yScale,m,b});case"RAY":return function getRayCoordinates({start,end,xScale,yScale,m,b}){const[xBegin,xFinish]=xScale.domain(),[yBegin,yFinish]=yScale.domain(),x1=start[0];if(end[0]===start[0])return{x1,y1:start[1],x2:x1,y2:end[1]>start[1]?yFinish:yBegin};const x2=end[0]>start[0]?xFinish:xBegin;return{x1,y1:m*x1+b,x2,y2:m*x2+b}}({start,end,xScale,yScale,m,b});default:return function getLineCoordinates({start,end}){const[x1,y1]=start,[x2,y2]=end;if(end[0]===start[0])return{x1,y1:start[1],x2:x1,y2:end[1]};return{x1,y1,x2,y2}}({start,end})}}InteractiveStraightLine.defaultProps={onEdge1Drag:_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__.l,onEdge2Drag:_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__.l,edgeStrokeWidth:3,edgeStroke:"#000000",edgeFill:"#FFFFFF",r:10,withEdge:!1,strokeWidth:1,strokeDasharray:"Solid",children:_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__.l,tolerance:7,selected:!1}},"../interactive/lib/components/MouseLocationIndicator.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{O:()=>MouseLocationIndicator});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/react/jsx-runtime.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../core/lib/GenericChartComponent.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../core/lib/GenericComponent.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../core/lib/utils/noop.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../core/lib/utils/index.js"),_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../core/lib/utils/shallowEqual.js"),react__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../node_modules/react/index.js"),_react_stockcharts3_core_lib_utils_ChartDataUtil__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../core/lib/utils/ChartDataUtil.js");class MouseLocationIndicator extends react__WEBPACK_IMPORTED_MODULE_6__.Component{constructor(){super(...arguments),this.mutableState={},this.xy=(e,moreProps)=>{const{xAccessor,plotData}=moreProps,{mouseXY,currentItem,xScale,chartConfig:{yScale}}=moreProps,{enabled,snap,shouldDisableSnap,snapTo}=this.props;if(enabled&&(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_4__.O9)(currentItem)&&(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_4__.O9)(e)){const xValue=snap&&!shouldDisableSnap(e)?xAccessor(currentItem):xScale.invert?xScale.invert(mouseXY[0]):(0,_react_stockcharts3_core_lib_utils_ChartDataUtil__WEBPACK_IMPORTED_MODULE_7__.M4)(xScale,xAccessor,mouseXY,plotData),yValue=snap&&void 0!==snapTo&&!shouldDisableSnap(e)?(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_4__.xZ)(snapTo(currentItem),yScale.invert(mouseXY[1])):yScale.invert(mouseXY[1]);return{xValue,yValue,x:xScale(xValue),y:yScale(yValue)}}},this.handleClick=(e,moreProps)=>{const pos=this.xy(e,moreProps);if(void 0!==pos&&(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_4__.O9)(pos)){const{xValue,yValue,x,y}=pos;this.mutableState={x,y},this.props.onClick(e,[xValue,yValue],moreProps)}},this.handleMouseDown=(e,moreProps)=>{const pos=this.xy(e,moreProps);if(void 0!==pos&&(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_4__.O9)(pos)){const{xValue,yValue,x,y}=pos;this.mutableState={x,y},this.props.onMouseDown(e,[xValue,yValue],moreProps)}},this.handleMousePosChange=(e,moreProps)=>{if(!(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_5__.b)(moreProps.mousXY,moreProps.prevMouseXY)){const pos=this.xy(e,moreProps);if(void 0!==pos&&(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_4__.O9)(pos)){const{xValue,yValue,x,y}=pos;this.mutableState={x,y},this.props.onMouseMove(e,[xValue,yValue],moreProps)}}},this.drawOnCanvas=(ctx,moreProps)=>{const{enabled,r,stroke,strokeWidth}=this.props,{x,y}=this.mutableState,{show}=moreProps;enabled&&show&&(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_4__.O9)(x)&&(ctx.lineWidth=strokeWidth,ctx.strokeStyle=stroke,ctx.moveTo(x,y),ctx.beginPath(),ctx.arc(x,y,r,0,2*Math.PI,!1),ctx.stroke())}}render(){const{enabled,disablePan}=this.props;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_1__.P,{onMouseDown:this.handleMouseDown,onClick:this.handleClick,onMouseMove:this.handleMousePosChange,onPan:this.handleMousePosChange,disablePan:enabled&&disablePan,canvasDraw:this.drawOnCanvas,canvasToDraw:_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_2__.wk,drawOn:["mousemove","pan"]})}}MouseLocationIndicator.defaultProps={onMouseMove:_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__.l,onMouseDown:_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__.l,onClick:_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_3__.l,shouldDisableSnap:(0,_react_stockcharts3_core__WEBPACK_IMPORTED_MODULE_4__.ER)(!1),stroke:"#000000",strokeWidth:1,opacity:1,disablePan:!0}},"./src/features/interactive/StandardDeviationChannelChart.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,__namedExportsOrder:()=>__namedExportsOrder,default:()=>StandardDeviationChannelChart_stories});var jsx_runtime=__webpack_require__("../../node_modules/react/jsx-runtime.js"),react=__webpack_require__("../../node_modules/react/index.js"),defaultLocale=__webpack_require__("../../node_modules/d3-format/src/defaultLocale.js"),src_defaultLocale=__webpack_require__("../../node_modules/d3-time-format/src/defaultLocale.js"),ChartCanvas=__webpack_require__("../core/lib/ChartCanvas.js"),Chart=__webpack_require__("../core/lib/Chart.js"),XAxis=__webpack_require__("../axes/lib/XAxis.js"),YAxis=__webpack_require__("../axes/lib/YAxis.js"),CandlestickSeries=__webpack_require__("../series/lib/CandlestickSeries.js"),MouseCoordinateY=__webpack_require__("../coordinates/lib/MouseCoordinateY.js"),MouseCoordinateX=__webpack_require__("../coordinates/lib/MouseCoordinateX.js"),CrossHairCursor=__webpack_require__("../coordinates/lib/CrossHairCursor.js"),discontinuousTimeScaleProvider=__webpack_require__("../scales/lib/discontinuousTimeScaleProvider.js"),utils=__webpack_require__("../core/lib/utils/index.js"),lib_utils=__webpack_require__("../interactive/lib/utils.js"),MouseLocationIndicator=__webpack_require__("../interactive/lib/components/MouseLocationIndicator.js"),HoverTextNearMouse=__webpack_require__("../interactive/lib/components/HoverTextNearMouse.js"),ChartDataUtil=__webpack_require__("../core/lib/utils/ChartDataUtil.js"),ClickableCircle=__webpack_require__("../interactive/lib/components/ClickableCircle.js"),zip=__webpack_require__("../../node_modules/d3-array/src/zip.js"),sum=__webpack_require__("../../node_modules/d3-array/src/sum.js"),deviation=__webpack_require__("../../node_modules/d3-array/src/deviation.js"),GenericChartComponent=__webpack_require__("../core/lib/GenericChartComponent.js"),GenericComponent=__webpack_require__("../core/lib/GenericComponent.js"),closestItem=__webpack_require__("../core/lib/utils/closestItem.js"),InteractiveStraightLine=__webpack_require__("../interactive/lib/components/InteractiveStraightLine.js");class LinearRegressionChannelWithArea extends react.Component{constructor(){super(...arguments),this.drawOnCanvas=(ctx,moreProps)=>{const{strokeStyle,strokeWidth,fillStyle}=this.props,{x1,y1,x2,y2,dy}=helper(this.props,moreProps);ctx.lineWidth=strokeWidth,ctx.strokeStyle=strokeStyle,ctx.fillStyle=fillStyle,ctx.beginPath(),ctx.moveTo(x1,y1-dy),ctx.lineTo(x2,y2-dy),ctx.stroke(),ctx.beginPath(),ctx.moveTo(x2,y2+dy),ctx.lineTo(x1,y1+dy),ctx.stroke(),ctx.beginPath(),ctx.moveTo(x1,y1-dy),ctx.lineTo(x2,y2-dy),ctx.lineTo(x2,y2+dy),ctx.lineTo(x1,y1+dy),ctx.closePath(),ctx.fill(),ctx.beginPath(),ctx.moveTo(x2,y2),ctx.lineTo(x1,y1),ctx.stroke()},this.isHover=moreProps=>{const{tolerance,onHover}=this.props;if(void 0!==onHover){const{mouseXY}=moreProps,{x1,y1,x2,y2,dy}=helper(this.props,moreProps);return[-dy,0,dy].reduce((result,diff)=>result||(0,InteractiveStraightLine.ph)([x1,y1+diff],[x2,y2+diff],mouseXY,tolerance),!1)}return!1}}render(){const{selected,interactiveCursorClass}=this.props,{onDragStart,onDrag,onDragComplete,onHover,onUnHover}=this.props;return(0,jsx_runtime.jsx)(GenericChartComponent.P,{isHover:this.isHover,canvasToDraw:GenericComponent.wk,canvasDraw:this.drawOnCanvas,interactiveCursorClass,selected,onDragStart,onDrag,onDragComplete,onHover,onUnHover,drawOn:["mousemove","mouseleave","pan","drag"]})}}function edge2Provider(props){return function(moreProps){const{x2,y2}=helper(props,moreProps);return[x2,y2]}}function helper(props,moreProps){const{x1Value,x2Value,type}=props,{xScale,chartConfig:{yScale},fullData}=moreProps,{xAccessor}=moreProps,{left}=(0,closestItem.f)(fullData,x1Value,xAccessor),{right}=(0,closestItem.f)(fullData,x2Value,xAccessor),startIndex=Math.min(left,right),endIndex=Math.max(left,right)+1,array=fullData.slice(startIndex,endIndex),xs=array.map(d=>xAccessor(d).valueOf()),ys=array.map(d=>d.close),n=array.length,xys=(0,zip.A)(xs,ys).map(d=>d[0]*d[1]),xSquareds=xs.map(x=>Math.pow(x,2)),b=(n*(0,sum.A)(xys)-(0,sum.A)(xs)*(0,sum.A)(ys))/(n*(0,sum.A)(xSquareds)-Math.pow((0,sum.A)(xs),2)),a=((0,sum.A)(ys)-b*(0,sum.A)(xs))/n,newy1=a+b*x1Value,newy2=a+b*x2Value,x1=xScale(x1Value),y1=yScale(newy1);return{x1,y1,x2:xScale(x2Value),y2:yScale(newy2),dy:yScale(newy1-("SD"===type?(0,deviation.A)(array,d=>d.close):0))-y1}}LinearRegressionChannelWithArea.defaultProps={type:"SD",strokeWidth:1,tolerance:4,selected:!1};class EachLinearRegressionChannel extends react.Component{constructor(props){super(props),this.handleHover=(_,moreProps)=>{this.state.hover!==moreProps.hovering&&this.setState({hover:moreProps.hovering})},this.handleEdge2Drag=(e,moreProps)=>{const{index,onDrag,snapTo,x1Value}=this.props;if(void 0===onDrag)return;const[x2Value]=getNewXY(moreProps,snapTo);onDrag(e,index,{x1Value,x2Value})},this.handleEdge1Drag=(e,moreProps)=>{const{index,onDrag,snapTo,x2Value}=this.props;if(void 0===onDrag)return;const[x1Value]=getNewXY(moreProps,snapTo);onDrag(e,index,{x1Value,x2Value})},this.isHover=lib_utils.FK.bind(this),this.saveNodeType=lib_utils.Ap.bind(this),this.state={hover:!1}}render(){const{x1Value,x2Value,appearance,edgeInteractiveCursor,hoverText,interactive,selected,onDragComplete}=this.props,{stroke,strokeWidth,fill,r,edgeStrokeWidth,edgeFill,edgeStroke}=appearance,{hover}=this.state,hoverHandler=interactive?{onHover:this.handleHover,onUnHover:this.handleHover}:{},{enable:hoverTextEnabled,selectedText:hoverTextSelected,text:hoverTextUnselected,...restHoverTextProps}=hoverText;return(0,jsx_runtime.jsxs)("g",{children:[(0,jsx_runtime.jsx)(LinearRegressionChannelWithArea,{ref:this.saveNodeType("area"),selected:selected||hover,...hoverHandler,x1Value,x2Value,fillStyle:fill,strokeStyle:stroke,strokeWidth:hover||selected?strokeWidth+1:strokeWidth}),(0,jsx_runtime.jsx)(ClickableCircle.t,{ref:this.saveNodeType("edge1"),show:selected||hover,xyProvider:(props=this.props,function(moreProps){const{x1,y1}=helper(props,moreProps);return[x1,y1]}),r,fillStyle:edgeFill,strokeStyle:edgeStroke,strokeWidth:edgeStrokeWidth,interactiveCursorClass:edgeInteractiveCursor,onDrag:this.handleEdge1Drag,onDragComplete}),(0,jsx_runtime.jsx)(ClickableCircle.t,{ref:this.saveNodeType("edge2"),show:selected||hover,xyProvider:edge2Provider(this.props),r,fillStyle:edgeFill,strokeStyle:edgeStroke,strokeWidth:edgeStrokeWidth,interactiveCursorClass:edgeInteractiveCursor,onDrag:this.handleEdge2Drag,onDragComplete}),(0,jsx_runtime.jsx)(HoverTextNearMouse.r,{show:hoverTextEnabled&&hover,...restHoverTextProps,text:selected?hoverTextSelected:hoverTextUnselected})]});var props}}function getNewXY(moreProps,snapTo){const{xScale,xAccessor,plotData,mouseXY}=moreProps,currentItem=(0,ChartDataUtil.Bp)(xScale,xAccessor,mouseXY,plotData);return[xAccessor(currentItem),snapTo(currentItem)]}EachLinearRegressionChannel.defaultProps={appearance:{stroke:"#000000",strokeWidth:1,fill:"rgba(138, 175, 226, 0.7)",edgeStrokeWidth:2,edgeStroke:"#000000",edgeFill:"#FFFFFF",r:5},interactive:!0,selected:!1,hoverText:{...HoverTextNearMouse.r.defaultProps,enable:!0,bgHeight:18,bgWidth:175,text:"Click and drag the edge circles"}};class StandardDeviationChannel extends react.Component{constructor(props){super(props),this.handleEnd=(e,xyValue,moreProps)=>{const{current}=this.state,{appearance,stdDevChannels}=this.props;if(this.mouseMoved&&(0,utils.O9)(current)&&(0,utils.O9)(current.start)){const newChannels=[...stdDevChannels.map(d=>({...d,selected:!1})),{start:current.start,end:xyValue,selected:!0,appearance}];this.setState({current:null},()=>{const{onComplete}=this.props;void 0!==onComplete&&onComplete(e,newChannels,moreProps)})}},this.handleStart=(_,xyValue)=>{const{current}=this.state;((0,utils.pN)(current)||(0,utils.pN)(current.start))&&(this.mouseMoved=!1,this.setState({current:{start:xyValue,end:null}},()=>{const{onStart}=this.props;void 0!==onStart&&onStart()}))},this.handleDrawLine=(e,xyValue)=>{const{current}=this.state;(0,utils.O9)(current)&&(0,utils.O9)(current.start)&&(this.mouseMoved=!0,this.setState({current:{start:current.start,end:xyValue}}))},this.handleDragLineComplete=(e,moreProps)=>{const{override}=this.state,{stdDevChannels}=this.props;if((0,utils.O9)(override)){const newChannels=stdDevChannels.map((each,idx)=>idx===override.index?{...each,start:[override.x1Value,override.y1Value],end:[override.x2Value,override.y2Value],selected:!0}:each);this.setState({override:null},()=>{const{onComplete}=this.props;void 0!==onComplete&&onComplete(e,newChannels,moreProps)})}},this.handleDragLine=(e,index,newXYValue)=>{this.setState({override:{index,...newXYValue}})},this.terminate=lib_utils.MH.bind(this),this.saveNodeType=lib_utils.Ap.bind(this),this.getSelectionState=(0,lib_utils._W)("stdDevChannels").bind(this),this.state={}}render(){const{appearance,stdDevChannels,currentPositionOpacity,currentPositionRadius=StandardDeviationChannel.defaultProps.currentPositionRadius,currentPositionStroke,currentPositionStrokeWidth,enabled,hoverText,snapTo}=this.props,{current,override}=this.state,eachDefaultAppearance={...StandardDeviationChannel.defaultProps.appearance,...appearance},hoverTextDefault={...StandardDeviationChannel.defaultProps.hoverText,...hoverText},tempLine=(0,utils.O9)(current)&&(0,utils.O9)(current.end)?(0,jsx_runtime.jsx)(EachLinearRegressionChannel,{interactive:!1,x1Value:current.start[0],x2Value:current.end[0],appearance:eachDefaultAppearance,hoverText:hoverTextDefault}):null;return(0,jsx_runtime.jsxs)("g",{children:[stdDevChannels.map((each,idx)=>{const eachAppearance=(0,utils.O9)(each.appearance)?{...eachDefaultAppearance,...each.appearance}:eachDefaultAppearance,eachHoverText=(0,utils.O9)(each.hoverText)?{...hoverTextDefault,...each.hoverText}:hoverTextDefault;return(0,jsx_runtime.jsx)(EachLinearRegressionChannel,{ref:this.saveNodeType(idx),index:idx,selected:each.selected,x1Value:(0,lib_utils.Ur)(override,idx,"x1Value",each.start[0]),x2Value:(0,lib_utils.Ur)(override,idx,"x2Value",each.end[0]),appearance:eachAppearance,snapTo,hoverText:eachHoverText,onDrag:this.handleDragLine,onDragComplete:this.handleDragLineComplete,edgeInteractiveCursor:"react-financial-charts-move-cursor"},idx)}),tempLine,(0,jsx_runtime.jsx)(MouseLocationIndicator.O,{enabled,snap:!0,snapTo,r:currentPositionRadius,stroke:currentPositionStroke,opacity:currentPositionOpacity,strokeWidth:currentPositionStrokeWidth,onMouseDown:this.handleStart,onClick:this.handleEnd,onMouseMove:this.handleDrawLine})]})}}StandardDeviationChannel.defaultProps={snapTo:d=>d.close,appearance:{stroke:"#2ca02c",fillOpacity:.1,strokeOpacity:1,strokeWidth:1,fill:"rgba(44, 160, 44, 0.1)",edgeStrokeWidth:2,edgeStroke:"#2ca02c",edgeFill:"#FFFFFF",r:5},currentPositionStroke:"#000000",currentPositionOpacity:1,currentPositionStrokeWidth:3,currentPositionRadius:4,hoverText:{...HoverTextNearMouse.r.defaultProps,enable:!0,bgHeight:"auto",bgWidth:"auto",text:"Click and drag the edge circles",selectedText:""},channels:[]};var DrawingObjectSelector=__webpack_require__("../interactive/lib/DrawingObjectSelector.js"),withSize=__webpack_require__("../utils/lib/withSize.js"),withDeviceRatio=__webpack_require__("../utils/lib/withDeviceRatio.js"),data=__webpack_require__("./src/data/index.ts");class StandardDeviationChannelChart extends react.Component{constructor(props){super(props),this.interactiveNodes={},this.onKeyPress=e=>{switch(e.key.toLowerCase()){case"escape":this.setState({enableStdDevChannel:!1});break;case"delete":case"backspace":this.setState(prevState=>({stdDevChannels:Array.isArray(prevState.stdDevChannels)?prevState.stdDevChannels.filter(channel=>!channel.selected):[]}));break;case"s":this.setState({enableStdDevChannel:!0})}},this.onDrawComplete=(e,newStdDevChannels,_moreProps)=>{this.setState({enableStdDevChannel:!1,stdDevChannels:newStdDevChannels})},this.handleSelection=(e,interactives,_moreProps)=>{const newState=this.toObject(interactives,each=>[1===each.chartId?"stdDevChannels":`${each.type.toLowerCase()}_${each.chartId}`,each.objects||[]]);this.setState(newState)},this.state={enableStdDevChannel:!1,stdDevChannels:[]},this.saveInteractiveNodes=this.saveInteractiveNodes.bind(this),this.getInteractiveNodes=this.getInteractiveNodes.bind(this)}saveInteractiveNodes(type,chartId){return node=>{this.interactiveNodes||(this.interactiveNodes={});const key=`${type}_${chartId}`;(node||this.interactiveNodes[key])&&(this.interactiveNodes={...this.interactiveNodes,[key]:{type,chartId,node}})}}getInteractiveNodes(){return this.interactiveNodes}componentDidMount(){document.addEventListener("keydown",this.onKeyPress)}componentWillUnmount(){document.removeEventListener("keydown",this.onKeyPress)}toObject(interactives,keyMapper){const obj={};return interactives.forEach(each=>{const[key,value]=keyMapper(each);obj[key]=value}),obj}render(){const{data,height,width,ratio}=this.props,{enableStdDevChannel,stdDevChannels}=this.state,safeStdDevChannels=Array.isArray(stdDevChannels)?stdDevChannels:[],xScaleProvider=discontinuousTimeScaleProvider.A.inputDateAccessor(d=>d.date),{data:chartData,xScale,xAccessor,displayXAccessor}=xScaleProvider(data),xExtents=[xAccessor(chartData[chartData.length-200]),xAccessor(chartData[chartData.length-1])];return(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("div",{style:{padding:"10px",borderBottom:"1px solid #ccc",backgroundColor:"#f5f5f5",display:"flex",gap:"10px",alignItems:"center"},children:[(0,jsx_runtime.jsx)("button",{onClick:()=>this.setState({enableStdDevChannel:!0}),style:{backgroundColor:enableStdDevChannel?"#007bff":"#fff",color:enableStdDevChannel?"#fff":"#000",border:"1px solid #ccc",padding:"8px 12px",cursor:"pointer"},children:"Draw Std Dev Channel (S)"}),(0,jsx_runtime.jsx)("button",{onClick:()=>this.setState({enableStdDevChannel:!1}),style:{backgroundColor:enableStdDevChannel?"#fff":"#007bff",color:enableStdDevChannel?"#000":"#fff",border:"1px solid #ccc",padding:"8px 12px",cursor:"pointer"},children:"Select Mode"}),(0,jsx_runtime.jsxs)("div",{style:{marginLeft:"20px",color:"#666"},children:["Mode: ",enableStdDevChannel?"Drawing":"Select"," | Std Dev Channels:"," ",safeStdDevChannels.length," | ESC: Cancel | DEL: Delete Selected | Selector:"," ",enableStdDevChannel?"DISABLED":"ENABLED"]})]}),(0,jsx_runtime.jsxs)(ChartCanvas.v,{height,width,ratio,margin:{left:70,right:70,top:20,bottom:30},data:chartData,displayXAccessor,seriesName:"Data",xScale,xAccessor,xExtents,children:[(0,jsx_runtime.jsxs)(Chart.t,{id:1,yExtents:d=>[d.high,d.low],children:[(0,jsx_runtime.jsx)(XAxis.W,{}),(0,jsx_runtime.jsx)(YAxis.h,{}),(0,jsx_runtime.jsx)(CandlestickSeries.H,{}),(0,jsx_runtime.jsx)(StandardDeviationChannel,{ref:this.saveInteractiveNodes("StandardDeviationChannel",1),enabled:enableStdDevChannel,snap:!1,onStart:()=>{},onComplete:this.onDrawComplete,stdDevChannels:safeStdDevChannels}),(0,jsx_runtime.jsx)(MouseCoordinateY.R,{displayFormat:(0,defaultLocale.GP)(".2f")}),(0,jsx_runtime.jsx)(MouseCoordinateX.Y,{displayFormat:(0,src_defaultLocale.DC)("%Y-%m-%d")}),(0,jsx_runtime.jsx)(DrawingObjectSelector.D,{enabled:!enableStdDevChannel,getInteractiveNodes:this.getInteractiveNodes,drawingObjectMap:{StandardDeviationChannel:"stdDevChannels"},onSelect:this.handleSelection})]}),(0,jsx_runtime.jsx)(CrossHairCursor.H,{})]})]})}}const interactive_StandardDeviationChannelChart=(0,data.p)()((0,withSize.U)({style:{minHeight:600}})((0,withDeviceRatio.O)()(StandardDeviationChannelChart))),StandardDeviationChannelChart_stories={title:"Interactive/Standard Deviation Channel",component:interactive_StandardDeviationChannelChart,parameters:{layout:"fullscreen"}},Default={render:()=>(0,jsx_runtime.jsx)(interactive_StandardDeviationChannelChart,{})},__namedExportsOrder=["Default"];Default.parameters={...Default.parameters,docs:{...Default.parameters?.docs,source:{originalSource:"{\n  render: () => <StandardDeviationChannelChart />\n}",...Default.parameters?.docs?.source}}}}}]);